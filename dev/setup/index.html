<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setup Guide &mdash; Artemis  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Coding and design guidelines" href="../guidelines/" />
    <link rel="prev" title="Markdown Support" href="../../user/markdown-support/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../" class="icon icon-home"> Artemis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/exercises/">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/lectures/">Lectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/exam_mode/">Exams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/orion/">Orion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/communication/">Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/plagiarism-check/">Plagiarism checks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/learning-analytics/">Learning Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/notifications/">Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/user-experience/">User Experience</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/grading/">Grading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/courses/customizable/">Customizing Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/scaling/">Scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/markdown-support/">Markdown Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributor Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setup Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#mysql-setup">MySQL Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#users-for-mysql">Users for MySQL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-empty-root-password-for-mysql-8">Set empty root password for MySQL 8</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#server-setup">Server Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run-the-server-via-a-service-configuration">Run the server via a service configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-server-via-docker">Run the server via Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dockerfile">Dockerfile</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-server-via-a-run-configuration-in-intellij">Run the server via a run configuration in IntelliJ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#other-run-debug-configurations">Other run / debug configurations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-server-with-spring-boot-and-spring-profiles">Run the server with Spring Boot and Spring profiles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-spring-profiles-with-intellij-ultimate">Set Spring profiles with IntelliJ Ultimate</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-server-with-the-command-line-gradle-wrapper">Run the server with the command line (Gradle wrapper)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-text-assessment-analytics-service">Configure Text Assessment Analytics Service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#client-setup">Client Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-intellij">Using IntelliJ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-command-line">Using the command line</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#customize-your-artemis-instance">Customize your Artemis instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#programming-exercise-adjustments">Programming Exercise adjustments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#path-variables">Path variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#templates">Templates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#jenkins-template">Jenkins template</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#caching-example-for-maven">Caching example for Maven</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bamboo-bitbucket-and-jira-setup">Bamboo, Bitbucket and Jira Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#docker-compose">Docker-Compose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-bamboo-bitbucket-and-jira">Configure Bamboo, Bitbucket and Jira</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-artemis">Configure Artemis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-verify-the-connection-works">How to verify the connection works?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#artemis-jira">Artemis → Jira</a></li>
<li class="toctree-l4"><a class="reference internal" href="#artemis-bitbucket">Artemis → Bitbucket</a></li>
<li class="toctree-l4"><a class="reference internal" href="#artemis-bamboo">Artemis → Bamboo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bitbucket-bamboo">Bitbucket → Bamboo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bitbucket-artemis">Bitbucket → Artemis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bamboo-artemis">Bamboo → Artemis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#jenkins-and-gitlab-setup">Jenkins and GitLab Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#artemis">Artemis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gitlab">GitLab</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gitlab-server-quickstart">GitLab Server Quickstart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manual-gitlab-server-setup">Manual GitLab Server Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#upgrade-gitlab">Upgrade GitLab</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#jenkins">Jenkins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#automated-jenkins-server-setup">Automated Jenkins Server Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manual-jenkins-server-setup">Manual Jenkins Server Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#required-jenkins-plugins">Required Jenkins Plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#timestamper-configuration">Timestamper Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#server-notification-plugin">Server Notification Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jenkins-credentials">Jenkins Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gitlab-to-jenkins-push-notification-token">GitLab to Jenkins push notification token</a></li>
<li class="toctree-l4"><a class="reference internal" href="#upgrading-jenkins">Upgrading Jenkins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-agents">Build agents</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuring-local-build-agents">Configuring local build agents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#alternative-local-build-agents-setup-using-docker">Alternative local build agents setup using docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-remote-build-agents">Installing remote build agents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#jenkins-user-management">Jenkins User Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jenkins-build-plan-access-control-configuration">Jenkins Build Plan Access Control Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#caching">Caching</a></li>
<li class="toctree-l3"><a class="reference internal" href="#separate-nginx-configurations">Separate NGINX Configurations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#jenkins-1">Jenkins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#etc-nginx-common-common-ssl-conf">/etc/nginx/common/common_ssl.conf</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#deployment-artemis-gitlab-jenkins-using-docker-on-local-machine">Deployment Artemis / GitLab / Jenkins using Docker on Local machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gitlab-1">GitLab</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jenkins-2">Jenkins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#artemis-1">Artemis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#athene-service">Athene Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enable-the-athene-spring-profile">Enable the <code class="docutils literal notranslate"><span class="pre">athene</span></code> Spring profile:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-api-endpoints">Configure API Endpoints:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#apollon-service">Apollon Service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enable-the-apollon-spring-profile">Enable the <code class="docutils literal notranslate"><span class="pre">apollon</span></code> Spring profile:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Configure API Endpoints:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#common-setup-problems">Common Setup Problems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-setup-problems">General Setup Problems</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#database">Database</a></li>
<li class="toctree-l4"><a class="reference internal" href="#client">Client</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#programming-exercise-setup">Programming Exercise Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#atlassian-setup-bamboo-bitbucket-and-jira">Atlassian Setup (Bamboo, Bitbucket and Jira)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-artemis-instances">Multiple Artemis instances</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup-with-one-instance">Setup with one instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-with-multiple-instances">Setup with multiple instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-synchronization">Additional synchronization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#database-cache">Database cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#discovery-service">Discovery service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#websockets">WebSockets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-system">File system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scheduling">Scheduling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nginx-configuration">nginx configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alternative-docker-compose-setup">Alternative: Docker-Compose Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-a-shell-into-the-containers">Get a shell into the containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-useful-commands">Other useful commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alternative-kubernetes-setup">Alternative: Kubernetes Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup-kubernetes-cluster">Setup Kubernetes Cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-dockerhub-repository">Create DockerHub Repository</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-docker-id-username">Configure Docker ID (username)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-artemis-resources">Configure Artemis Resources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configure-local-user-management">Configure Local User Management</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-artemis">Build Artemis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-docker-build">Run Docker Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#push-to-docker">Push to Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-spring-profiles">Configure Spring Profiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deploy-kubernetes-resources">Deploy Kubernetes Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-edit-secrets">Add/Edit Secrets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-the-deployments-in-rancher">Check the Deployments in Rancher</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-out-the-logs">Check out the Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-additional-environment-variables">Set Additional Environment Variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guidelines/">Coding and design guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system-design/">System Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration/">Database Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../use-local-user-management/">Using local user management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guided-tour/">Guided Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testservers/">Test Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/">Builds and Dependency Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cypress/">Cypress Bamboo Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../open-source/">Open-Source</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administration Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin/registration/">User Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/saml2-shibboleth/">Shibboleth/SAML2 Login &amp; Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/accessRights/">Access Rights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/troubleshooting/">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/knownIssues/">Known Issues</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Research</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../research/publications/">Publications</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Artemis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../" class="icon icon-home"></a> &raquo;</li>
      <li>Setup Guide</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ls1intum/Artemis/blob/develop/docs/dev/setup.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="setup-guide">
<h1>Setup Guide<a class="headerlink" href="#setup-guide" title="Permalink to this heading"></a></h1>
<p>In this guide you learn how to setup the development environment of
Artemis. Artemis is based on <a class="reference external" href="https://jhipster.github.io">JHipster</a>,
i.e. <a class="reference external" href="http://projects.spring.io/spring-boot">Spring Boot</a>
development on the application server using Java 17, and TypeScript
development on the application client in the browser using
<a class="reference external" href="https://angular.io">Angular</a> and Webpack. To get an overview of the
used technology, have a look at the <a class="reference external" href="https://jhipster.github.io/tech-stack">JHipster Technology stack</a>
and other tutorials on the JHipster homepage.</p>
<p>You can find tutorials how to setup JHipster in an IDE (<a class="reference external" href="https://www.jetbrains.com/idea">IntelliJ IDEA
Ultimate</a> is recommended) on
<a class="reference external" href="https://jhipster.github.io/configuring-ide">https://jhipster.github.io/configuring-ide</a>. Note that the Community
Edition of IntelliJ IDEA does not provide Spring Boot support (see the
<a class="reference external" href="https://www.jetbrains.com/idea/features/editions_comparison_matrix.html">comparison
matrix</a>).
Before you can build Artemis, you must install and configure the
following dependencies/tools on your machine:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://www.oracle.com/java/technologies/javase-downloads.html">Java
JDK</a>:
We use Java (JDK 17) to develop and run the Artemis application
server which is based on <a class="reference external" href="http://projects.spring.io/spring-boot">Spring
Boot</a>.</p></li>
<li><p><a class="reference external" href="https://dev.mysql.com/downloads/mysql">MySQL Database Server 8</a>:
Artemis uses Hibernate to store entities in a MySQL database.
Download and install the MySQL Community Server (8.0.x) and configure it according to section
<a class="reference external" href="#mysql-setup">MySQL Setup</a>.</p></li>
<li><p><a class="reference external" href="https://nodejs.org/en/download">Node.js</a>: We use Node LTS (&gt;=16.13.0 &lt; 17) to compile
and run the client Angular application. Depending on your system, you
can install Node either from source or as a pre-packaged bundle.</p></li>
<li><p><a class="reference external" href="https://nodejs.org/en/download">Npm</a>: We use Npm (&gt;=8.1.0) to
manage client side dependencies. Npm is typically bundled with Node.js,
but can also be installed separately.</p></li>
<li><p>( <a class="reference external" href="https://www.graphviz.org/download/">Graphviz</a>: We use Graphviz to generate graphs within exercise task
descriptions.
It’s not necessary for a successful build,
but it’s necessary for production setups as otherwise errors will show up during runtime. )</p></li>
<li><p>( A <strong>version control</strong> and <strong>build</strong> system is necessary for the <strong>programming exercise</strong> feature of Artemis.
There are multiple stacks available for the integration with Artemis:</p>
<ul class="simple">
<li><p><a class="reference external" href="#jenkins-and-gitlab-setup">GitLab and Jenkins</a></p></li>
<li><p>GitLab and GitLab CI (under development, not yet production ready)</p></li>
<li><p><a class="reference external" href="#bamboo-bitbucket-and-jira-setup">Bamboo, Bitbucket and Jira</a>)</p></li>
</ul>
</li>
</ol>
<hr class="docutils" />
<div class="contents local topic" id="contents-of-this-setup-guide">
<p class="topic-title">Contents of this Setup Guide</p>
<ul class="simple">
<li><p><a class="reference internal" href="#mysql-setup" id="id22">MySQL Setup</a></p></li>
<li><p><a class="reference internal" href="#server-setup" id="id23">Server Setup</a></p></li>
<li><p><a class="reference internal" href="#client-setup" id="id24">Client Setup</a></p></li>
<li><p><a class="reference internal" href="#customize-your-artemis-instance" id="id25">Customize your Artemis instance</a></p></li>
<li><p><a class="reference internal" href="#programming-exercise-adjustments" id="id26">Programming Exercise adjustments</a></p></li>
<li><p><a class="reference internal" href="#bamboo-bitbucket-and-jira-setup" id="id27">Bamboo, Bitbucket and Jira Setup</a></p></li>
<li><p><a class="reference internal" href="#jenkins-and-gitlab-setup" id="id28">Jenkins and GitLab Setup</a></p></li>
<li><p><a class="reference internal" href="#athene-service" id="id29">Athene Service</a></p></li>
<li><p><a class="reference internal" href="#apollon-service" id="id30">Apollon Service</a></p></li>
<li><p><a class="reference internal" href="#common-setup-problems" id="id31">Common Setup Problems</a></p></li>
<li><p><a class="reference internal" href="#multiple-artemis-instances" id="id32">Multiple Artemis instances</a></p></li>
<li><p><a class="reference internal" href="#alternative-docker-compose-setup" id="id33">Alternative: Docker-Compose Setup</a></p></li>
<li><p><a class="reference internal" href="#alternative-kubernetes-setup" id="id34">Alternative: Kubernetes Setup</a></p></li>
</ul>
</div>
<hr class="docutils" />
<section id="mysql-setup">
<h2><a class="toc-backref" href="#id22">MySQL Setup</a><a class="headerlink" href="#mysql-setup" title="Permalink to this heading"></a></h2>
<p>The required Artemis schema will be created / updated automatically at startup time of the
server application.</p>
<p>As an alternative to a native MySQL setup, you can run the MySQL Database Server inside a Docker container
using e.g. <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">-f</span> <span class="pre">src/main/docker/mysql.yml</span> <span class="pre">up</span></code>.</p>
<p>If you run your own MySQL server, make sure to specify the default <code class="docutils literal notranslate"><span class="pre">character-set</span></code>
as <code class="docutils literal notranslate"><span class="pre">utf8mb4</span></code> and the default <code class="docutils literal notranslate"><span class="pre">collation</span></code> as <code class="docutils literal notranslate"><span class="pre">utf8mb4_unicode_ci</span></code>.
You can achieve this e.g. by using a <code class="docutils literal notranslate"><span class="pre">my.cnf</span></code> file in the location <code class="docutils literal notranslate"><span class="pre">/etc</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">client</span><span class="p">]</span>
<span class="n">default</span><span class="o">-</span><span class="n">character</span><span class="o">-</span><span class="nb">set</span> <span class="o">=</span> <span class="n">utf8mb4</span>
<span class="p">[</span><span class="n">mysql</span><span class="p">]</span>
<span class="n">default</span><span class="o">-</span><span class="n">character</span><span class="o">-</span><span class="nb">set</span> <span class="o">=</span> <span class="n">utf8mb4</span>
<span class="p">[</span><span class="n">mysqld</span><span class="p">]</span>
<span class="n">character</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="n">handshake</span> <span class="o">=</span> <span class="n">TRUE</span>
<span class="n">init</span><span class="o">-</span><span class="n">connect</span><span class="o">=</span><span class="s1">&#39;SET NAMES utf8mb4&#39;</span>
<span class="n">character</span><span class="o">-</span><span class="nb">set</span><span class="o">-</span><span class="n">server</span> <span class="o">=</span> <span class="n">utf8mb4</span>
<span class="n">collation</span><span class="o">-</span><span class="n">server</span> <span class="o">=</span> <span class="n">utf8mb4_unicode_ci</span>
</pre></div>
</div>
<p>Make sure the configuration file is used by MySQL when you start the server.
You can find more information on <a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/option-files.html">https://dev.mysql.com/doc/refman/8.0/en/option-files.html</a></p>
<section id="users-for-mysql">
<h3>Users for MySQL<a class="headerlink" href="#users-for-mysql" title="Permalink to this heading"></a></h3>
<div class="line-block">
<div class="line">For the development environment the default MySQL user is ‘root’ with an empty password.</div>
<div class="line">(In case you want to use a different password, make sure to change the value in
<code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code> <em>(spring &gt; datasource &gt; password)</em> and in <code class="docutils literal notranslate"><span class="pre">liquibase.gradle</span></code>
<em>(within the ‘liquibaseCommand’ as argument password)</em>).</div>
</div>
<section id="set-empty-root-password-for-mysql-8">
<h4>Set empty root password for MySQL 8<a class="headerlink" href="#set-empty-root-password-for-mysql-8" title="Permalink to this heading"></a></h4>
<p>If you have problems connecting to the MySQL 8 database using an empty root password, you can try the following command
to reset the root password to an empty password:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">--</span><span class="n">execute</span> <span class="s2">&quot;ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH caching_sha2_password BY &#39;&#39;&quot;</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Empty root passwords should only be used in a development environment.
The root password for a production environment must never be empty.</p>
</div>
<hr class="docutils" />
</section>
</section>
</section>
<section id="server-setup">
<span id="id1"></span><h2><a class="toc-backref" href="#id23">Server Setup</a><a class="headerlink" href="#server-setup" title="Permalink to this heading"></a></h2>
<p>To start the Artemis application server from the development
environment, first import the project into IntelliJ and then make sure
to install the Spring Boot plugins to run the main class
<code class="docutils literal notranslate"><span class="pre">de.tum.in.www1.artemis.ArtemisApp</span></code>. Before the application runs, you
have to change some configuration options.
You can change the options directly in the file <code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> in the folder
<code class="docutils literal notranslate"><span class="pre">src/main/resources/config</span></code>. However, you have to be careful that you do not
accidentally commit your password. Therefore, we strongly recommend, to create a new file
<code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code> in the folder <code class="docutils literal notranslate"><span class="pre">src/main/resources/config</span></code> which is ignored by default.
You can override the following configuration options in this file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">repo-clone-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./repos/</span>
    <span class="nt">repo-download-clone-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./repos-download/</span>
    <span class="nt">encryption-password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;encrypt-password&gt;</span>      <span class="c1"># LEGACY: arbitrary password for encrypting database values</span>
    <span class="nt">bcrypt-salt-rounds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">11</span>   <span class="c1"># The number of salt rounds for the bcrypt password hashing. Lower numbers make it faster but more unsecure and vice versa.</span>
                             <span class="c1"># Please use the bcrypt benchmark tool to determine the best number of rounds for your system. https://github.com/ls1intum/bcrypt-Benchmark</span>
    <span class="nt">user-management</span><span class="p">:</span>
        <span class="nt">use-external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="nt">password-reset</span><span class="p">:</span>
             <span class="nt">credential-provider</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;provider&gt;</span> <span class="c1"># The credential provider which users can log in though (e.g. TUMonline)</span>
             <span class="nt">links</span><span class="p">:</span> <span class="c1"># The password reset links for different languages</span>
                 <span class="nt">en</span><span class="p">:</span> <span class="s">&#39;&lt;link&gt;&#39;</span>
                 <span class="nt">de</span><span class="p">:</span> <span class="s">&#39;&lt;link&gt;&#39;</span>
        <span class="nt">external</span><span class="p">:</span>
            <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://jira.ase.in.tum.de</span>
            <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;username&gt;</span>    <span class="c1"># e.g. ga12abc</span>
            <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;password&gt;</span>
            <span class="nt">admin-group-name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tumuser</span>
        <span class="nt">ldap</span><span class="p">:</span>
            <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;url&gt;</span>
            <span class="nt">user-dn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;user-dn&gt;</span>
            <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;password&gt;</span>
            <span class="nt">base</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;base&gt;</span>
    <span class="nt">version-control</span><span class="p">:</span>
        <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://bitbucket.ase.in.tum.de</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;username&gt;</span>    <span class="c1"># e.g. ga12abc</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;password&gt;</span>
        <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;token&gt;</span>                 <span class="c1"># VCS API token giving Artemis full Admin access. Not needed for Bamboo+Bitbucket</span>
        <span class="nt">ci-token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;token from the CI&gt;</span>   <span class="c1"># Token generated by the CI (e.g. Jenkins) for webhooks from the VCS to the CI. Not needed for Bamboo+Bitbucket</span>
    <span class="nt">continuous-integration</span><span class="p">:</span>
        <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://bamboo.ase.in.tum.de</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;username&gt;</span>    <span class="c1"># e.g. ga12abc</span>
        <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;token&gt;</span>      <span class="c1"># Enter a valid token generated by bamboo or leave this empty to use the fallback authentication user + password</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;password&gt;</span>
        <span class="nt">vcs-application-link-name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LS1 Bitbucket Server</span>     <span class="c1"># If the VCS and CI are directly linked (normally only for Bitbucket + Bamboo)</span>
        <span class="nt">empty-commit-necessary</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>                        <span class="c1"># Do we need an empty commit for new exercises/repositories in order for the CI to register the repo</span>
        <span class="c1"># Hash/key of the ci-token, equivalent e.g. to the ci-token in version-control</span>
        <span class="c1"># Some CI systems, like Jenkins, offer a specific token that gets checked against any incoming notifications</span>
        <span class="c1"># from a VCS trying to trigger a build plan. Only if the notification request contains the correct token, the plan</span>
        <span class="c1"># is triggered. This can be seen as an alternative to sending an authenticated request to a REST API and then</span>
        <span class="c1"># triggering the plan.</span>
        <span class="c1"># In the case of Artemis, this is only really needed for the Jenkins + GitLab setup, since the GitLab plugin in</span>
        <span class="c1"># Jenkins only allows triggering the Jenkins jobs using such a token. Furthermore, in this case, the value of the</span>
        <span class="c1"># hudson.util.Secret is stored in the build plan, so you also have to specify this encrypted string here and NOT the actual token value itself!</span>
        <span class="c1"># You can get this by GETting any job.xml for a job with an activated GitLab step and your token value of choice.</span>
        <span class="nt">secret-push-token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;token hash&gt;</span>
        <span class="c1"># Key of the saved credentials for the VCS service</span>
        <span class="c1"># Bamboo: not needed</span>
        <span class="c1"># Jenkins: You have to specify the key from the credentials page in Jenkins under which the user and</span>
        <span class="c1">#          password for the VCS are stored</span>
        <span class="nt">vcs-credentials</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;credentials key&gt;</span>
        <span class="c1"># Key of the credentials for the Artemis notification token</span>
        <span class="c1"># Bamboo: not needed</span>
        <span class="c1"># Jenkins: You have to specify the key from the credentials page in Jenkins under which the notification token is stored</span>
        <span class="nt">notification-token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;credentials key&gt;</span>
        <span class="c1"># The actual value of the notification token to check against in Artemis. This is the token that gets send with</span>
        <span class="c1"># every request the CI system makes to Artemis containing a new result after a build.</span>
        <span class="c1"># Bamboo: The token value you use for the Server Notification Plugin</span>
        <span class="c1"># Jenkins: The token value you use for the Server Notification Plugin and is stored under the notification-token credential above</span>
        <span class="nt">authentication-token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;token&gt;</span>
    <span class="nt">git</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Artemis</span>
        <span class="nt">email</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis@in.tum.de</span>
    <span class="nt">athene</span><span class="p">:</span>
        <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost</span>
        <span class="nt">base64-secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">YWVuaXF1YWRpNWNlaXJpNmFlbTZkb283dXphaVF1b29oM3J1MWNoYWlyNHRoZWUzb2huZ2FpM211bGVlM0VpcAo=</span>
        <span class="nt">token-validity-in-seconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10800</span>
</pre></div>
</div>
<p>Change all entries with <code class="docutils literal notranslate"><span class="pre">&lt;...&gt;</span></code> with proper values, e.g. your TUM
Online account credentials to connect to the given instances of JIRA,
Bitbucket and Bamboo. Alternatively, you can connect to your local JIRA,
Bitbucket and Bamboo instances. It’s not necessary to fill all the
fields, most of them can be left blank. Note that there is additional
information about the setup for programming exercises provided:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be careful that you do not commit changes to <code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code>.
To avoid this, follow the best practice when configuring your local development environment:</p>
<ol class="arabic simple">
<li><p>Create a file named <code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code> under <code class="docutils literal notranslate"><span class="pre">src/main/resources/config</span></code>.</p></li>
<li><p>Copy the contents of <code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> into the new file.</p></li>
<li><p>Update configuration values in <code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code>.</p></li>
</ol>
<p>By default, changes to <code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code> will be ignored by git so you don’t accidentally
share your credentials or other local configuration options. The run configurations contain a profile
<code class="docutils literal notranslate"><span class="pre">local</span></code> at the end to make sure the <code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code> is considered. You can create your own
configuration files <code class="docutils literal notranslate"><span class="pre">application-&lt;name&gt;.yml</span></code> and then activate the profile <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> in the run
configuration if you need additional customizations.</p>
</div>
<p>If you use a password, you need to adapt it in
<code class="docutils literal notranslate"><span class="pre">gradle/liquibase.gradle</span></code>.</p>
<section id="run-the-server-via-a-service-configuration">
<h3>Run the server via a service configuration<a class="headerlink" href="#run-the-server-via-a-service-configuration" title="Permalink to this heading"></a></h3>
<p>This setup is recommended for production instances as it registers Artemis as a service and e.g. enables auto-restarting
of Artemis after the VM running Artemis has been restarted.
As alternative you could take a look at the section below about
<a class="reference external" href="#run-the-server-via-docker">deploying artemis as docker container</a>.
For development setups, see the other guides below.</p>
<p>This is a service file that works on Debian/Ubuntu (using systemd):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">Artemis</span>
<span class="n">After</span><span class="o">=</span><span class="n">syslog</span><span class="o">.</span><span class="n">target</span>
<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">User</span><span class="o">=</span><span class="n">artemis</span>
<span class="n">WorkingDirectory</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">artemis</span>
<span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">java</span> \
  <span class="o">-</span><span class="n">Djdk</span><span class="o">.</span><span class="n">tls</span><span class="o">.</span><span class="n">ephemeralDHKeySize</span><span class="o">=</span><span class="mi">2048</span> \
  <span class="o">-</span><span class="n">DLC_CTYPE</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> \
  <span class="o">-</span><span class="n">Dfile</span><span class="o">.</span><span class="n">encoding</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> \
  <span class="o">-</span><span class="n">Dsun</span><span class="o">.</span><span class="n">jnu</span><span class="o">.</span><span class="n">encoding</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> \
  <span class="o">-</span><span class="n">Djava</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">egd</span><span class="o">=</span><span class="n">file</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/./</span><span class="n">urandom</span> \
  <span class="o">-</span><span class="n">Xmx2048m</span> \
  <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">modules</span> <span class="n">java</span><span class="o">.</span><span class="n">se</span> \
  <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">exports</span> <span class="n">java</span><span class="o">.</span><span class="n">base</span><span class="o">/</span><span class="n">jdk</span><span class="o">.</span><span class="n">internal</span><span class="o">.</span><span class="n">ref</span><span class="o">=</span><span class="n">ALL</span><span class="o">-</span><span class="n">UNNAMED</span> \
  <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">exports</span> <span class="n">java</span><span class="o">.</span><span class="n">naming</span><span class="o">/</span><span class="n">com</span><span class="o">.</span><span class="n">sun</span><span class="o">.</span><span class="n">jndi</span><span class="o">.</span><span class="n">ldap</span><span class="o">=</span><span class="n">ALL</span><span class="o">-</span><span class="n">UNNAMED</span> \
  <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">opens</span> <span class="n">java</span><span class="o">.</span><span class="n">base</span><span class="o">/</span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">=</span><span class="n">ALL</span><span class="o">-</span><span class="n">UNNAMED</span> \
  <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">opens</span> <span class="n">java</span><span class="o">.</span><span class="n">base</span><span class="o">/</span><span class="n">java</span><span class="o">.</span><span class="n">nio</span><span class="o">=</span><span class="n">ALL</span><span class="o">-</span><span class="n">UNNAMED</span> \
  <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">opens</span> <span class="n">java</span><span class="o">.</span><span class="n">base</span><span class="o">/</span><span class="n">sun</span><span class="o">.</span><span class="n">nio</span><span class="o">.</span><span class="n">ch</span><span class="o">=</span><span class="n">ALL</span><span class="o">-</span><span class="n">UNNAMED</span> \
  <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">opens</span> <span class="n">java</span><span class="o">.</span><span class="n">management</span><span class="o">/</span><span class="n">sun</span><span class="o">.</span><span class="n">management</span><span class="o">=</span><span class="n">ALL</span><span class="o">-</span><span class="n">UNNAMED</span> \
  <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">opens</span> <span class="n">jdk</span><span class="o">.</span><span class="n">management</span><span class="o">/</span><span class="n">com</span><span class="o">.</span><span class="n">sun</span><span class="o">.</span><span class="n">management</span><span class="o">.</span><span class="n">internal</span><span class="o">=</span><span class="n">ALL</span><span class="o">-</span><span class="n">UNNAMED</span> \
  <span class="o">-</span><span class="n">jar</span> <span class="n">artemis</span><span class="o">.</span><span class="n">war</span> \
  <span class="o">--</span><span class="n">spring</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">active</span><span class="o">=</span><span class="n">prod</span><span class="p">,</span><span class="n">bamboo</span><span class="p">,</span><span class="n">bitbucket</span><span class="p">,</span><span class="n">jira</span><span class="p">,</span><span class="n">ldap</span><span class="p">,</span><span class="n">scheduling</span><span class="p">,</span><span class="n">openapi</span>
<span class="n">SuccessExitStatus</span><span class="o">=</span><span class="mi">143</span>
<span class="n">StandardOutput</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">artemis</span><span class="o">/</span><span class="n">artemis</span><span class="o">.</span><span class="n">log</span>
<span class="n">StandardError</span><span class="o">=</span><span class="n">inherit</span>
<span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">multi</span><span class="o">-</span><span class="n">user</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
<p>The following parts might also be useful for other (production) setups, even if this service file is not used:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-Djava.security.egd=file:/dev/./urandom</span></code>: This is required if repositories are cloned via SSH from the VCS.</dt><dd><p>The default (pseudo-)random-generator <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> is blocking which results in very bad performance when using
SSH due to lack of entropy.</p>
</dd>
</dl>
</li>
</ul>
<p>The file should be placed at <code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/artemis.service</span></code> and after running <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">daemon-reload</span></code>,
you can start the service using <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">artemis</span></code>.</p>
<p>You can stop the service using <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">artemis</span> <span class="pre">stop</span></code> and restart it using <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">artemis</span> <span class="pre">restart</span></code>.</p>
<p>Logs can be fetched using <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">journalctl</span> <span class="pre">-u</span> <span class="pre">artemis</span> <span class="pre">-f</span> <span class="pre">-n</span> <span class="pre">200</span></code>.</p>
</section>
<section id="run-the-server-via-docker">
<h3>Run the server via Docker<a class="headerlink" href="#run-the-server-via-docker" title="Permalink to this heading"></a></h3>
<div class="line-block">
<div class="line">Artemis provides a Docker image named <code class="docutils literal notranslate"><span class="pre">ghcr.io/ls1intum/artemis:&lt;TAG/VERSION&gt;</span></code>.</div>
<div class="line">The current develop branch is provided by the tag <code class="docutils literal notranslate"><span class="pre">develop</span></code>.</div>
<div class="line">The latest release is provided by the tag <code class="docutils literal notranslate"><span class="pre">latest</span></code>.</div>
<div class="line">Specific releases like <code class="docutils literal notranslate"><span class="pre">5.7.1</span></code> can be retrieved as <code class="docutils literal notranslate"><span class="pre">ghcr.io/ls1intum/artemis:5.7.1</span></code>.</div>
<div class="line">Branches tied to a pull request can be obtained by using the tag <code class="docutils literal notranslate"><span class="pre">PR-&lt;PR</span> <span class="pre">NUMBER&gt;</span></code>.</div>
</div>
<section id="dockerfile">
<h4>Dockerfile<a class="headerlink" href="#dockerfile" title="Permalink to this heading"></a></h4>
<p>You can find the latest Artemis Dockerfile at <code class="docutils literal notranslate"><span class="pre">src/main/docker/Dockerfile</span></code>.</p>
<ul>
<li><p>The Dockerfile defines three Docker volumes</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">/opt/artemis/config</span></code>: This will be used to store the configuration of Artemis in YAML files.
If this directory is empty, the default configuration of Artemis will be copied upon container start.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Instead of mounting this config directory, you can also use environment variables for the configuration as
defined by the
<a class="reference external" href="https://github.com/spring-projects/spring-boot/wiki/Relaxed-Binding-2.0#environment-variables">Spring relaxed binding</a>.
You can either place those environment variables directly in the <code class="docutils literal notranslate"><span class="pre">environment</span></code> section,
or create an <a class="reference external" href="https://docs.docker.com/compose/environment-variables/#the-env-file">.env-file</a>.
When starting an Artemis container directly with the Docker-CLI, an .env-file can also be given via the
<code class="docutils literal notranslate"><span class="pre">--env-file</span></code> option.</p>
<p>To ease the transition of an existing set of YAML configuration files into the environment variable style, a
<a class="reference external" href="https://github.com/b-fein/spring-yaml-to-env">helper script</a> can be used.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/opt/artemis/data</span></code>: This directory should be used for any data (e.g., local clone of repositories).
Therefore, configure Artemis to store this files into this directory. In order to do that, you have to change
some properties in configuration files (i.e., <code class="docutils literal notranslate"><span class="pre">artemis.repo-clone-path</span></code>, <code class="docutils literal notranslate"><span class="pre">artemis.repo-download-clone-path</span></code>,
<code class="docutils literal notranslate"><span class="pre">artemis.course-archives-path</span></code>, <code class="docutils literal notranslate"><span class="pre">artemis.submission-export-path</span></code>, and <code class="docutils literal notranslate"><span class="pre">artemis.file-upload-path</span></code>).
Otherwise you’ll get permission failures.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/opt/artemis/public/content</span></code>: This directory will be used for branding.
You can specify a favicon, <code class="docutils literal notranslate"><span class="pre">imprint.html</span></code>, and <code class="docutils literal notranslate"><span class="pre">privacy_statement.html</span></code> here.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The Dockerfile sets the correct permissions to the folders that are mounted to the volumes on startup (not recursive).</p></li>
<li><p>The startup script is located <a class="reference external" href="https://github.com/ls1intum/Artemis/blob/develop/bootstrap.sh">here</a>.</p></li>
<li><p>The Dockerfile assumes that the mounted volumes are located on a file system with the following locale settings
(see <a class="reference external" href="https://github.com/ls1intum/Artemis/issues/4439">#4439</a> for more details):</p>
<blockquote>
<div><ul class="simple">
<li><p>LC_ALL <code class="docutils literal notranslate"><span class="pre">en_US.UTF-8</span></code></p></li>
<li><p>LANG <code class="docutils literal notranslate"><span class="pre">en_US.UTF-8</span></code></p></li>
<li><p>LANGUAGE <code class="docutils literal notranslate"><span class="pre">en_US.UTF-8</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="run-the-server-via-a-run-configuration-in-intellij">
<h3>Run the server via a run configuration in IntelliJ<a class="headerlink" href="#run-the-server-via-a-run-configuration-in-intellij" title="Permalink to this heading"></a></h3>
<p>The project comes with some pre-configured run / debug configurations that are stored in the <code class="docutils literal notranslate"><span class="pre">.idea</span></code> directory.
When you import the project into IntelliJ the run configurations will also be imported.</p>
<p>The recommended way is to run the server and the client separated. This provides fast rebuilds of the server and hot
module replacement in the client.</p>
<ul class="simple">
<li><p><strong>Artemis (Server):</strong> The server will be started separated from the client. The startup time decreases significantly.</p></li>
<li><p><strong>Artemis (Client):</strong> Will execute <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code> and <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">serve</span></code>. The client will be available at
<a class="reference external" href="http://localhost:9000/">http://localhost:9000/</a> with hot module replacement enabled (also see
<a class="reference external" href="#client-setup">Client Setup</a>).</p></li>
</ul>
<section id="other-run-debug-configurations">
<h4>Other run / debug configurations<a class="headerlink" href="#other-run-debug-configurations" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><strong>Artemis (Server &amp; Client):</strong> Will start the server and the client. The client will be available at
<a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a> with hot module replacement disabled.</p></li>
<li><p><strong>Artemis (Server, Jenkins &amp; GitLab):</strong> The server will be started separated from the client with the profiles
<code class="docutils literal notranslate"><span class="pre">dev,jenkins,gitlab,artemis</span></code> instead of <code class="docutils literal notranslate"><span class="pre">dev,bamboo,bitbucket,jira,artemis</span></code>.</p></li>
<li><p><strong>Artemis (Server, Athene):</strong> The server will be started separated from the client with <code class="docutils literal notranslate"><span class="pre">athene</span></code> profile enabled
(see <a class="reference external" href="#athene-service">Athene Service</a>).</p></li>
</ul>
</section>
</section>
<section id="run-the-server-with-spring-boot-and-spring-profiles">
<h3>Run the server with Spring Boot and Spring profiles<a class="headerlink" href="#run-the-server-with-spring-boot-and-spring-profiles" title="Permalink to this heading"></a></h3>
<p>The Artemis server should startup by running the main class
<code class="docutils literal notranslate"><span class="pre">de.tum.in.www1.artemis.ArtemisApp</span></code> using Spring Boot.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Artemis uses Spring profiles to segregate parts of the
application configuration and make it only available in certain
environments. For development purposes, the following program arguments
can be used to enable the <code class="docutils literal notranslate"><span class="pre">dev</span></code> profile and the profiles for JIRA,
Bitbucket and Bamboo:</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">spring</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">active</span><span class="o">=</span><span class="n">dev</span><span class="p">,</span><span class="n">bamboo</span><span class="p">,</span><span class="n">bitbucket</span><span class="p">,</span><span class="n">jira</span><span class="p">,</span><span class="n">artemis</span><span class="p">,</span><span class="n">scheduling</span>
</pre></div>
</div>
<p>If you use IntelliJ (Community or Ultimate) you can set the active
profiles by</p>
<ul class="simple">
<li><p>Choosing <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">|</span> <span class="pre">Edit</span> <span class="pre">Configurations...</span></code></p></li>
<li><p>Going to the <code class="docutils literal notranslate"><span class="pre">Configuration</span> <span class="pre">Tab</span></code></p></li>
<li><p>Expanding the <code class="docutils literal notranslate"><span class="pre">Environment</span></code> section to reveal <code class="docutils literal notranslate"><span class="pre">VM</span> <span class="pre">Options</span></code> and setting them to
<code class="docutils literal notranslate"><span class="pre">-Dspring.profiles.active=dev,bamboo,bitbucket,jira,artemis,scheduling</span></code></p></li>
</ul>
<section id="set-spring-profiles-with-intellij-ultimate">
<h4>Set Spring profiles with IntelliJ Ultimate<a class="headerlink" href="#set-spring-profiles-with-intellij-ultimate" title="Permalink to this heading"></a></h4>
<p>If you use IntelliJ Ultimate, add the following entry to the section
<code class="docutils literal notranslate"><span class="pre">Active</span> <span class="pre">Profiles</span></code> (within <code class="docutils literal notranslate"><span class="pre">Spring</span> <span class="pre">Boot</span></code>) in the server run
configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dev</span><span class="p">,</span><span class="n">bamboo</span><span class="p">,</span><span class="n">bitbucket</span><span class="p">,</span><span class="n">jira</span><span class="p">,</span><span class="n">artemis</span><span class="p">,</span><span class="n">scheduling</span>
</pre></div>
</div>
</section>
</section>
<section id="run-the-server-with-the-command-line-gradle-wrapper">
<h3>Run the server with the command line (Gradle wrapper)<a class="headerlink" href="#run-the-server-with-the-command-line-gradle-wrapper" title="Permalink to this heading"></a></h3>
<p>If you want to run the application via the command line instead, make
sure to pass the active profiles to the <code class="docutils literal notranslate"><span class="pre">gradlew</span></code> command like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">gradlew</span> <span class="n">bootRun</span> <span class="o">--</span><span class="n">args</span><span class="o">=</span><span class="s1">&#39;--spring.profiles.active=dev,bamboo,bitbucket,jira,artemis,scheduling&#39;</span>
</pre></div>
</div>
<p>As an alternative, you might want to use Jenkins and GitLab with an
internal user management in Artemis, then you would use the profiles:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dev</span><span class="p">,</span><span class="n">jenkins</span><span class="p">,</span><span class="n">gitlab</span><span class="p">,</span><span class="n">artemis</span><span class="p">,</span><span class="n">scheduling</span>
</pre></div>
</div>
</section>
<section id="configure-text-assessment-analytics-service">
<h3>Configure Text Assessment Analytics Service<a class="headerlink" href="#configure-text-assessment-analytics-service" title="Permalink to this heading"></a></h3>
<p>Text Assessment Analytics is an internal analytics service used to gather data regarding the features of the text
assessment process. Certain assessment events are tracked:</p>
<ol class="arabic simple">
<li><p>Adding new feedback on a manually selected block</p></li>
<li><p>Adding new feedback on an automatically selected block</p></li>
<li><p>Deleting a feedback</p></li>
<li><p>Clicking to resolve feedback conflicts</p></li>
<li><p>Clicking to view origin submission of automatically generated feedback</p></li>
<li><p>Hovering over the text assessment feedback impact warning</p></li>
<li><p>Editing/Discarding an automatically generated feedback</p></li>
<li><p>Clicking the Submit button when assessing a text submission</p></li>
<li><p>Clicking the Assess Next button when assessing a text submission</p></li>
</ol>
<p>These events are tracked by attaching a POST call to the respective DOM elements on the client side.
The POST call accesses the <strong>TextAssessmentEventResource</strong> which then adds the events in its respective table.
This feature is disabled by default. We can enable it by modifying the configuration in the file:
<code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-artemis.yml</span></code> like so:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">info</span><span class="p">:</span>
   <span class="nt">text-assessment-analytics-enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="client-setup">
<h2><a class="toc-backref" href="#id24">Client Setup</a><a class="headerlink" href="#client-setup" title="Permalink to this heading"></a></h2>
<p>You need to install Node and Npm on your local machine.</p>
<section id="using-intellij">
<h3>Using IntelliJ<a class="headerlink" href="#using-intellij" title="Permalink to this heading"></a></h3>
<p>If you are using <strong>IntelliJ</strong> you can use the pre-configured <code class="docutils literal notranslate"><span class="pre">Artemis</span> <span class="pre">(Client)</span></code>
run configuration that will be delivered with this repository:</p>
<ul class="simple">
<li><p>Choose <code class="docutils literal notranslate"><span class="pre">Run</span> <span class="pre">|</span> <span class="pre">Edit</span> <span class="pre">Configurations...</span></code></p></li>
<li><p>Select the <code class="docutils literal notranslate"><span class="pre">Artemis</span> <span class="pre">(Client)</span></code> configuration from the <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">section</span></code></p></li>
<li><p>Now you can run the configuration in the upper right corner of IntelliJ</p></li>
</ul>
</section>
<section id="using-the-command-line">
<span id="usingthecommandline"></span><h3>Using the command line<a class="headerlink" href="#using-the-command-line" title="Permalink to this heading"></a></h3>
<p>You should be able to run the following
command to install development tools and dependencies. You will only
need to run this command when dependencies change in <code class="docutils literal notranslate"><span class="pre">package.json</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">install</span>
</pre></div>
</div>
<p>To start the client application in the browser, use the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">run</span> <span class="n">serve</span>
</pre></div>
</div>
<p>This compiles TypeScript code to JavaScript code, starts the hot module
replacement feature in Webpack (i.e. whenever you change a TypeScript
file and save, the client is automatically reloaded with the new code)
and will start the client application in your browser on
<code class="docutils literal notranslate"><span class="pre">http://localhost:9000</span></code>. If you have activated the JIRA profile (see
above in <a class="reference external" href="#server-setup">Server Setup</a>) and if you have configured
<code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> correctly, then you should be able to login
with your TUM Online account.</p>
<p>In case you encounter any problems regarding JavaScript heap memory leaks when executing <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">run</span> <span class="pre">serve</span></code> or any other
scripts from <code class="docutils literal notranslate"><span class="pre">package.json</span></code>,
you can add a memory limit parameter (<code class="docutils literal notranslate"><span class="pre">--max_old_space_size=5120</span></code>) in the script.
You can do it by changing the <strong>start</strong> script in <code class="docutils literal notranslate"><span class="pre">package.json</span></code> from:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;ng serve --hmr&quot;</span><span class="p">,</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;node --max_old_space_size=5120 ./node_modules/@angular/cli/bin/ng serve --hmr&quot;</span><span class="p">,</span>
</pre></div>
</div>
<p>If you still face the issue, you can try to set a higher value than 5120. Possible values are 6144, 7168, and 8192.</p>
<p>The same change could be applied to each <strong>ng</strong> command as in the example above.</p>
<p>Make sure to <strong>not commit this change</strong> in <code class="docutils literal notranslate"><span class="pre">package.json</span></code>.</p>
<p>For more information, review <a class="reference external" href="https://www.jhipster.tech/development/#working-with-angular">Working with
Angular</a>.
For further instructions on how to develop with JHipster, have a look at
<a class="reference external" href="http://www.jhipster.tech/development">Using JHipster in
development</a>.</p>
</section>
</section>
<hr class="docutils" />
<section id="customize-your-artemis-instance">
<h2><a class="toc-backref" href="#id25">Customize your Artemis instance</a><a class="headerlink" href="#customize-your-artemis-instance" title="Permalink to this heading"></a></h2>
<p>You can define the following custom assets for Artemis to be used
instead of the TUM defaults:</p>
<ul class="simple">
<li><p>The logo next to the “Artemis” heading on the navbar → <code class="docutils literal notranslate"><span class="pre">${artemisRunDirectory}/public/images/logo.png</span></code></p></li>
<li><p>The favicon → <code class="docutils literal notranslate"><span class="pre">${artemisRunDirectory}/logo/favicon.svg</span></code></p></li>
<li><p>The privacy statement HTML → <code class="docutils literal notranslate"><span class="pre">${artemisRunDirectory}/public/content/privacy_statement.html</span></code></p></li>
<li><p>The imprint statement HTML → <code class="docutils literal notranslate"><span class="pre">${artemisRunDirectory}/public/content/imprint.html</span></code></p></li>
<li><p>The contact email address in the <code class="docutils literal notranslate"><span class="pre">application-{dev,prod}.yml</span></code> configuration file under the key <code class="docutils literal notranslate"><span class="pre">info.contact</span></code></p></li>
</ul>
<hr class="docutils" />
</section>
<section id="programming-exercise-adjustments">
<span id="programming-exercises"></span><h2><a class="toc-backref" href="#id26">Programming Exercise adjustments</a><a class="headerlink" href="#programming-exercise-adjustments" title="Permalink to this heading"></a></h2>
<p>There are several variables that can be configured when using programming exercises.
They are presented in this separate section to keep the ‘normal’ setup guide shorter.</p>
<section id="path-variables">
<h3>Path variables<a class="headerlink" href="#path-variables" title="Permalink to this heading"></a></h3>
<p>There are variables for several paths:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">artemis.repo-clone-path</span></code></p>
<p>Repositories that the Artemis server needs are stored in this folder.
This e.g. affects repositories from students which use the online code editor or
the template/solution repositories of new exercises, as they are pushed to the VCS after modification.</p>
<p>Files in this directory are usually not critical, as the latest pushed version of these repositories are
also stored at the VCS.
However, changed that are saved in the online code editor but not yet committed will be lost when
this folder is deleted.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">artemis.repo-download-clone-path</span></code></p>
<p>Repositories that were downloaded from Artemis are stored in this directory.</p>
<p>Files in this directory can be removed without loss of data, if the downloaded repositories are still present
at the VCS.
No changes to the data in the VCS are stored in this directory (or they can be retrieved by performing
the download-action again).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">artemis.template-path</span></code></p>
<p>Templates are available within Artemis.
The templates should fit to most environments, but there might be cases where one wants to change the templates.</p>
<p>This value specifies the path to the templates which should overwrite the default ones.
Note that this is the path to the folder where the <code class="docutils literal notranslate"><span class="pre">templates</span></code> folder is located, not the path to the
<code class="docutils literal notranslate"><span class="pre">templates</span></code> folder itself.</p>
</li>
</ul>
</section>
<section id="templates">
<h3>Templates<a class="headerlink" href="#templates" title="Permalink to this heading"></a></h3>
<p>Templates are shipped with Artemis (they can be found within the <code class="docutils literal notranslate"><span class="pre">src/main/resources/templates</span></code> folder in GitHub).
These templates should fit well for many deployments, but one might want to change some of them for special deployments.</p>
<p>As of now, you can overwrite the <code class="docutils literal notranslate"><span class="pre">jenkins</span></code> folders that is present within the <code class="docutils literal notranslate"><span class="pre">src/main/resources/templates</span></code> folder.
Files that are present in the file system will be used, if a file is not present in the file system,
it is loaded from the classpath (e.g. the <code class="docutils literal notranslate"><span class="pre">.war</span></code> archive).</p>
<p>We plan to make other folders configurable as well, but this is not supported yet.</p>
<section id="jenkins-template">
<h4>Jenkins template<a class="headerlink" href="#jenkins-template" title="Permalink to this heading"></a></h4>
<p>The build process in Jenkins is stored in a <code class="docutils literal notranslate"><span class="pre">config.xml</span></code>-file (<code class="docutils literal notranslate"><span class="pre">src/main/resources/templates/jenkins</span></code>)
that shares common steps for all programming languages (e.g. triggering a build when a push to GitLab occurred).
It is extended by a <code class="docutils literal notranslate"><span class="pre">Jenkinsfile</span></code> that is dependent on the used programming language which will be included
in the generic <code class="docutils literal notranslate"><span class="pre">config.xml</span></code> file.
The builds steps (including used docker images, the checkout process, the actual build steps,
and the reporting of the results to Artemis) is included in the <code class="docutils literal notranslate"><span class="pre">Jenkinsfile</span></code>.</p>
<p>A sample <code class="docutils literal notranslate"><span class="pre">Jenkinsfile</span></code> can be found at <code class="docutils literal notranslate"><span class="pre">src/main/resources/templates/jenkins/java/Jenkinsfile</span></code>.
Note that the <code class="docutils literal notranslate"><span class="pre">Jenkinsfile</span></code> <strong>must</strong> start either</p>
<ul class="simple">
<li><p>with <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> (there must not be a comment before pipeline, but there can be one at any other position,
if the Jenkinsfile-syntax allows it)</p></li>
<li><p>or the special comment <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">ARTEMIS:</span> <span class="pre">JenkinsPipeline</span></code> in the first line.</p></li>
</ul>
<p>The variables <code class="docutils literal notranslate"><span class="pre">#dockerImage</span></code>, <code class="docutils literal notranslate"><span class="pre">#testRepository</span></code>, <code class="docutils literal notranslate"><span class="pre">#assignmentRepository</span></code>, <code class="docutils literal notranslate"><span class="pre">#jenkinsNotificationToken</span></code> and
<code class="docutils literal notranslate"><span class="pre">#notificationsUrl</span></code> will automatically be replaced
(for the normal Jenkinsfile, within the Jenkinsfile-staticCodeAnalysis, #staticCodeAnalysisScript is also replaced).</p>
<p>You should not need to touch any of these variables, except the <code class="docutils literal notranslate"><span class="pre">#dockerImage</span></code> variable,
if you want to use a different agent setup (e.g. a Kubernetes setup).</p>
</section>
</section>
<section id="caching-example-for-maven">
<h3>Caching example for Maven<a class="headerlink" href="#caching-example-for-maven" title="Permalink to this heading"></a></h3>
<p>The Docker image used to run the maven-tests already contains a set of commonly used dependencies
(see <a class="reference external" href="https://github.com/ls1intum/artemis-maven-docker">artemis-maven-docker</a>).
This significantly speeds up builds as the dependencies do not have to be downloaded every time a build is started.
However, the dependencies included in the Docker image might not match the dependencies required in your tests
(e.g. because you added new dependencies or the Docker image is outdated).</p>
<p>You can cache the maven-dependencies also on the machine that runs the builds
(that means, outside the docker container) using the following steps:</p>
<p>Adjust the agent-args and add the environment block.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>agent <span class="o">{</span>
    docker <span class="o">{</span>
        image <span class="s1">&#39;#dockerImage&#39;</span>
        label <span class="s1">&#39;docker&#39;</span>
        args <span class="s1">&#39;-v $HOME/maven-cache-docker:/var/maven&#39;</span>
    <span class="o">}</span>
<span class="o">}</span>
environment <span class="o">{</span>
  <span class="nv">JAVA_TOOL_OPTIONS</span> <span class="o">=</span> <span class="s1">&#39;-Duser.home=/var/maven&#39;</span>
<span class="o">}</span>
stages <span class="o">{</span>
    stage<span class="o">(</span><span class="s1">&#39;Checkout&#39;</span><span class="o">)</span> <span class="o">{</span>
</pre></div>
</div>
<p>You have to add permissions to the folder (which will be located at the $HOME folder of the user that jenkins uses),
e.g. with <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">chmod</span> <span class="pre">777</span> <span class="pre">maven-cache-docker</span> <span class="pre">-R</span></code>.</p>
<p>Note that this might allow students to access shared resources (e.g. jars used by Maven), and they might be able
to overwrite them.
You can use <a class="reference external" href="https://github.com/ls1intum/Ares">Ares</a> to prevent this by restricting the resources
the student’s code can access.</p>
</section>
</section>
<hr class="docutils" />
<section id="bamboo-bitbucket-and-jira-setup">
<h2><a class="toc-backref" href="#id27">Bamboo, Bitbucket and Jira Setup</a><a class="headerlink" href="#bamboo-bitbucket-and-jira-setup" title="Permalink to this heading"></a></h2>
<p>This section describes how to set up a programming exercise environment
based on Bamboo, Bitbucket and Jira.</p>
<div class="line-block">
<div class="line">Please note that this setup will create a deployment that is very
similar to the one used in production but has one difference:</div>
<div class="line">In production, the builds are performed within Docker containers that
are created by Bamboo (or its build agents). As we run Bamboo in a
Docker container in this setup, creating new Docker containers within
that container is not recommended (e.g. see <a class="reference external" href="https://itnext.io/docker-in-docker-521958d34efd">this
article</a>). There
are some solution where one can pass the Docker socket to the Bamboo
container, but none of these approaches work quite well here as Bamboo
uses mounted directories that cause issues.</div>
</div>
<p>Therefore, a check is included within the BambooBuildPlanService that
ensures that builds are not started in Docker agents if the development
setup is present.</p>
<p><strong>Prerequisites:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.docker.com/install">Docker</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/compose/install/">Docker-Compose</a></p></li>
</ul>
<div class="contents local topic" id="content-of-this-section">
<p class="topic-title">Content of this section</p>
<ul class="simple">
<li><p><a class="reference internal" href="#docker-compose" id="id35">Docker-Compose</a></p></li>
<li><p><a class="reference internal" href="#configure-bamboo-bitbucket-and-jira" id="id36">Configure Bamboo, Bitbucket and Jira</a></p></li>
<li><p><a class="reference internal" href="#configure-artemis" id="id37">Configure Artemis</a></p></li>
<li><p><a class="reference internal" href="#how-to-verify-the-connection-works" id="id38">How to verify the connection works?</a></p></li>
</ul>
</div>
<section id="docker-compose">
<h3><a class="toc-backref" href="#id35">Docker-Compose</a><a class="headerlink" href="#docker-compose" title="Permalink to this heading"></a></h3>
<p>Before you start the docker-compose, check if the bamboo version in the
<code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> (search for <code class="docutils literal notranslate"><span class="pre">com.atlassian.bamboo:bamboo-specs</span></code>) is
equal to the bamboo version number in the docker compose in
<code class="docutils literal notranslate"><span class="pre">src/main/docker/atlassian.yml</span></code>
If the version number is not equal, adjust the version number.
Further details about the docker-compose setup can be found in <code class="docutils literal notranslate"><span class="pre">src/main/docker</span></code></p>
<p>Execute the docker-compose file e.g. with
<code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">-f</span> <span class="pre">src/main/docker/atlassian.yml</span> <span class="pre">up</span> <span class="pre">-d</span></code>.</p>
<p>Error Handling: It can happen that there is an overload with other
docker networks
<code class="docutils literal notranslate"><span class="pre">ERROR:</span> <span class="pre">Pool</span> <span class="pre">overlaps</span> <span class="pre">with</span> <span class="pre">other</span> <span class="pre">one</span> <span class="pre">on</span> <span class="pre">this</span> <span class="pre">address</span> <span class="pre">space</span></code>. Use the
command <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">network</span> <span class="pre">prune</span></code> to resolve this issue.</p>
<p>Make sure that docker has enough memory (~ 6GB). To adapt it, go to <code class="docutils literal notranslate"><span class="pre">Settings</span> <span class="pre">-&gt;</span> <span class="pre">Resources</span></code></p>
<p>In case you want to enable Swift or C programming exercises, refer to the readme in
<code class="docutils literal notranslate"><span class="pre">src/main/docker</span></code></p>
</section>
<section id="configure-bamboo-bitbucket-and-jira">
<h3><a class="toc-backref" href="#id36">Configure Bamboo, Bitbucket and Jira</a><a class="headerlink" href="#configure-bamboo-bitbucket-and-jira" title="Permalink to this heading"></a></h3>
<p>By default, the Jira instance is reachable under <code class="docutils literal notranslate"><span class="pre">localhost:8081</span></code>, the
Bamboo instance under <code class="docutils literal notranslate"><span class="pre">localhost:8085</span></code> and the Bitbucket instance
under <code class="docutils literal notranslate"><span class="pre">localhost:7990</span></code>.</p>
<p><strong>Get evaluation licenses for Atlassian products:</strong> <a class="reference external" href="https://my.atlassian.com/license/evaluation">Atlassian Licenses</a></p>
<ol class="arabic">
<li><p>Get licenses for Bamboo, Bitbucket and Jira Service Management.</p>
<ul class="simple">
<li><p>Bamboo: Select <code class="docutils literal notranslate"><span class="pre">Bamboo</span> <span class="pre">(Data</span> <span class="pre">Center)</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">installed</span> <span class="pre">yet</span></code></p></li>
<li><p>Bitbucket: Select <code class="docutils literal notranslate"><span class="pre">Bitbucket</span> <span class="pre">(Data</span> <span class="pre">Center)</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">installed</span> <span class="pre">yet</span></code></p></li>
<li><p>Jira: Select <code class="docutils literal notranslate"><span class="pre">Jira</span> <span class="pre">Service</span> <span class="pre">Management</span> <span class="pre">(formerly</span> <span class="pre">Service</span> <span class="pre">Desk)</span> <span class="pre">(Data</span> <span class="pre">Center)</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">installed</span> <span class="pre">yet</span></code></p></li>
</ul>
</li>
<li><p>Provide the just created license key during the setup and create an admin user with the same credentials
in all 3 applications.
For the Bamboo database you can choose H2.
Also, you can select the evaluation/internal/test/dev setups if you are asked.
Follow the additional steps for Jira and Bitbucket.</p>
<ul class="simple">
<li><p>Jira:</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>On startup select <code class="docutils literal notranslate"><span class="pre">I'll</span> <span class="pre">set</span> <span class="pre">it</span> <span class="pre">up</span> <span class="pre">myself</span></code></p></li>
<li><p>Select Build In Database Connection</p></li>
<li><p>Create a sample project</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>Bitbucket: Do not connect Bitbucket with Jira yet</p></li>
</ul>
</li>
<li><p>Make sure that Jira, Bitbucket and Bamboo have finished starting up.</p>
<blockquote>
<div><p>(Only Linux &amp; Windows) Make sure that <a class="reference external" href="https://www.howtoinstall.me/ubuntu/18-04/xdg-utils/">xdg-utils</a>
is installed before running the following script.</p>
<details>
<summary>xdg-utils for Windows users</summary>
An easy way to use the xdg-utils on Windows would be to install them on the linux-subsystem,
which should be activated anyways when running Docker on Windows.
For the installation on the subsystem the above linked explanation can be used.
<br>
Make sure to execute the script from the subsystem.
</details></div></blockquote>
<p>Execute the shell script <code class="docutils literal notranslate"><span class="pre">atlassian-setup.sh</span></code> in the
<code class="docutils literal notranslate"><span class="pre">src/main/docker/atlassian</span></code> directory (e.g. with
<code class="docutils literal notranslate"><span class="pre">src/main/docker/./atlassian-setup.sh</span></code>). This script creates
groups, users and assigns the user to their respective group.
In addition, it configures disabled application links between the 3 applications.</p>
</li>
<li><p>Enable the created <a class="reference external" href="https://confluence.atlassian.com/doc/linking-to-another-application-360677690.html">application
links</a>
between all 3 application (OAuth Impersonate). The links should open automatically after the shell script
has finished. If not open them manually:</p>
<ul>
<li><p>Bitbucket: <a class="reference external" href="http://localhost:7990/plugins/servlet/applinks/listApplicationLinks">http://localhost:7990/plugins/servlet/applinks/listApplicationLinks</a></p></li>
<li><p>Bamboo: <a class="reference external" href="http://localhost:8085/plugins/servlet/applinks/listApplicationLinks">http://localhost:8085/plugins/servlet/applinks/listApplicationLinks</a></p></li>
<li><p>Jira: <a class="reference external" href="http://localhost:8081/plugins/servlet/applinks/listApplicationLinks">http://localhost:8081/plugins/servlet/applinks/listApplicationLinks</a></p>
<p><strong>You manually have to adjust the Display URL for the Bamboo → Bitbucket AND
Bitbucket → Bamboo URl to</strong> <code class="docutils literal notranslate"><span class="pre">http://localhost:7990</span></code> <strong>and</strong>
<code class="docutils literal notranslate"><span class="pre">http://localhost:8085</span></code> <strong>.</strong></p>
<blockquote>
<div><table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Bamboo:</strong></p></th>
<th class="head"><p><strong>Bitbucket:</strong></p></th>
<th class="head"><p><strong>Jira:</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><figure class="align-center" id="id9">
<a class="reference external image-reference" href="../_images/bamboo_bitbucket_applicationLink.png"><img alt="../../_images/bamboo_bitbucket_applicationLink.png" src="../../_images/bamboo_bitbucket_applicationLink.png" /></a>
<figcaption>
<p><span class="caption-text">Bamboo → Bitbucket</span><a class="headerlink" href="#id9" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</td>
<td><figure class="align-center" id="id10">
<a class="reference external image-reference" href="../_images/bitbucket_bamboo_applicationLink.png"><img alt="../../_images/bitbucket_bamboo_applicationLink.png" src="../../_images/bitbucket_bamboo_applicationLink.png" /></a>
<figcaption>
<p><span class="caption-text">Bitbucket → Bamboo</span><a class="headerlink" href="#id10" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</td>
<td><figure class="align-center" id="id11">
<a class="reference external image-reference" href="../_images/jira_bamboo_applicationLink.png"><img alt="../../_images/jira_bamboo_applicationLink.png" src="../../_images/jira_bamboo_applicationLink.png" /></a>
<figcaption>
<p><span class="caption-text">Jira → Bamboo</span><a class="headerlink" href="#id11" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</td>
</tr>
<tr class="row-odd"><td><figure class="align-center" id="id12">
<a class="reference external image-reference" href="../_images/bamboo_jira_applicationLink.png"><img alt="../../_images/bamboo_jira_applicationLink.png" src="../../_images/bamboo_jira_applicationLink.png" /></a>
<figcaption>
<p><span class="caption-text">Bamboo → Jira</span><a class="headerlink" href="#id12" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</td>
<td><figure class="align-center" id="id13">
<a class="reference external image-reference" href="../_images/bitbucket_jira_applicationLink.png"><img alt="../../_images/bitbucket_jira_applicationLink.png" src="../../_images/bitbucket_jira_applicationLink.png" /></a>
<figcaption>
<p><span class="caption-text">Bitbucket → Jira</span><a class="headerlink" href="#id13" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</td>
<td><figure class="align-center" id="id14">
<a class="reference external image-reference" href="../_images/jira_bitbucket_applicationLink.png"><img alt="../../_images/jira_bitbucket_applicationLink.png" src="../../_images/jira_bitbucket_applicationLink.png" /></a>
<figcaption>
<p><span class="caption-text">Jira → Bitbucket</span><a class="headerlink" href="#id14" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
</li>
<li><p>The script <em>(step 3)</em> has already created the required users and assigned them to their respective group in Jira.
Now, make sure that they are assigned correctly according to the following test setup:
users 1-5 are students, 6-10 are tutors, 11-15 are
editors and 16-20 are instructors. The usernames are artemis_test_user_{1-20}
and the password is again the username. When you create a course in artemis
you have to manually choose the created groups (students, tutors, editors,
instructors).</p></li>
<li><p>Use the <a class="reference external" href="https://confluence.atlassian.com/adminjiraserver/allowing-connections-to-jira-for-user-management-938847045.html">user directories in
Jira</a>
to synchronize the users in bitbucket and bamboo:</p>
<ul class="simple">
<li><p>Go to Jira → User management → Jira user server → Add application →
Create one application for bitbucket and one for bamboo → add the
IP-address <code class="docutils literal notranslate"><span class="pre">0.0.0.0/0</span></code> to IP Addresses</p></li>
</ul>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><figure class="align-default">
<img alt="../../_images/jira_add_application_bitbucket.png" src="../../_images/jira_add_application_bitbucket.png" />
</figure>
</td>
<td><figure class="align-default">
<img alt="../../_images/jira_add_application_bamboo.png" src="../../_images/jira_add_application_bamboo.png" />
</figure>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
<ul class="simple">
<li><p>Go to Bitbucket and Bamboo → User Directories → Add Directories →
Atlassian Crowd → use the URL <code class="docutils literal notranslate"><span class="pre">http://jira:8080</span></code> as Server URL →
use the application name and password which you used in the previous
step. Also, you should decrease the synchronisation period (e.g. to 2
minutes). Press synchronise after adding the directory, the users and
groups should now be available.</p></li>
</ul>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><figure class="align-default" id="id15">
<img alt="../../_images/user_directories_bitbucket.png" src="../../_images/user_directories_bitbucket.png" />
<figcaption>
<p><span class="caption-text">Adding Crowd Server in <strong>Bitbucket</strong></span><a class="headerlink" href="#id15" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</td>
<td><figure class="align-default" id="id16">
<img alt="../../_images/user_directories_bamboo.png" src="../../_images/user_directories_bamboo.png" />
<figcaption>
<p><span class="caption-text">Adding Crowd Server in <strong>Bamboo</strong></span><a class="headerlink" href="#id16" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p>Give the test users User access on Bitbucket: Configure → Global permissions</p></li>
<li><p>In Bamboo create a global variable named
SERVER_PLUGIN_SECRET_PASSWORD, the value of this variable will be used
as the secret. The value of this variable should be then stored in
<code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-artemis.yml</span></code> as the value of
<code class="docutils literal notranslate"><span class="pre">artemis-authentication-token-value</span></code>.
You can create a global variable from settings on Bamboo.</p></li>
<li><p>Download the
<a class="reference external" href="https://github.com/ls1intum/bamboo-server-notification-plugin/releases">bamboo-server-notification-plugin</a>
and add it to bamboo. Go to Bamboo → Manage apps → Upload app → select
the downloaded .jar file → Upload</p></li>
<li><p>Add Maven and JDK:</p>
<ul class="simple">
<li><p>Go to Bamboo → Server capabilities → Add capabilities menu →
Capability type <code class="docutils literal notranslate"><span class="pre">Executable</span></code> → select type <code class="docutils literal notranslate"><span class="pre">Maven</span> <span class="pre">3.x</span></code> → insert
<code class="docutils literal notranslate"><span class="pre">Maven</span> <span class="pre">3</span></code> as executable label → insert <code class="docutils literal notranslate"><span class="pre">/artemis</span></code> as path.</p></li>
<li><p>Add capabilities menu → Capability type <code class="docutils literal notranslate"><span class="pre">JDK</span></code> → insert <code class="docutils literal notranslate"><span class="pre">JDK17</span></code>
as JDK label → insert <code class="docutils literal notranslate"><span class="pre">/usr/lib/jvm/java-17-oracle</span></code> as Java home.</p></li>
</ul>
</li>
<li><p>Create a Bamboo agent. Configure → Agents → Add local agent</p></li>
<li><p>Generate a personal access token</p>
<p>While username and password can still be used as a fallback, this option is already marked as deprecated and will
be removed in the future.</p>
<ol class="arabic">
<li><p>Personal access token for Bamboo.</p>
<ul>
<li><p>Log in as the admin user and go to Bamboo -&gt; Profile (top right corner) -&gt; Personal access tokens -&gt;
Create token</p>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/bamboo-create-token.png" src="../../_images/bamboo-create-token.png" />
</figure>
</div></blockquote>
</li>
<li><p>Insert the generated token into the file <code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> in the section <code class="docutils literal notranslate"><span class="pre">continuous-integration</span></code>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">continuous-integration</span><span class="p">:</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;username&gt;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;password&gt;</span>
        <span class="nt">token</span><span class="p">:</span> <span class="c1">#insert the token here</span>
</pre></div>
</div>
</li>
</ol>
<p># Personal access token for Bitbucket.</p>
<blockquote>
<div><ul>
<li><p>Log in as the admin user and go to Bitbucket -&gt; View Profile (top right corner) -&gt; Manage account -&gt;
Personal access tokens -&gt; Create token</p>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/bitbucket-create-token.png" src="../../_images/bitbucket-create-token.png" />
</figure>
</div></blockquote>
</li>
<li><p>Insert the generated token into the file <code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> in the section <code class="docutils literal notranslate"><span class="pre">version-control</span></code>:</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">version-control</span><span class="p">:</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;username&gt;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;password&gt;</span>
        <span class="nt">token</span><span class="p">:</span> <span class="c1">#insert the token here</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Add a SSH key for the admin user</p>
<blockquote>
<div><p>Artemis can clone/push the repositories during setup and for the online code editor using SSH.
If the SSH key is not present, the username + token will be used as fallback
(and all git operations will use HTTP(S) instead of SSH).
If the token is also not present, the username + password will be used as fallback (again, using HTTP(S)).</p>
<p>You first have to create a SSH key (locally), e.g. using <code class="docutils literal notranslate"><span class="pre">ssh-keygen</span></code>
(more information on how to create a SSH key can be found e.g. at <a class="reference external" href="https://www.ssh.com/ssh/keygen/">ssh.com</a>
or at <a class="reference external" href="https://confluence.atlassian.com/bitbucketserver076/creating-ssh-keys-1026534841.html">atlassian.com</a>).</p>
<p>The list of supported ciphers can be found at <a class="reference external" href="https://github.com/apache/mina-sshd">Apache Mina</a>.</p>
<p>It is recommended to use a password to secure the private key, but it is not mandatory.</p>
<p>Please note that the private key file <strong>must</strong> be named <code class="docutils literal notranslate"><span class="pre">id_rsa</span></code>, <code class="docutils literal notranslate"><span class="pre">id_dsa</span></code>, <code class="docutils literal notranslate"><span class="pre">id_ecdsa</span></code> or <code class="docutils literal notranslate"><span class="pre">id_ed25519</span></code>,
depending on the ciphers used.</p>
<p>You now have to extract the public key and add it to Bitbucket.
Open the public key file (usually called <code class="docutils literal notranslate"><span class="pre">id_rsa.pub</span></code> (when using RSA)) and copy it’s content
(you can also use <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">id_rsa.pub</span></code> to show the public key).</p>
<p>Navigate to <code class="docutils literal notranslate"><span class="pre">BITBUCKET-URL/plugins/servlet/ssh/account/keys</span></code> and add the SSH key by pasting the content of
the public key.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;ssh-key-path&gt;</span></code> is the path to the folder containing the <code class="docutils literal notranslate"><span class="pre">id_rsa</span></code> file (but without the filename).
It will be used in the configuration of Artemis to specify where Artemis should look for the key and
store the <code class="docutils literal notranslate"><span class="pre">known_hosts</span></code> file.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;ssh-private-key-password&gt;</span></code> is the password used to secure the private key.
It is also needed for the configuration of Artemis, but can be omitted if no password was set
(e.g. for development environments).</p>
</div></blockquote>
</li>
</ol>
</section>
<section id="configure-artemis">
<h3><a class="toc-backref" href="#id37">Configure Artemis</a><a class="headerlink" href="#configure-artemis" title="Permalink to this heading"></a></h3>
<ol class="arabic">
<li><p>Modify <code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-artemis.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">repo-clone-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./repos/</span>
<span class="nt">repo-download-clone-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./repos-download/</span>
<span class="nt">encryption-password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis-encrypt</span>         <span class="c1"># LEGACY: arbitrary password for encrypting database values</span>
<span class="nt">bcrypt-salt-rounds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">11</span>   <span class="c1"># The number of salt rounds for the bcrypt password hashing. Lower numbers make it faster but more unsecure and vice versa.</span>
                         <span class="c1"># Please use the bcrypt benchmark tool to determine the best number of rounds for your system. https://github.com/ls1intum/bcrypt-Benchmark</span>
<span class="nt">user-management</span><span class="p">:</span>
    <span class="nt">use-external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">external</span><span class="p">:</span>
        <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:8081</span>
        <span class="nt">user</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;jira-admin-user&gt;</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;jira-admin-password&gt;</span>
        <span class="nt">admin-group-name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">instructors</span>
    <span class="nt">internal-admin</span><span class="p">:</span>
        <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
<span class="nt">version-control</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:7990</span>
    <span class="nt">user</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;bitbucket-admin-user&gt;</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;bitbucket-admin-password&gt;</span>
    <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;bitbucket-admin-token&gt;</span>   <span class="c1"># step 10.2</span>
    <span class="nt">ssh-private-key-folder-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;ssh-private-key-folder-path&gt;</span>
    <span class="nt">ssh-private-key-password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;ssh-private-key-password&gt;</span>
<span class="nt">continuous-integration</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:8085</span>
    <span class="nt">user</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">&lt;bamboo-admin-user&gt;</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;bamboo-admin-password&gt;</span>
    <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;bamboo-admin-token&gt;</span>   <span class="c1"># step 10.1</span>
    <span class="nt">vcs-application-link-name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LS1 Bitbucket Server</span>
    <span class="nt">empty-commit-necessary</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">artemis-authentication-token-value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;artemis-authentication-token-value&gt;</span>   <span class="c1"># step 7</span>
</pre></div>
</div>
</li>
<li><p>Modify the application-dev.yml</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
    <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>                                         <span class="c1"># The port of artemis</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://172.20.0.1:8080</span>                        <span class="c1"># needs to be an ip</span>
    <span class="nt">// url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://docker.for.mac.host.internal:8080</span>   <span class="c1"># If the above one does not work for mac try this one</span>
    <span class="nt">// url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://host.docker.internal:8080</span>           <span class="c1"># If the above one does not work for windows try this one</span>
</pre></div>
</div>
</li>
</ol>
<p>In addition, you have to start Artemis with the profiles <code class="docutils literal notranslate"><span class="pre">bamboo</span></code>,
<code class="docutils literal notranslate"><span class="pre">bitbucket</span></code> and <code class="docutils literal notranslate"><span class="pre">jira</span></code> so that the correct adapters will be used,
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">spring</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">active</span><span class="o">=</span><span class="n">dev</span><span class="p">,</span><span class="n">bamboo</span><span class="p">,</span><span class="n">bitbucket</span><span class="p">,</span><span class="n">jira</span><span class="p">,</span><span class="n">artemis</span><span class="p">,</span><span class="n">scheduling</span>
</pre></div>
</div>
<p>Please read <a class="reference internal" href="#server-setup"><span class="std std-ref">Server Setup</span></a> for more details.</p>
</section>
<section id="how-to-verify-the-connection-works">
<h3><a class="toc-backref" href="#id38">How to verify the connection works?</a><a class="headerlink" href="#how-to-verify-the-connection-works" title="Permalink to this heading"></a></h3>
<section id="artemis-jira">
<h4>Artemis → Jira<a class="headerlink" href="#artemis-jira" title="Permalink to this heading"></a></h4>
<p>You can login to Artemis with the admin user you created in Jira</p>
</section>
<section id="artemis-bitbucket">
<h4>Artemis → Bitbucket<a class="headerlink" href="#artemis-bitbucket" title="Permalink to this heading"></a></h4>
<p>You can create a programming exercise</p>
</section>
<section id="artemis-bamboo">
<h4>Artemis → Bamboo<a class="headerlink" href="#artemis-bamboo" title="Permalink to this heading"></a></h4>
<p>You can create a programming exercise</p>
</section>
<section id="bitbucket-bamboo">
<h4>Bitbucket → Bamboo<a class="headerlink" href="#bitbucket-bamboo" title="Permalink to this heading"></a></h4>
<p>The build of the students repository gets started after pushing to it</p>
</section>
<section id="bitbucket-artemis">
<h4>Bitbucket → Artemis<a class="headerlink" href="#bitbucket-artemis" title="Permalink to this heading"></a></h4>
<p>When using the code editor, after clicking on <em>Submit</em>, the text <em>Building and testing…</em> should appear.</p>
</section>
<section id="bamboo-artemis">
<h4>Bamboo → Artemis<a class="headerlink" href="#bamboo-artemis" title="Permalink to this heading"></a></h4>
<p>The build result is displayed in the code editor.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section id="jenkins-and-gitlab-setup">
<h2><a class="toc-backref" href="#id28">Jenkins and GitLab Setup</a><a class="headerlink" href="#jenkins-and-gitlab-setup" title="Permalink to this heading"></a></h2>
<p>This section describes how to set up a programming exercise environment
based on Jenkins and GitLab. Optional commands are in curly brackets <code class="docutils literal notranslate"><span class="pre">{}</span></code>.</p>
<p>The following assumes that all instances run on separate servers. If you
have one single server, or your own NGINX instance, just skip all NGINX
related steps and use the configurations provided under <em>Separate NGINX
Configurations</em></p>
<p><strong>If you want to setup everything on your local development computer,
ignore all NGINX related steps.</strong> <strong>Just make sure that you use
unique port mappings for your Docker containers (e.g.</strong> <code class="docutils literal notranslate"><span class="pre">8081</span></code> <strong>for
GitLab,</strong> <code class="docutils literal notranslate"><span class="pre">8082</span></code> <strong>for Jenkins,</strong> <code class="docutils literal notranslate"><span class="pre">8080</span></code> <strong>for Artemis)</strong></p>
<p><strong>Prerequisites:</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.docker.com/install">Docker</a></p></li>
</ul>
<blockquote>
<div><p>Make sure that docker has enough memory (~ 6GB). To adapt it, go to <code class="docutils literal notranslate"><span class="pre">Preferences</span> <span class="pre">-&gt;</span> <span class="pre">Resources</span></code> and restart Docker.</p>
</div></blockquote>
<div class="contents local topic" id="id2">
<p class="topic-title">Content of this section</p>
<ul class="simple">
<li><p><a class="reference internal" href="#artemis" id="id39">Artemis</a></p></li>
<li><p><a class="reference internal" href="#gitlab" id="id40">GitLab</a></p>
<ul>
<li><p><a class="reference internal" href="#gitlab-server-quickstart" id="id41">GitLab Server Quickstart</a></p></li>
<li><p><a class="reference internal" href="#manual-gitlab-server-setup" id="id42">Manual GitLab Server Setup</a></p>
<ul>
<li><p><a class="reference internal" href="#start-gitlab" id="id43">Start GitLab</a></p></li>
<li><p><a class="reference internal" href="#gitlab-access-token" id="id44">GitLab Access Token</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#upgrade-gitlab" id="id45">Upgrade GitLab</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#jenkins" id="id46">Jenkins</a></p>
<ul>
<li><p><a class="reference internal" href="#automated-jenkins-server-setup" id="id47">Automated Jenkins Server Setup</a></p></li>
<li><p><a class="reference internal" href="#manual-jenkins-server-setup" id="id48">Manual Jenkins Server Setup</a></p>
<ul>
<li><p><a class="reference internal" href="#start-jenkins" id="id49">Start Jenkins</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#required-jenkins-plugins" id="id50">Required Jenkins Plugins</a></p></li>
<li><p><a class="reference internal" href="#timestamper-configuration" id="id51">Timestamper Configuration</a></p></li>
<li><p><a class="reference internal" href="#server-notification-plugin" id="id52">Server Notification Plugin</a></p></li>
<li><p><a class="reference internal" href="#jenkins-credentials" id="id53">Jenkins Credentials</a></p>
<ul>
<li><p><a class="reference internal" href="#gitlab-api-token" id="id54">GitLab API Token</a></p></li>
<li><p><a class="reference internal" href="#server-notification-token" id="id55">Server Notification Token</a></p></li>
<li><p><a class="reference internal" href="#gitlab-repository-access" id="id56">GitLab Repository Access</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#gitlab-to-jenkins-push-notification-token" id="id57">GitLab to Jenkins push notification token</a></p></li>
<li><p><a class="reference internal" href="#upgrading-jenkins" id="id58">Upgrading Jenkins</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#build-agents" id="id59">Build agents</a></p>
<ul>
<li><p><a class="reference internal" href="#configuring-local-build-agents" id="id60">Configuring local build agents</a></p></li>
<li><p><a class="reference internal" href="#alternative-local-build-agents-setup-using-docker" id="id61">Alternative local build agents setup using docker</a></p></li>
<li><p><a class="reference internal" href="#installing-remote-build-agents" id="id62">Installing remote build agents</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#jenkins-user-management" id="id63">Jenkins User Management</a></p></li>
<li><p><a class="reference internal" href="#jenkins-build-plan-access-control-configuration" id="id64">Jenkins Build Plan Access Control Configuration</a></p></li>
<li><p><a class="reference internal" href="#caching" id="id65">Caching</a></p></li>
<li><p><a class="reference internal" href="#separate-nginx-configurations" id="id66">Separate NGINX Configurations</a></p>
<ul>
<li><p><a class="reference internal" href="#jenkins-1" id="id67">Jenkins</a></p></li>
<li><p><a class="reference internal" href="#etc-nginx-common-common-ssl-conf" id="id68">/etc/nginx/common/common_ssl.conf</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#deployment-artemis-gitlab-jenkins-using-docker-on-local-machine" id="id69">Deployment Artemis / GitLab / Jenkins using Docker on Local machine</a></p>
<ul>
<li><p><a class="reference internal" href="#preparation" id="id70">Preparation</a></p></li>
<li><p><a class="reference internal" href="#gitlab-1" id="id71">GitLab</a></p></li>
<li><p><a class="reference internal" href="#jenkins-2" id="id72">Jenkins</a></p></li>
<li><p><a class="reference internal" href="#artemis-1" id="id73">Artemis</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="artemis">
<h3><a class="toc-backref" href="#id39">Artemis</a><a class="headerlink" href="#artemis" title="Permalink to this heading"></a></h3>
<p>In order to use Artemis with Jenkins as <strong>Continuous Integration</strong>
Server and Gitlab as <strong>Version Control</strong> Server, you have to configure
the file <code class="docutils literal notranslate"><span class="pre">application-prod.yml</span></code> (Production Server) or
<code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> (Local Development) accordingly. Please note
that all values in <code class="docutils literal notranslate"><span class="pre">&lt;..&gt;</span></code> have to be configured properly. These values
will be explained below in the corresponding sections. If you want to set up a local environment, copy the values
below into your <code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code> file (the latter is recommended), and follow
the <a class="reference external" href="#gitlab-server-quickstart">Gitlab Server Quickstart</a> guide.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
 <span class="nt">course-archives-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./exports/courses</span>
 <span class="nt">repo-clone-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./repos</span>
 <span class="nt">repo-download-clone-path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./repos-download</span>
 <span class="nt">encryption-password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>           <span class="c1"># LEGACY: arbitrary password for encrypting database values</span>
 <span class="nt">bcrypt-salt-rounds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">11</span>  <span class="c1"># The number of salt rounds for the bcrypt password hashing. Lower numbers make it faster but more unsecure and vice versa.</span>
                         <span class="c1"># Please use the bcrypt benchmark tool to determine the best number of rounds for your system. https://github.com/ls1intum/bcrypt-Benchmark</span>
 <span class="nt">user-management</span><span class="p">:</span>
     <span class="nt">use-external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
     <span class="nt">internal-admin</span><span class="p">:</span>
         <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
         <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
     <span class="nt">accept-terms</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
     <span class="nt">login</span><span class="p">:</span>
         <span class="nt">account-name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TUM</span>
 <span class="nt">version-control</span><span class="p">:</span>
     <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:8081</span>
     <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
     <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span> <span class="c1"># created in Gitlab Server Quickstart step 2</span>
     <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis-gitlab-token</span> <span class="c1"># generated in Gitlab Server Quickstart steps 4 and 5</span>
     <span class="nt">ci-token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jenkins-secret-token</span> <span class="c1"># generated in Jenkins Server Quickstart step 8</span>
 <span class="nt">continuous-integration</span><span class="p">:</span>
     <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
     <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
     <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:8082</span>
     <span class="nt">empty-commit-necessary</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
     <span class="nt">secret-push-token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AQAAABAAAAAg/aKNFWpF9m2Ust7VHDKJJJvLkntkaap2Ka3ZBhy5XjRd8s16vZhBz4fxzd4TH8Su</span> <span class="c1"># generated in Automated Jenkins Server step 3</span>
     <span class="nt">vcs-credentials</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_gitlab_admin_credentials</span>
     <span class="nt">artemis-authentication-token-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_notification_plugin_token</span>
     <span class="nt">artemis-authentication-token-value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
     <span class="nt">build-timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
 <span class="nt">git</span><span class="p">:</span>
     <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Artemis</span>
     <span class="nt">email</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis.in@tum.de</span>
<span class="nt">jenkins</span><span class="p">:</span>
    <span class="nt">internal-urls</span><span class="p">:</span>
        <span class="nt">ci-url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://jenkins:8080</span>
        <span class="nt">vcs-url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://gitlab:80</span>
    <span class="nt">use-crumb</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="nt">server</span><span class="p">:</span>
     <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
     <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://172.17.0.1:8080</span> <span class="c1"># `http://host.docker.internal:8080` for Windows</span>
</pre></div>
</div>
<p>In addition, you have to start Artemis with the profiles <code class="docutils literal notranslate"><span class="pre">gitlab</span></code> and
<code class="docutils literal notranslate"><span class="pre">jenkins</span></code> so that the correct adapters will be used, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">spring</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">active</span><span class="o">=</span><span class="n">dev</span><span class="p">,</span><span class="n">jenkins</span><span class="p">,</span><span class="n">gitlab</span><span class="p">,</span><span class="n">artemis</span><span class="p">,</span><span class="n">scheduling</span>
</pre></div>
</div>
<p>Please read <a class="reference internal" href="#server-setup"><span class="std std-ref">Server Setup</span></a> for more details.</p>
<p>For a local setup on Windows you can use <cite>http://host.docker.internal</cite> appended
by the chosen ports as the version-control and continuous-integration url.</p>
<p>Make sure to change the <code class="docutils literal notranslate"><span class="pre">server.url</span></code> value in <code class="docutils literal notranslate"><span class="pre">application-dev.yml</span></code>
or <code class="docutils literal notranslate"><span class="pre">application-prod.yml</span></code> accordingly. This value will be used for the
communication hooks from GitLab to Artemis and from Jenkins to Artemis.
In case you use a different port than 80 (http) or 443 (https) for the
communication, you have to append it to the <code class="docutils literal notranslate"><span class="pre">server.url</span></code> value,
e.g. <code class="docutils literal notranslate"><span class="pre">127.0.0.1:8080</span></code>.</p>
<p>When you start Artemis for the first time, it will automatically create
an admin user.</p>
<p><strong>Note:</strong> Sometimes Artemis does not generate the admin user which may lead to a startup
error. You will have to create the user manually in the MySQL database and in GitLab. Make sure
both are set up correctly and follow these steps:</p>
<ol class="arabic">
<li><p>Use the tool mentioned above to generate a password hash.</p></li>
<li><p>Connect to the database via a client like <a class="reference external" href="https://dev.mysql.com/downloads/workbench/">MySQL Workbench</a>
and execute the following query to create the user. Replace <cite>artemis_admin</cite> and <cite>HASHED_PASSWORD</cite> with your
chosen username and password:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">artemis</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">jhi_user</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">login</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">password_hash</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">first_name</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">last_name</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">email</span><span class="o">`</span><span class="p">,</span>
<span class="o">`</span><span class="n">activated</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">lang_key</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">activation_key</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">reset_key</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">created_by</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">created_date</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">reset_date</span><span class="o">`</span><span class="p">,</span>
<span class="o">`</span><span class="n">last_modified_by</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">last_modified_date</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">image_url</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">last_notification_read</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">registration_number</span><span class="o">`</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="ss">&quot;artemis_admin&quot;</span><span class="p">,</span><span class="ss">&quot;HASHED_PASSWORD&quot;</span><span class="p">,</span><span class="ss">&quot;artemis&quot;</span><span class="p">,</span><span class="ss">&quot;administrator&quot;</span><span class="p">,</span><span class="ss">&quot;artemis_admin@localhost&quot;</span><span class="p">,</span>
<span class="mi">1</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">,</span><span class="k">NULL</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Give the user admin and user roles:</p>
<blockquote>
<div><div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">artemis</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">jhi_user_authority</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">user_id</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">authority_name</span><span class="o">`</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="ss">&quot;ROLE_ADMIN&quot;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="o">`</span><span class="n">artemis</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">jhi_user_authority</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">user_id</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">authority_name</span><span class="o">`</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="ss">&quot;ROLE_USER&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>4. Create a user in Gitlab (<code class="docutils literal notranslate"><span class="pre">http://your-gitlab-domain/admin/users/new</span></code>) and make sure that the username,
email, and password are the same as the user from the database:</p>
<figure class="align-default">
<img alt="../../_images/gitlab_admin_user.png" src="../../_images/gitlab_admin_user.png" />
</figure>
<p>Starting the Artemis server should now succeed.</p>
</section>
<section id="gitlab">
<h3><a class="toc-backref" href="#id40">GitLab</a><a class="headerlink" href="#gitlab" title="Permalink to this heading"></a></h3>
<section id="gitlab-server-quickstart">
<h4><a class="toc-backref" href="#id41">GitLab Server Quickstart</a><a class="headerlink" href="#gitlab-server-quickstart" title="Permalink to this heading"></a></h4>
<p>The following steps describes how to set up the GitLab server in a semi-automated way.
This is ideal as a quickstart for developers. For a more detailed setup, see
<a class="reference external" href="#manual-gitlab-server-setup">Manual Gitlab Server Setup</a>.
In a production setup, you have to at least change the root password (by either specifying it in step 1 or extracting
the random password in step 2) and generate random access tokens (instead of the pre-defined values).
Set the variable <code class="docutils literal notranslate"><span class="pre">GENERATE_ACCESS_TOKENS</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> in the <code class="docutils literal notranslate"><span class="pre">gitlab-local-setup.sh</span></code> script and use the generated
tokens instead of the predefined ones.</p>
<ol class="arabic">
<li><p>Start the GitLab container defined in <cite>src/main/docker/gitlab-jenkins-mysql.yml</cite> by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GITLAB_ROOT_PASSWORD</span><span class="o">=</span><span class="n">artemis_admin</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">jenkins</span><span class="o">-</span><span class="n">mysql</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span> <span class="o">--</span><span class="n">build</span> <span class="o">-</span><span class="n">d</span> <span class="n">gitlab</span>
</pre></div>
</div>
<p>If you want to generate a random password for the <code class="docutils literal notranslate"><span class="pre">root</span></code> user, remove the part before <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> from
the command.</p>
<p>The file uses the <code class="docutils literal notranslate"><span class="pre">GITLAB_OMNIBUS_CONFIG</span></code> environment variable to configure the Gitlab instance after the container
is started.
It disables prometheus monitoring, sets the ssh port to <code class="docutils literal notranslate"><span class="pre">2222</span></code>, and adjusts the monitoring endpoint whitelist
by default.</p>
</li>
<li><p>Wait a couple of minutes since GitLab can take some time to set up. Open the instance in your browser
(usually <code class="docutils literal notranslate"><span class="pre">http://localhost:8081</span></code>).</p>
<p>You can then login using the username <code class="docutils literal notranslate"><span class="pre">root</span></code> and your password (which defaults to <code class="docutils literal notranslate"><span class="pre">artemis_admin</span></code>,
if you used the command from above).
If you did not specify the password, you can get the initial one using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose -f src/main/docker/gitlab-jenkins-mysql.yml <span class="nb">exec</span> gitlab cat /etc/gitlab/initial_root_password
</pre></div>
</div>
</li>
<li><p>Insert the GitLab root user password in the file <code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code> (in src/main/resources) and insert
the GitLab admin account.
If you copied the template from above and used the default password, this is already done for you.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">version-control</span><span class="p">:</span>
        <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:8081</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">your.gitlab.admin.password</span> <span class="c1"># artemis_admin</span>
</pre></div>
</div>
</li>
<li><p>You now need to create an admin access token. You can do that using the following command (which takes a while
to execute):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">jenkins</span><span class="o">-</span><span class="n">mysql</span><span class="o">.</span><span class="n">yml</span> <span class="n">exec</span> <span class="n">gitlab</span> <span class="n">gitlab</span><span class="o">-</span><span class="n">rails</span> <span class="n">runner</span> <span class="s2">&quot;token = User.find_by_username(&#39;root&#39;).personal_access_tokens.create(scopes: [:api, :read_user, :read_api, :read_repository, :write_repository, :sudo], name: &#39;Artemis Admin Token&#39;); token.set_token(&#39;artemis-gitlab-token&#39;); token.save!&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">You can also manually create in by navigating to <code class="docutils literal notranslate"><span class="pre">http://localhost:8081/-/profile/personal_access_tokens</span></code> and
generate a token with all scopes.</div>
<div class="line">Copy this token into the <code class="docutils literal notranslate"><span class="pre">ADMIN_PERSONAL_ACCESS_TOKEN</span></code> field in the
<code class="docutils literal notranslate"><span class="pre">src/main/docker/gitlab/gitlab-local-setup.sh</span></code> file.</div>
<div class="line">If you used the command to generate the token, you don’t have to change the <code class="docutils literal notranslate"><span class="pre">gitlab-local-setup.sh</span></code> file.</div>
</div>
</li>
<li><p>Adjust the GitLab setup by running, this will configure GitLab’s network setting to allow local requests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">jenkins</span><span class="o">-</span><span class="n">mysql</span><span class="o">.</span><span class="n">yml</span> <span class="n">exec</span> <span class="n">gitlab</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;sh /gitlab-local-setup.sh&quot;</span>
</pre></div>
</div>
<p>This script can also generate random access tokens, which should be used in a production setup. Change the
variable <code class="docutils literal notranslate"><span class="pre">$GENERATE_ACCESS_TOKENS</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> to generate the random tokens and insert them into the Artemis
configuration file.</p>
</li>
<li><p>You’re done! Follow the <a class="reference external" href="#automated-jenkins-server-setup">Automated Jenkins Server Setup</a> section for
configuring Jenkins.</p></li>
</ol>
</section>
<section id="manual-gitlab-server-setup">
<h4><a class="toc-backref" href="#id42">Manual GitLab Server Setup</a><a class="headerlink" href="#manual-gitlab-server-setup" title="Permalink to this heading"></a></h4>
<p>GitLab provides no possibility to set a users password via API without forcing the user to change it afterwards
(see <a class="reference external" href="https://gitlab.com/gitlab-org/gitlab/-/issues/19141">Issue 19141</a>).
Therefore, you may want to patch the official gitlab docker image.
Thus, you can use the following Dockerfile:</p>
<div class="highlight-dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">gitlab/gitlab-ce:latest</span>
<span class="k">RUN</span> sed -i <span class="s1">&#39;/^.*user_params\[:password_expires_at\] = Time.current if admin_making_changes_for_another_user.*$/s/^/#/&#39;</span> /opt/gitlab/embedded/service/gitlab-rails/lib/api/users.rb
</pre></div>
</div>
<p>This Dockerfile disables the mechanism that sets the password to expired state after changed via API.
If you want to use this custom image, you have to build the image and replace all occurrences of
<code class="docutils literal notranslate"><span class="pre">gitlab/gitlab-ce:latest</span></code> in the following instructions by your chosen image name.</p>
<ol class="arabic">
<li><p>Pull the latest GitLab Docker image (only if you don’t use your custom gitlab image)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">gitlab</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">ce</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</li>
</ol>
<section id="start-gitlab">
<h5><a class="toc-backref" href="#id43">Start GitLab</a><a class="headerlink" href="#start-gitlab" title="Permalink to this heading"></a></h5>
<ol class="arabic" start="2">
<li><p>Run the image (and change the values for hostname and ports). Add
<code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">2222:22</span></code> if cloning/pushing via ssh should be possible. As
GitLab runs in a docker container and the default port for SSH (22)
is typically used by the host running Docker, we change the port
GitLab uses for SSH to <code class="docutils literal notranslate"><span class="pre">2222</span></code>. This can be adjusted if needed.</p>
<p>Make sure to remove the comments from the command before running it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">itd</span> <span class="o">--</span><span class="n">name</span> <span class="n">gitlab</span> \
    <span class="o">--</span><span class="n">hostname</span> <span class="n">your</span><span class="o">.</span><span class="n">gitlab</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">com</span> \   <span class="c1"># Specify the hostname</span>
    <span class="o">--</span><span class="n">restart</span> <span class="n">always</span> \
    <span class="o">-</span><span class="n">m</span> <span class="mi">3000</span><span class="n">m</span> \                            <span class="c1"># Optional argument to limit the memory usage of Gitlab</span>
    <span class="o">-</span><span class="n">p</span> <span class="mi">8081</span><span class="p">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">p</span> <span class="mi">443</span><span class="p">:</span><span class="mi">443</span> \               <span class="c1"># Alternative 1: If you are NOT running your own NGINX instance</span>
    <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">some</span> <span class="n">port</span> <span class="n">of</span> <span class="n">your</span> <span class="n">choosing</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">80</span> \  <span class="c1"># Alternative 2: If you ARE running your own NGINX instance</span>
    <span class="o">-</span><span class="n">p</span> <span class="mi">2222</span><span class="p">:</span><span class="mi">22</span> \                          <span class="c1"># Remove this if cloning via SSH should not be supported</span>
    <span class="o">-</span><span class="n">v</span> <span class="n">gitlab_data</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">gitlab</span> \
    <span class="o">-</span><span class="n">v</span> <span class="n">gitlab_logs</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">gitlab</span> \
    <span class="o">-</span><span class="n">v</span> <span class="n">gitlab_config</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">gitlab</span> \
    <span class="n">gitlab</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">ce</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</li>
<li><p>Wait a couple of minutes until the container is deployed and GitLab
is set up, then open the instance in you browser.
You can get the initial password for the <code class="docutils literal notranslate"><span class="pre">root</span></code> user using
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">gitlab</span> <span class="pre">cat</span> <span class="pre">/etc/gitlab/initial_root_password</span></code>.</p></li>
<li><p>We recommend to rename the <code class="docutils literal notranslate"><span class="pre">root</span></code> admin user to <code class="docutils literal notranslate"><span class="pre">artemis</span></code>. To rename
the user, click on the image on the top right and select <code class="docutils literal notranslate"><span class="pre">Settings</span></code>.
Now select <code class="docutils literal notranslate"><span class="pre">Account</span></code> on the left and change the username. Use the
same password in the Artemis configuration file
<code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">version-control</span><span class="p">:</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">the.password.you.chose</span>
</pre></div>
</div>
</li>
<li><p><strong>If you run your own NGINX or if you install Gitlab on a local development computer, then skip the next steps (6-7)</strong></p></li>
<li><p>Configure GitLab to automatically generate certificates using
LetsEncrypt. Edit the GitLab configuration</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">gitlab</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">gitlab</span><span class="o">/</span><span class="n">gitlab</span><span class="o">.</span><span class="n">rb</span>
</pre></div>
</div>
<p>And add the following part</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">letsencrypt</span><span class="p">[</span><span class="s1">&#39;enable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">true</span>                          <span class="c1"># GitLab 10.5 and 10.6 require this option</span>
<span class="n">external_url</span> <span class="s2">&quot;https://your.gitlab.domain.com&quot;</span>         <span class="c1"># Must use https protocol</span>
<span class="n">letsencrypt</span><span class="p">[</span><span class="s1">&#39;contact_emails&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gitlab@your.gitlab.domain.com&#39;</span><span class="p">]</span> <span class="c1"># Optional</span>

<span class="n">nginx</span><span class="p">[</span><span class="s1">&#39;redirect_http_to_https&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">nginx</span><span class="p">[</span><span class="s1">&#39;redirect_http_to_https_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span>
</pre></div>
</div>
</li>
<li><p>Reconfigure GitLab to generate the certificate.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save your changes and finally run</span>
<span class="n">gitlab</span><span class="o">-</span><span class="n">ctl</span> <span class="n">reconfigure</span>
</pre></div>
</div>
<p>If this command fails, try using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gitlab</span><span class="o">-</span><span class="n">ctl</span> <span class="n">renew</span><span class="o">-</span><span class="n">le</span><span class="o">-</span><span class="n">certs</span>
</pre></div>
</div>
</li>
<li><p>Login to GitLab using the Artemis admin account and go to the profile
settings (upper right corned → <em>Settings</em>)</p>
<figure class="align-center">
<img alt="../../_images/gitlab_setting_button.png" src="../../_images/gitlab_setting_button.png" />
</figure>
</li>
</ol>
</section>
<section id="gitlab-access-token">
<h5><a class="toc-backref" href="#id44">GitLab Access Token</a><a class="headerlink" href="#gitlab-access-token" title="Permalink to this heading"></a></h5>
<ol class="arabic simple" start="9">
<li><p>Go to <em>Access Tokens</em></p></li>
</ol>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/gitlab_access_tokens_button.png" src="../../_images/gitlab_access_tokens_button.png" />
</figure>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>Create a new token named “Artemis” and give it <strong>all</strong> rights.</p></li>
</ol>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/artemis_gitlab_access_token.png" src="../../_images/artemis_gitlab_access_token.png" />
</figure>
</div></blockquote>
<ol class="arabic" start="11">
<li><p>Copy the generated token and insert it into the Artemis
configuration file <em>application-artemis.yml</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">version-control</span><span class="p">:</span>
        <span class="nt">token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">your.generated.api.token</span>
</pre></div>
</div>
</li>
<li><p>(Optional, only necessary for local setup) Allow outbound requests to local network</p>
<p>There is a known limitation for the local setup: webhook URLs for the
communication between GitLab and Artemis and between GitLab and Jenkins
cannot include local IP addresses. This option can be deactivated in
GitLab on <code class="docutils literal notranslate"><span class="pre">&lt;https://gitlab-url&gt;/admin/application_settings/network</span></code> →
Outbound requests. Another possible solution is to register a local URL,
e.g. using <a class="reference external" href="https://ngrok.com/">ngrok</a>, to be available over a domain
the Internet.</p>
</li>
<li><p>Adjust the monitoring-endpoint whitelist. Run the following command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">gitlab</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<p>Then edit the GitLab configuration</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">gitlab</span><span class="o">/</span><span class="n">gitlab</span><span class="o">.</span><span class="n">rb</span>
</pre></div>
</div>
<p>Add the following lines</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gitlab_rails</span><span class="p">[</span><span class="s1">&#39;monitoring_whitelist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0.0.0.0/0&#39;</span><span class="p">]</span>
<span class="n">gitlab_rails</span><span class="p">[</span><span class="s1">&#39;gitlab_shell_ssh_port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2222</span>
</pre></div>
</div>
<p>This will disable the firewall for all IP addresses. If you only want to
allow the server that runs Artemis to query the information, replace
<code class="docutils literal notranslate"><span class="pre">0.0.0.0/0</span></code> with <code class="docutils literal notranslate"><span class="pre">ARTEMIS.SERVER.IP.ADRESS/32</span></code></p>
<p>If you use SSH and use a different port than <code class="docutils literal notranslate"><span class="pre">2222</span></code>, you have to
adjust the port above.</p>
</li>
<li><p>Disable prometheus.
As we encountered issues with the Prometheus log files not being deleted and therefore filling up the disk space,
we decided to disable Prometheus within GitLab.
If you also want to disable prometheus, edit the configuration again using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">gitlab</span><span class="o">/</span><span class="n">gitlab</span><span class="o">.</span><span class="n">rb</span>
</pre></div>
</div>
<p>and add the following line</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prometheus_monitoring</span><span class="p">[</span><span class="s1">&#39;enable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">false</span>
</pre></div>
</div>
<p>The issue with more details can be found <a class="reference external" href="https://gitlab.com/gitlab-org/omnibus-gitlab/-/issues/4166">here</a>.</p>
</li>
<li><p>Add a SSH key for the admin user.</p>
<p>Artemis can clone/push the repositories during setup and for the online code editor using SSH.
If the SSH key is not present, the username + token will be used as fallback (and all git operations will use
HTTP(S) instead of SSH).</p>
<p>You first have to create a SSH key (locally), e.g. using <code class="docutils literal notranslate"><span class="pre">ssh-keygen</span></code> (more information on how to create a SSH
key can be found e.g. at <a class="reference external" href="https://www.ssh.com/ssh/keygen/">ssh.com</a> or
at <a class="reference external" href="https://docs.gitlab.com/ee/ssh/#rsa-ssh-keys">gitlab.com</a>).</p>
<p>The list of supported ciphers can be found at <a class="reference external" href="https://github.com/apache/mina-sshd">Apache Mina</a>.</p>
<p>It is recommended to use a password to secure the private key, but it is not mandatory.</p>
<p>Please note that the private key file <strong>must</strong> be named <code class="docutils literal notranslate"><span class="pre">ìd_rsa</span></code>, <code class="docutils literal notranslate"><span class="pre">id_dsa</span></code>, <code class="docutils literal notranslate"><span class="pre">id_ecdsa</span></code> or <code class="docutils literal notranslate"><span class="pre">id_ed25519</span></code>,
depending on the ciphers used.</p>
<p>You now have to extract the public key and add it to GitLab.
Open the public key file (usually called <code class="docutils literal notranslate"><span class="pre">id_rsa.pub</span></code> (when using RSA)) and copy it’s content (you can also
use <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">id_rsa.pub</span></code> to show the public key).</p>
<p>Navigate to <code class="docutils literal notranslate"><span class="pre">GITLAB-URL/-/profile/keys</span></code> and add the SSH key by pasting the content of the public key.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;ssh-key-path&gt;</span></code> is the path to the folder containing the <code class="docutils literal notranslate"><span class="pre">id_rsa</span></code> file (but without the filename). It will
be used in the configuration of Artemis to specify where Artemis should look for the key and store
the <code class="docutils literal notranslate"><span class="pre">known_hosts</span></code> file.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;ssh-private-key-password&gt;</span></code> is the password used to secure the private key. It is also needed for the
configuration of Artemis, but can be omitted if no password was set (e.g. for development environments).</p>
</li>
</ol>
<p>Reconfigure GitLab</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gitlab</span><span class="o">-</span><span class="n">ctl</span> <span class="n">reconfigure</span>
</pre></div>
</div>
</section>
</section>
<section id="upgrade-gitlab">
<h4><a class="toc-backref" href="#id45">Upgrade GitLab</a><a class="headerlink" href="#upgrade-gitlab" title="Permalink to this heading"></a></h4>
<p>You can upgrade GitLab by downloading the latest Docker image and
starting a new container with the old volumes:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">stop</span> <span class="n">gitlab</span>
<span class="n">docker</span> <span class="n">rename</span> <span class="n">gitlab</span> <span class="n">gitlab_old</span>
<span class="n">docker</span> <span class="n">pull</span> <span class="n">gitlab</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">ce</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</div></blockquote>
<p>See <a class="reference external" href="https://hub.docker.com/r/gitlab/gitlab-ce/">https://hub.docker.com/r/gitlab/gitlab-ce/</a> for the latest version.
You can also specify an earlier one.</p>
<p>Note that <strong>upgrading to a major version</strong> may require following an upgrade path. You can view supported paths
<a class="reference external" href="https://docs.gitlab.com/ee/update/#upgrade-paths">here</a>.</p>
<p>Start a GitLab container just as described in <a class="reference external" href="#start-gitlab">Start-Gitlab</a> and wait for a couple of minutes. GitLab
should configure itself automatically. If there are no issues, you can
delete the old container using <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">rm</span> <span class="pre">gitlab_old</span></code> and the olf
image (see <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">images</span></code>) using <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">rmi</span> <span class="pre">&lt;old-image-id&gt;</span></code>.
You can also remove all old images using <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">image</span> <span class="pre">prune</span> <span class="pre">-a</span></code></p>
</section>
</section>
<section id="jenkins">
<h3><a class="toc-backref" href="#id46">Jenkins</a><a class="headerlink" href="#jenkins" title="Permalink to this heading"></a></h3>
<section id="automated-jenkins-server-setup">
<h4><a class="toc-backref" href="#id47">Automated Jenkins Server Setup</a><a class="headerlink" href="#automated-jenkins-server-setup" title="Permalink to this heading"></a></h4>
<p>The following steps describe how to deploy a pre-configured version of the Jenkins server.
This is ideal as a quickstart for developers. For a more detailed setup, see
<a class="reference external" href="#manual-jenkins-server-setup">Manual Jenkins Server Setup</a>.
In a production setup, you have to at least change the user credentials (in the file <code class="docutils literal notranslate"><span class="pre">jenkins-casc-config.yml</span></code>) and
generate random access tokens and push tokens.</p>
<p>1. Create a new access token in GitLab named <code class="docutils literal notranslate"><span class="pre">Jenkins</span></code> and give it <strong>api</strong> and <strong>read_repository</strong> rights. You can
do either do it manually or using the following command:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">jenkins</span><span class="o">-</span><span class="n">mysql</span><span class="o">.</span><span class="n">yml</span> <span class="n">exec</span> <span class="n">gitlab</span> <span class="n">gitlab</span><span class="o">-</span><span class="n">rails</span> <span class="n">runner</span> <span class="s2">&quot;token = User.find_by_username(&#39;root&#39;).personal_access_tokens.create(scopes: [:api, :read_repository], name: &#39;Jenkins&#39;); token.set_token(&#39;jenkins-gitlab-token&#39;); token.save!&quot;</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p>You can now deploy Jenkins. A <code class="docutils literal notranslate"><span class="pre">src/main/docker/gitlab-jenkins-mysql.yml</span></code> file is provided which deploys the
Jenkins, GitLab, and Mysql containers bound to static ip addresses. You can deploy them by running:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">JAVA_OPTS</span><span class="o">=-</span><span class="n">Djenkins</span><span class="o">.</span><span class="n">install</span><span class="o">.</span><span class="n">runSetupWizard</span><span class="o">=</span><span class="n">false</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">jenkins</span><span class="o">-</span><span class="n">mysql</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span> <span class="o">--</span><span class="n">build</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</div></blockquote>
<p>Jenkins is then reachable under <code class="docutils literal notranslate"><span class="pre">http://localhost:8082/</span></code> and you can login using the credentials specified
in <code class="docutils literal notranslate"><span class="pre">jenkins-casc-config.yml</span></code> (defaults to <code class="docutils literal notranslate"><span class="pre">artemis_admin</span></code> as both username and password).</p>
</li>
<li><p>You need to generate the <cite>ci-token</cite> and <cite>secret-push-token</cite>.
If you used the preset <code class="docutils literal notranslate"><span class="pre">master.key</span></code> within the file <code class="docutils literal notranslate"><span class="pre">gitlab-jenkins-mysql.yml</span></code>, you can skip this step.
In a production setup, you should use a random <code class="docutils literal notranslate"><span class="pre">master.key</span></code>, then you have to follow the steps described in
<a class="reference external" href="#gitlab-to-jenkins-push-notification-token">Gitlab to Jenkins push notification token</a> to generate the token.</p></li>
<li><p>The <cite>application-local.yml</cite> must be adapted with the values configured in <code class="docutils literal notranslate"><span class="pre">jenkins-casc-config.yml</span></code>:
If you used the preset <code class="docutils literal notranslate"><span class="pre">master.key</span></code> and are running a development setup, the secrets can be found in the
<a class="reference external" href="#artemis">artemis configuration template posted at the beginning of this page</a>.</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">user-management</span><span class="p">:</span>
        <span class="nt">use-external</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
        <span class="nt">internal-admin</span><span class="p">:</span>
            <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
            <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis-admin</span>
    <span class="nt">version-control</span><span class="p">:</span>
        <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:8081</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
        <span class="nt">ci-token</span><span class="p">:</span> <span class="c1"># generated in step 9</span>
    <span class="nt">continuous-integration</span><span class="p">:</span>
        <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:8082</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
        <span class="nt">vcs-credentials</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_gitlab_admin_credentials</span>
        <span class="nt">artemis-authentication-token-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_notification_plugin_token</span>
        <span class="nt">artemis-authentication-token-value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">artemis_admin</span>
        <span class="nt">secret-push-token</span><span class="p">:</span> <span class="c1"># generated in step 3</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Open the <code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-jenkins.yml</span></code> and change the following:
Again, if you are using a development setup, the template in the beginning of this page already contains the
correct values.</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jenkins</span><span class="p">:</span>
    <span class="nt">internal-urls</span><span class="p">:</span>
        <span class="nt">ci-url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://jenkins:8080</span>
        <span class="nt">vcs-url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://gitlab:80</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>You’re done. You can now run Artemis with the GitLab/Jenkins environment.</p></li>
</ol>
</section>
<section id="manual-jenkins-server-setup">
<h4><a class="toc-backref" href="#id48">Manual Jenkins Server Setup</a><a class="headerlink" href="#manual-jenkins-server-setup" title="Permalink to this heading"></a></h4>
<ol class="arabic">
<li><p>Pull the latest Jenkins LTS Docker image</p>
<p>Run the following command to get the latest jenkins LTS docker image.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">jenkins</span><span class="o">/</span><span class="n">jenkins</span><span class="p">:</span><span class="n">lts</span>
</pre></div>
</div>
</li>
<li><p>Create a custom docker image</p>
<p>In order to install and use Maven with Java in the Jenkins container,
you have to first install maven, then download Java and finally
configure Maven to use Java instead of the default version.
You also need to install Swift and SwiftLint if you want to be able to
create Swift programming exercises.</p>
<p>To perform all these steps automatically, you can prepare a Docker
image:</p>
<p>Create a Dockerfile with the content found <cite>here &lt;src/main/docker/jenkins/Dockerfile&gt;</cite>
or <cite>here &lt;src/main/docker/jenkins/swift/Dockerfile&gt;</cite> in case you want to additionally
install Swift/SwiftLint.
Copy it in a file named <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code>, e.g. in
the folder <code class="docutils literal notranslate"><span class="pre">/opt/jenkins/</span></code> using <code class="docutils literal notranslate"><span class="pre">vim</span> <span class="pre">Dockerfile</span></code>.</p>
<p>Now run the command <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span> <span class="pre">--no-cache</span> <span class="pre">-t</span> <span class="pre">jenkins-artemis</span> <span class="pre">.</span></code></p>
<p>This might take a while because Docker will download Java, but this
is only required once.</p>
</li>
<li><p><strong>If you run your own NGINX or if you install Jenkins on a local development computer, then skip the next steps (4-7)</strong></p></li>
<li><p>Create a file increasing the maximum file size for the nginx proxy.
The nginx-proxy uses a default file limit that is too small for the
plugin that will be uploaded later. <strong>Skip this step if you have your
own NGINX instance.</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;client_max_body_size 16m;&quot;</span> <span class="o">&gt;</span> <span class="n">client_max_body_size</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</li>
<li><p>The NGINX default timeout is pretty low. For plagiarism check and unlocking student repos for the exam a higher
timeout is advisable. Therefore we write our own nginx.conf and load it in the container.</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
<span class="k">worker_processes</span>  <span class="s">auto</span><span class="p">;</span>

<span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">warn</span><span class="p">;</span>
<span class="k">pid</span>        <span class="s">/var/run/nginx.pid</span><span class="p">;</span>


<span class="k">events</span> <span class="p">{</span>
    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">http</span> <span class="p">{</span>
    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>

    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&quot;</span><span class="nv">$request&quot;</span> <span class="s">&#39;</span>
                      <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&quot;</span><span class="nv">$http_referer&quot;</span> <span class="s">&#39;</span>
                      <span class="s">&#39;&quot;</span><span class="nv">$http_user_agent&quot;</span> <span class="s">&quot;</span><span class="nv">$http_x_forwarded_for&quot;&#39;</span><span class="p">;</span>

    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>

    <span class="kn">fastcgi_read_timeout</span> <span class="mi">300</span><span class="p">;</span>
    <span class="kn">proxy_read_timeout</span> <span class="mi">300</span><span class="p">;</span>

    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
    <span class="c1">#tcp_nopush     on;</span>

    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>

    <span class="c1">#gzip  on;</span>

    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">daemon</span> <span class="no">off</span>
</pre></div>
</div>
</li>
<li><p>Run the NGINX proxy docker container, this will automatically setup
all reverse proxies and force https on all connections. (This image
would also setup proxies for all other running containers that have
the VIRTUAL_HOST and VIRTUAL_PORT environment variables). <strong>Skip this
step if you have your own NGINX instance.</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker run -itd --name nginx_proxy \
    -p 80:80 -p 443:443 \
    --restart always \
    -v /var/run/docker.sock:/tmp/docker.sock:ro \
    -v /etc/nginx/certs \
    -v /etc/nginx/vhost.d \
    -v /usr/share/nginx/html \
    -v $(pwd)/client_max_body_size.conf:/etc/nginx/conf.d/client_max_body_size.conf:ro \
    -v $(pwd)/nginx.conf:/etc/nginx/nginx.conf:ro \
    jwilder/nginx-proxy
</pre></div>
</div>
</li>
<li><p>The nginx proxy needs another docker-container to generate
letsencrypt certificates. Run the following command to start it (make
sure to change the email-address). <strong>Skip this step if you have your
own NGINX instance.</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">detach</span> \
    <span class="o">--</span><span class="n">name</span> <span class="n">nginx_proxy</span><span class="o">-</span><span class="n">letsencrypt</span> \
    <span class="o">--</span><span class="n">volumes</span><span class="o">-</span><span class="kn">from</span> <span class="nn">nginx_proxy</span> \
    <span class="o">--</span><span class="n">volume</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span><span class="n">ro</span> \
    <span class="o">--</span><span class="n">env</span> <span class="s2">&quot;DEFAULT_EMAIL=mail@yourdomain.tld&quot;</span> \
    <span class="n">jrcs</span><span class="o">/</span><span class="n">letsencrypt</span><span class="o">-</span><span class="n">nginx</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="n">companion</span>
</pre></div>
</div>
</li>
</ol>
<section id="start-jenkins">
<h5><a class="toc-backref" href="#id49">Start Jenkins</a><a class="headerlink" href="#start-jenkins" title="Permalink to this heading"></a></h5>
<ol class="arabic" start="8">
<li><p>Run Jenkins by executing the following command (change the hostname
and choose which port alternative you need)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">itd</span> <span class="o">--</span><span class="n">name</span> <span class="n">jenkins</span> \
    <span class="o">--</span><span class="n">restart</span> <span class="n">always</span> \
    <span class="o">-</span><span class="n">v</span> <span class="n">jenkins_data</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">jenkins_home</span> \
    <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span> \
    <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">docker</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">docker</span><span class="p">:</span><span class="n">ro</span> \
    <span class="o">-</span><span class="n">e</span> <span class="n">VIRTUAL_HOST</span><span class="o">=</span><span class="n">your</span><span class="o">.</span><span class="n">jenkins</span><span class="o">.</span><span class="n">domain</span> <span class="o">-</span><span class="n">e</span> <span class="n">VIRTUAL_PORT</span><span class="o">=</span><span class="mi">8080</span> \    <span class="c1"># Alternative 1: If you are NOT using a separate NGINX instance</span>
    <span class="o">-</span><span class="n">e</span> <span class="n">LETSENCRYPT_HOST</span><span class="o">=</span><span class="n">your</span><span class="o">.</span><span class="n">jenkins</span><span class="o">.</span><span class="n">domain</span> \                     <span class="c1"># Only needed if Alternative 1 is used</span>
    <span class="o">-</span><span class="n">p</span> <span class="mi">8082</span><span class="p">:</span><span class="mi">8080</span> \                                                <span class="c1"># Alternative 2: If you ARE using a separate NGINX instance OR you ARE installing Jenkins on a local development computer</span>
    <span class="o">-</span><span class="n">u</span> <span class="n">root</span> \
    <span class="n">jenkins</span><span class="o">/</span><span class="n">jenkins</span><span class="p">:</span><span class="n">lts</span>
</pre></div>
</div>
<p>If you still need the old setup with Python &amp; Maven installed locally, use <code class="docutils literal notranslate"><span class="pre">jenkins-artemis</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">jenkins/jenkins:lts</span></code>.
Also note that you can omit the <code class="docutils literal notranslate"><span class="pre">-u</span> <span class="pre">root</span></code>, <code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">/var/run/docker.sock:/var/run/docker.sock</span></code> and
<code class="docutils literal notranslate"><span class="pre">-v</span> <span class="pre">/usr/bin/docker:/usr/bin/docker:ro</span></code> parameters, if you do not want to run Docker builds on the Jenkins controller
(but e.g. use remote agents).</p>
</li>
<li><dl>
<dt>Open Jenkins in your browser (e.g. <code class="docutils literal notranslate"><span class="pre">localhost:8082</span></code>) and setup the</dt><dd><p>admin user account (install all suggested plugins). You can get the
initial admin password using the following command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Jenkins highlights the password in the logs, you can&#39;t miss it</span>
<span class="n">docker</span> <span class="n">logs</span> <span class="o">-</span><span class="n">f</span> <span class="n">jenkins</span>
<span class="ow">or</span> <span class="n">alternatively</span>
<span class="n">docker</span> <span class="n">exec</span> <span class="n">jenkins</span> <span class="n">cat</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">jenkins_home</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">initialAdminPassword</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>Set the chosen credentials in the Artemis configuration
<em>application-artemis.yml</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">continuous-integration</span><span class="p">:</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">your.chosen.username</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">your.chosen.password</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="required-jenkins-plugins">
<h4><a class="toc-backref" href="#id50">Required Jenkins Plugins</a><a class="headerlink" href="#required-jenkins-plugins" title="Permalink to this heading"></a></h4>
<p><strong>Note:</strong> The custom Jenkins Dockerfile takes advantage of the
<a class="reference external" href="https://github.com/jenkinsci/plugin-installation-manager-tool">Plugin Installation Manager Tool for Jenkins</a>
to automatically install the plugins listed below. If you used the Dockerfile, you can skip these steps and
<a class="reference external" href="#server-notification-plugin">Server Notification Plugin</a>.
The list of plugins is maintained in <code class="docutils literal notranslate"><span class="pre">src/main/docker/jenkins/plugins.yml</span></code>.</p>
<p>You will need to install the following plugins (apart from the
recommended ones that got installed during the setup process):</p>
<ol class="arabic">
<li><p><a class="reference external" href="https://plugins.jenkins.io/gitlab-plugin/">GitLab</a> for enabling
webhooks to and from GitLab</p></li>
<li><p><a class="reference external" href="https://plugins.jenkins.io/timestamper/">Timestamper</a> for adding the
time to every line of the build output (Timestamper might already be installed)</p></li>
<li><p><a class="reference external" href="https://plugins.jenkins.io/workflow-aggregator/">Pipeline</a> for defining the
build description using declarative files (Pipeline might already be installed)</p>
<p><strong>Note:</strong> This is a suite of plugins that will install multiple plugins</p>
</li>
<li><p><a class="reference external" href="https://plugins.jenkins.io/pipeline-maven/">Pipeline Maven</a> to use maven within the pipelines. If you want to
use Docker for your build agents you may also need to install
<a class="reference external" href="https://plugins.jenkins.io/docker-workflow/">Docker Pipeline</a> .</p></li>
<li><p><a class="reference external" href="https://plugins.jenkins.io/matrix-auth/">Matrix Authorization Strategy Plugin</a> for configuring permissions
for users on a project and build plan level (Matrix Authorization Strategy might already be installed).</p></li>
</ol>
<p>The plugins above (and the pipeline-setup associated with it) got introduced in Artemis 4.7.3.
If you are using exercises that were created before 4.7.3, you also have to install these plugins:</p>
<p>Please note that this setup is <strong>deprecated</strong> and will be removed in the future.
Please migrate to the new pipeline-setup if possible.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://plugins.jenkins.io/multiple-scms/">Multiple SCMs</a> for combining the
exercise test and assignment repositories in one build</p></li>
<li><p><a class="reference external" href="https://plugins.jenkins.io/postbuild-task/">Post Build Task</a> for preparing build
results to be exported to Artemis</p></li>
<li><p><a class="reference external" href="https://plugins.jenkins.io/xvfb/">Xvfb</a> for exercises based on GUI
libraries, for which tests have to have some virtual display</p></li>
</ol>
<p>Choose “Download now and install after restart” and checking the
“Restart Jenkins when installation is complete and no jobs are running” box</p>
</section>
<section id="timestamper-configuration">
<h4><a class="toc-backref" href="#id51">Timestamper Configuration</a><a class="headerlink" href="#timestamper-configuration" title="Permalink to this heading"></a></h4>
<p>Go to <em>Manage Jenkins → Configure System</em>. There you will find the
Timestamper configuration, use the following value for both formats:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;&lt;b&gt;&#39;</span><span class="n">yyyy</span><span class="o">-</span><span class="n">MM</span><span class="o">-</span><span class="n">dd</span><span class="s1">&#39;T&#39;</span><span class="n">HH</span><span class="p">:</span><span class="n">mm</span><span class="p">:</span><span class="n">ssX</span><span class="s1">&#39;&lt;/b&gt; &#39;</span>
</pre></div>
</div>
<figure class="align-center">
<img alt="../../_images/timestamper_config.png" src="../../_images/timestamper_config.png" />
</figure>
</section>
<section id="server-notification-plugin">
<h4><a class="toc-backref" href="#id52">Server Notification Plugin</a><a class="headerlink" href="#server-notification-plugin" title="Permalink to this heading"></a></h4>
<p>Artemis needs to receive a notification after every build, which
contains the test results and additional commit information. For that
purpose, we developed a Jenkins plugin, that can aggregate and <em>POST</em>
JUnit formatted results to any URL.</p>
<p>You can download the current release of the plugin
<a class="reference external" href="https://github.com/ls1intum/jenkins-server-notification-plugin/releases">here</a>
(Download the <strong>.hpi</strong> file). Go to the Jenkins plugin page (<em>Manage
Jenkins → Manage Plugins</em>) and install the downloaded file under the
<em>Advanced</em> tab under <em>Upload Plugin</em></p>
<figure class="align-center">
<img alt="../../_images/jenkins_custom_plugin.png" src="../../_images/jenkins_custom_plugin.png" />
</figure>
</section>
<section id="jenkins-credentials">
<h4><a class="toc-backref" href="#id53">Jenkins Credentials</a><a class="headerlink" href="#jenkins-credentials" title="Permalink to this heading"></a></h4>
<p>Go to <em>Manage Jenkins -&gt; Security -&gt; Manage Credentials → Jenkins → Global credentials</em> and create the
following credentials</p>
<section id="gitlab-api-token">
<h5><a class="toc-backref" href="#id54">GitLab API Token</a><a class="headerlink" href="#gitlab-api-token" title="Permalink to this heading"></a></h5>
<ol class="arabic">
<li><p>Create a new access token in GitLab named <code class="docutils literal notranslate"><span class="pre">Jenkins</span></code> and give it
<strong>api</strong> rights and <strong>read_repository</strong> rights. For detailed
instructions on how to create such a token follow <a class="reference external" href="#gitlab-access-token">Gitlab Access
Token</a>.</p>
<figure class="align-center">
<img alt="../../_images/gitlab_jenkins_token_rights.png" src="../../_images/gitlab_jenkins_token_rights.png" />
</figure>
</li>
<li><p>Copy the generated token and create new Jenkins credentials:</p>
<ol class="arabic simple">
<li><p><strong>Kind</strong>: GitLab API token</p></li>
<li><p><strong>Scope</strong>: Global</p></li>
<li><p><strong>API token</strong>: <em>your.copied.token</em></p></li>
<li><p>Leave the ID field blank</p></li>
<li><p>The description is up to you</p></li>
</ol>
</li>
<li><p>Go to the Jenkins settings <em>Manage Jenkins → Configure System</em>. There
you will find the GitLab settings. Fill in the URL of your GitLab
instance and select the just created API token in the credentials
dropdown. After you click on “Test Connection”, everything should
work fine. If you have problems finding the right URL for your local docker setup,
you can try <cite>http://host.docker.internal:8081</cite> for Windows or <cite>http://docker.for.mac.host.internal:8081</cite> for Mac
if GitLab is reachable over port 8081.</p>
<figure class="align-center">
<img alt="../../_images/jenkins_gitlab_configuration.png" src="../../_images/jenkins_gitlab_configuration.png" />
</figure>
</li>
</ol>
</section>
<section id="server-notification-token">
<h5><a class="toc-backref" href="#id55">Server Notification Token</a><a class="headerlink" href="#server-notification-token" title="Permalink to this heading"></a></h5>
<ol class="arabic">
<li><p>Create a new Jenkins credential containing the token, which gets send
by the server notification plugin to Artemis with every build result:</p>
<ol class="arabic simple">
<li><p><strong>Kind</strong>: Secret text</p></li>
<li><p><strong>Scope</strong>: Global</p></li>
<li><p><strong>Secret</strong>: <em>your.secret_token_value</em> (choose any value you want,
copy it for the nex step)</p></li>
<li><p>Leave the ID field blank</p></li>
<li><p>The description is up to you</p></li>
</ol>
</li>
<li><p>Copy the generated ID of the new credentials and put it into the
Artemis configuration <em>application-artemis.yml</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">continuous-integration</span><span class="p">:</span>
        <span class="nt">artemis-authentication-token-key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">the.id.of.the.notification.token.credential</span>
</pre></div>
</div>
</li>
<li><p>Copy the actual value you chose for the token and put it into the
Artemis configuration <em>application-artemis.yml</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">continuous-integration</span><span class="p">:</span>
        <span class="nt">artemis-authentication-token-value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">the.actual.value.of.the.notification.token</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="gitlab-repository-access">
<h5><a class="toc-backref" href="#id56">GitLab Repository Access</a><a class="headerlink" href="#gitlab-repository-access" title="Permalink to this heading"></a></h5>
<ol class="arabic">
<li><p>Create a new Jenkins credentials containing the username and password
of the GitLab administrator account:</p>
<ol class="arabic simple">
<li><p><strong>Kind</strong>: Username with password</p></li>
<li><p><strong>Scope</strong>: Global</p></li>
<li><p><strong>Username</strong>: <em>the_username_you_chose_for_the_gitlab_admin_user</em></p></li>
<li><p><strong>Password</strong>: <em>the_password_you_chose_for_the_gitlab_admin_user</em></p></li>
<li><p>Leave the ID field blank</p></li>
<li><p>The description is up to you</p></li>
</ol>
</li>
<li><p>Copy the generated ID (e.g. <code class="docutils literal notranslate"><span class="pre">ea0e3c08-4110-4g2f-9c83-fb2cdf6345fa</span></code>)
of the new credentials and put it into the Artemis configuration file
<em>application-artemis.yml</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">continuous-integration</span><span class="p">:</span>
        <span class="nt">vcs-credentials</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">the.id.of.the.username.and.password.credentials.from.jenkins</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="gitlab-to-jenkins-push-notification-token">
<h4><a class="toc-backref" href="#id57">GitLab to Jenkins push notification token</a><a class="headerlink" href="#gitlab-to-jenkins-push-notification-token" title="Permalink to this heading"></a></h4>
<p>GitLab has to notify Jenkins build plans if there are any new commits to
the repository. The push notification that gets sent here is secured by
a token generated by Jenkins. In order to get this token, you have to do
the following steps:</p>
<ol class="arabic simple">
<li><p>Create a new item in Jenkins (use the Freestyle project type) and
name it <strong>TestProject</strong></p></li>
<li><p>In the project configuration, go to <em>Build Triggers → Build when a
change is pushed to GitLab</em> and activate this option</p></li>
<li><p>Click on <em>Advanced</em>.</p></li>
<li><p>You will now have a couple of new options here, one of them being a
“<strong>Secret token</strong>”.</p></li>
<li><p>Click on the “<em>Generate</em>” button right below the text box for that
token.</p></li>
<li><p>Copy the generated value, let’s call it <strong>$gitlab-push-token</strong></p></li>
<li><p>Apply these change to the plan (i.e. click on <em>Apply</em>)</p></li>
</ol>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/jenkins_test_project.png" src="../../_images/jenkins_test_project.png" />
</figure>
</div></blockquote>
<ol class="arabic" start="8">
<li><p>Perform a <em>GET</em> request to the following URL (e.g. with Postman)
using Basic Authentication and the username and password you chose
for the Jenkins admin account:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GET</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">your</span><span class="o">.</span><span class="n">jenkins</span><span class="o">.</span><span class="n">domain</span><span class="o">/</span><span class="n">job</span><span class="o">/</span><span class="n">TestProject</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>If you have xmllint installed, you can use this command, which will output the <code class="docutils literal notranslate"><span class="pre">secret-push-token</span></code> from
steps 9 and 10 (you may have to adjust the username and password):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">u</span> <span class="n">artemis_admin</span><span class="p">:</span><span class="n">artemis_admin</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8082</span><span class="o">/</span><span class="n">job</span><span class="o">/</span><span class="n">TestProject</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">xml</span> <span class="o">|</span> <span class="n">xmllint</span> <span class="o">--</span><span class="n">nowarning</span> <span class="o">--</span><span class="n">xpath</span> <span class="s2">&quot;//project/triggers/com.dabsquared.gitlabjenkins.GitLabPushTrigger/secretToken/text()&quot;</span> <span class="o">-</span> <span class="o">|</span> <span class="n">sed</span> <span class="s1">&#39;s/^.\(.*\).$/</span><span class="se">\1</span><span class="s1">/&#39;</span>
</pre></div>
</div>
</li>
<li><p>You will get the whole configuration XML of the just created build
plan, there you will find the following tag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;secretToken&gt;{$some-long-encrypted-value}&lt;/secretToken&gt;
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><figure class="align-center" id="id17">
<img alt="../../_images/jenkins_project_config_xml.png" src="../../_images/jenkins_project_config_xml.png" />
<figcaption>
<p><span class="caption-text">Job configuration XML</span><a class="headerlink" href="#id17" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div></blockquote>
<ol class="arabic" start="10">
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">secret-push-token</span> <span class="pre">value</span></code> in the line
<code class="docutils literal notranslate"><span class="pre">&lt;secretToken&gt;{secret-push-token}&lt;/secretToken&gt;</span></code>. This is the encrypted value of the <code class="docutils literal notranslate"><span class="pre">gitlab-push-token</span></code>
you generated in step 5.</p></li>
<li><p>Now, you can delete this test project and input the following values
into your Artemis configuration <em>application-artemis.yml</em> (replace
the placeholders with the actual values you wrote down)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">version-control</span><span class="p">:</span>
        <span class="nt">ci-token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$gitlab-push-token</span>
    <span class="nt">continuous-integration</span><span class="p">:</span>
        <span class="nt">secret-push-token</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$some-long-encrypted-value</span>
</pre></div>
</div>
</li>
<li><p>In a local setup, you have to disable CSRF otherwise some API endpoints will return HTTP Status 403 Forbidden.
This is done be executing the following command:
<code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">-f</span> <span class="pre">src/main/docker/gitlab-jenkins-mysql.yml</span> <span class="pre">exec</span> <span class="pre">-T</span> <span class="pre">jenkins</span> <span class="pre">dd</span> <span class="pre">of=/var/jenkins_home/init.groovy</span> <span class="pre">&lt;</span> <span class="pre">src/main/docker/jenkins/jenkins-disable-csrf.groovy</span></code></p>
<p>The last step is to disable the <code class="docutils literal notranslate"><span class="pre">use-crumb</span></code> option in <code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jenkins</span><span class="p">:</span>
    <span class="nt">use-crumb</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="upgrading-jenkins">
<h4><a class="toc-backref" href="#id58">Upgrading Jenkins</a><a class="headerlink" href="#upgrading-jenkins" title="Permalink to this heading"></a></h4>
<p>In order to upgrade Jenkins to a newer version, you need to rebuild the Docker image targeting the new version.
The stable LTS versions can be viewed through the <a class="reference external" href="https://www.jenkins.io/changelog-stable/">changelog</a>
and the corresponding Docker image can be found on
<a class="reference external" href="https://hub.docker.com/r/jenkins/jenkins/tags?page=1&amp;ordering=last_updated">dockerhub</a>.</p>
<ol class="arabic">
<li><p>Open the Jenkins Dockerfile and replace the value of <code class="docutils literal notranslate"><span class="pre">FROM</span></code> with <code class="docutils literal notranslate"><span class="pre">jenkins/jenkins:lts</span></code>.
After running the command <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span> <span class="pre">jenkins/jenkins:lts</span></code>, this will use the latest LTS version
in the following steps.
You can also use a specific LTS version.
For example, if you want to upgrade Jenkins to version <code class="docutils literal notranslate"><span class="pre">2.289.2</span></code>, you will need to use the
<code class="docutils literal notranslate"><span class="pre">jenkins/jenkins:2.289.2-lts</span></code> image.</p></li>
<li><p>If you’re using docker-compose, you can simply use the following command and skip the next steps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">gitlab</span><span class="o">-</span><span class="n">jenkins</span><span class="o">-</span><span class="n">mysql</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span> <span class="o">--</span><span class="n">build</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</li>
<li><p>Build the new Docker image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">cache</span> <span class="o">-</span><span class="n">t</span> <span class="n">jenkins</span><span class="o">-</span><span class="n">artemis</span> <span class="o">.</span>
</pre></div>
</div>
<p>The name of the image is called <code class="docutils literal notranslate"><span class="pre">jenkins-artemis</span></code>.</p>
</li>
<li><p>Stop the current Jenkins container (change jenkins to the name of your container):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">stop</span> <span class="n">jenkins</span>
</pre></div>
</div>
</li>
<li><p>Rename the container to <code class="docutils literal notranslate"><span class="pre">jenkins_old</span></code> so that it can be used as a backup:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">rename</span> <span class="n">jenkins</span> <span class="n">jenkins_old</span>
</pre></div>
</div>
</li>
<li><p>Run the new Jenkins instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">itd</span> <span class="o">--</span><span class="n">name</span> <span class="n">jenkins</span> <span class="o">--</span><span class="n">restart</span> <span class="n">always</span> \
 <span class="o">-</span><span class="n">v</span> <span class="n">jenkins_data</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">jenkins_home</span> \
 <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span> \
 <span class="o">-</span><span class="n">p</span> <span class="mi">9080</span><span class="p">:</span><span class="mi">8080</span> <span class="n">jenkins</span><span class="o">-</span><span class="n">artemis</span> \
</pre></div>
</div>
</li>
<li><p>You can remove the backup container if it’s no longer needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">rm</span> <span class="n">jenkins_old</span>
</pre></div>
</div>
</li>
</ol>
<p>You should also update the Jenkins plugins regularly due to security
reasons. You can update them directly in the Web User Interface in the
Plugin Manager.</p>
</section>
</section>
<section id="build-agents">
<h3><a class="toc-backref" href="#id59">Build agents</a><a class="headerlink" href="#build-agents" title="Permalink to this heading"></a></h3>
<p>You can either run the builds locally (that means on the machine that hosts Jenkins) or on remote build agents.</p>
<section id="configuring-local-build-agents">
<h4><a class="toc-backref" href="#id60">Configuring local build agents</a><a class="headerlink" href="#configuring-local-build-agents" title="Permalink to this heading"></a></h4>
<p>Go to <cite>Manage Jenkins</cite> &gt; <cite>Manage Nodes and Clouds</cite> &gt; <cite>master</cite>
Configure your master node like this  (adjust the number of executors, if needed). Make sure to add the docker label.</p>
<blockquote>
<div><figure class="align-center" id="id18">
<img alt="../../_images/jenkins_local_node.png" src="../../_images/jenkins_local_node.png" />
<figcaption>
<p><span class="caption-text">Jenkins local node</span><a class="headerlink" href="#id18" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div></blockquote>
</section>
<section id="alternative-local-build-agents-setup-using-docker">
<h4><a class="toc-backref" href="#id61">Alternative local build agents setup using docker</a><a class="headerlink" href="#alternative-local-build-agents-setup-using-docker" title="Permalink to this heading"></a></h4>
<p>An alternative way of adding a build agent that will use docker (similar to the remote agents below) but running
locally, can be done using the jenkins/ssh-agent docker image <a class="reference external" href="https://hub.docker.com/r/jenkins/ssh-agent">docker image</a>.</p>
<p>Prerequisites:</p>
<ol class="arabic simple">
<li><p>Make sure to have Docker <a class="reference external" href="https://docs.docker.com/engine/install/">installed</a></p></li>
</ol>
<p>Agent setup:</p>
<ol class="arabic">
<li><p>Create a new SSH key using <code class="docutils literal notranslate"><span class="pre">ssh-keygen</span></code> (if a passphrase is added, store it for later)</p></li>
<li><p>Copy the public key content (e.g. in ~/.ssh/id_rsa.pub)</p></li>
<li><p>Run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">name</span> <span class="n">jenkins_agent</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span> \
<span class="n">jenkins</span><span class="o">/</span><span class="n">ssh</span><span class="o">-</span><span class="n">agent</span><span class="p">:</span><span class="n">latest</span> <span class="s2">&quot;&lt;copied_public_key&gt;&quot;</span>
</pre></div>
</div>
</li>
<li><p>Get the GID of the ‘docker’ group with <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/groups</span></code> and remember it for later</p></li>
<li><p>Enter the agent’s container with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">-it</span> <span class="pre">jenkins_agent</span> <span class="pre">bash</span></code></p></li>
<li><p>Install Docker with <code class="docutils literal notranslate"><span class="pre">apt</span> <span class="pre">update</span> <span class="pre">&amp;&amp;</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">docker.io</span></code></p></li>
<li><p>Check if group ‘docker’ already exists with <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/etc/groups</span></code>. If yes, remove it with <code class="docutils literal notranslate"><span class="pre">groupdel</span> <span class="pre">docker</span></code></p></li>
<li><p>Add a new ‘docker’ group with the same GID as seen in point 2 with <code class="docutils literal notranslate"><span class="pre">groupadd</span> <span class="pre">-g</span> <span class="pre">&lt;GID&gt;</span> <span class="pre">docker</span></code></p></li>
<li><p>Add ‘jenkins’ user to the group with <code class="docutils literal notranslate"><span class="pre">usermod</span> <span class="pre">-aG</span> <span class="pre">docker</span> <span class="pre">jenkins</span></code></p></li>
<li><p>Activate changes with <code class="docutils literal notranslate"><span class="pre">newgrp</span> <span class="pre">docker</span></code></p></li>
<li><p>Now check if ‘jenkins’ has the needed permissions to run docker commands</p>
<ol class="arabic simple">
<li><p>Log in as ‘jenkins’ with <code class="docutils literal notranslate"><span class="pre">su</span> <span class="pre">jenkins</span></code></p></li>
<li><p>Try if <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">inspect</span> <span class="pre">&lt;agent_container_name&gt;</span></code> works or if a permission error occurs</p></li>
<li><p>If an permission error occurs, try to restart the docker container</p></li>
</ol>
</li>
<li><p>Now you can exit the container executing <code class="docutils literal notranslate"><span class="pre">exit</span></code> twice (the first will exit the jenkins user and
the second the container)</p></li>
</ol>
<p>Add agent in Jenkins:</p>
<ol class="arabic">
<li><p>Open Jenkins in your browser (e.g. localhost:8082)</p></li>
<li><p>Go to Manage Jenkins -&gt; Manage Credentials -&gt; (global) -&gt; Add Credentials</p>
<blockquote>
<div><ul class="simple">
<li><p>Kind: SSH Username with private key</p></li>
<li><p>ID: leave blank</p></li>
<li><p>Description: Up to you</p></li>
<li><p>Username: jenkins</p></li>
<li><p>Private Key: &lt;content of the previous generated private key&gt; (e.g /root/.ssh/id_rsa)</p></li>
<li><p>Passphrase: &lt;the previous entered passphrase&gt; (you can leave it blank if none has been specified)</p></li>
</ul>
</div></blockquote>
<figure class="align-center">
<img alt="../../_images/alternative_jenkins_node_credentials.png" src="../../_images/alternative_jenkins_node_credentials.png" />
</figure>
</li>
<li><p>Go to Manage Jenkins -&gt; Manage Nodes and Clouds -&gt; New Node</p>
<blockquote>
<div><ul class="simple">
<li><p>Node name: Up to you (e.g. Docker)</p></li>
<li><p>Check ‘Permanent Agent’</p></li>
</ul>
</div></blockquote>
<figure class="align-center">
<img alt="../../_images/alternative_jenkins_node_setup.png" src="../../_images/alternative_jenkins_node_setup.png" />
</figure>
</li>
<li><p>Node settings:</p>
<blockquote>
<div><ul class="simple">
<li><p># of executors: Up to you (e.g. 4)</p></li>
<li><p>Remote root directory: /home/jenkins/agent</p></li>
<li><p>Labels: docker</p></li>
<li><p>Usage: Only build jobs with label expressions matching this node</p></li>
<li><p>Launch method: Launch agents via SSH</p></li>
<li><p>Host: output of command <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">inspect</span> <span class="pre">--format</span> <span class="pre">'{{</span> <span class="pre">.Config.Hostname</span> <span class="pre">}}'</span> <span class="pre">jenkins_agent</span></code></p></li>
<li><p>Credentials: &lt;the previously created SSH credential&gt;</p></li>
<li><p>Host Key Verification Strategy: Non verifying Verification Strategy</p></li>
<li><p>Availability: Keep this agent online as much as possible</p></li>
</ul>
</div></blockquote>
<figure class="align-center">
<img alt="../../_images/alternative_jenkins_node.png" src="../../_images/alternative_jenkins_node.png" />
</figure>
</li>
<li><p>Save the new node</p></li>
<li><p>Node should now be up and running</p></li>
</ol>
</section>
<section id="installing-remote-build-agents">
<h4><a class="toc-backref" href="#id62">Installing remote build agents</a><a class="headerlink" href="#installing-remote-build-agents" title="Permalink to this heading"></a></h4>
<p>You might want to run the builds on additional Jenkins agents, especially if a large amount of students should use
the system at the same time.
Jenkins supports remote build agents: The actual compilation of the students submissions happens on these
other machines but the whole process is transparent to Artemis.</p>
<p>This guide explains setting up a remote agent on an Ubuntu virtual machine that supports docker builds.</p>
<p>Prerequisites:
1. Install Docker on the remote machine: <a class="reference external" href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></p>
<ol class="arabic" start="2">
<li><p>Add a new user to the remote machine that Jenkins will use: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">adduser</span> <span class="pre">--disabled-password</span> <span class="pre">--gecos</span> <span class="pre">&quot;&quot;</span> <span class="pre">jenkins</span></code></p></li>
<li><p>Add the jenkins user to the docker group (This allows the jenkins user to interact with docker):
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">usermod</span> <span class="pre">-a</span> <span class="pre">-G</span> <span class="pre">docker</span> <span class="pre">jenkins</span></code></p></li>
<li><p>Generate a new SSH key locally (e.g. using <code class="docutils literal notranslate"><span class="pre">ssh-keygen</span></code>) and add the public key to the <code class="docutils literal notranslate"><span class="pre">.ssh/authorized_keys</span></code>
file of the jenkins user on the agent VM.</p></li>
<li><p>Validate that you can connect to the build agent machine using SSH and the generated private key and validate that
you can use docker (<cite>docker ps</cite> should not show an error)</p></li>
<li><p>Log in with your normal account on the build agent machine and install Java: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">default-jre</span></code></p></li>
<li><p>Add a new secret in Jenkins, enter private key you just generated and add the passphrase, if set:</p>
<figure class="align-center" id="id19">
<img alt="../../_images/jenkins_ssh_credentials.png" src="../../_images/jenkins_ssh_credentials.png" />
<figcaption>
<p><span class="caption-text">Jenkins SSH Credentials</span><a class="headerlink" href="#id19" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</li>
<li><p>Add a new node (select a name and select <cite>Permanent Agent</cite>):
Set the number of executors so that it matches your machine’s specs: This is the number of concurrent builds
this agent can handle. It is recommended to match the number of cores of the machine,
but you might want to adjust this later if needed.</p>
<p>Set the remote root directory to <code class="docutils literal notranslate"><span class="pre">/home/jenkins/remote_agent</span></code>.</p>
<p>Set the usage to <cite>Only build jobs with label expressions matching this node</cite>.
This ensures that only docker-jobs will be built on this agent, and not other jobs.</p>
<p>Add a label <code class="docutils literal notranslate"><span class="pre">docker</span></code> to the agent.</p>
<p>Set the launch method to <cite>Launch via SSH</cite> and add the host of the machine.
Select the credentials you just created and select <cite>Manually trusted key Verification Strategy</cite>
as Host key verification Strategy.
Save it.</p>
<figure class="align-center" id="id20">
<img alt="../../_images/jenkins_node.png" src="../../_images/jenkins_node.png" />
<figcaption>
<p><span class="caption-text">Add a Jenkins node</span><a class="headerlink" href="#id20" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</li>
<li><p>Wait for some moments while jenkins installs it’s remote agent on the agent’s machine.
You can track the progress using the <cite>Log</cite> page when selecting the agent. System information should also be available.</p></li>
<li><p>Change the settings of the master node to be used only for specific jobs.
This ensures that the docker tasks are not executed on the master agent but on the remote agent.</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id21">
<img alt="../../_images/jenkins_master_node.png" src="../../_images/jenkins_master_node.png" />
<figcaption>
<p><span class="caption-text">Adjust Jenkins master node settings</span><a class="headerlink" href="#id21" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</div></blockquote>
<ol class="arabic simple" start="11">
<li><p>You are finished, the new agent should now also process builds.</p></li>
</ol>
</section>
</section>
<section id="jenkins-user-management">
<h3><a class="toc-backref" href="#id63">Jenkins User Management</a><a class="headerlink" href="#jenkins-user-management" title="Permalink to this heading"></a></h3>
<p>Artemis supports user management in Jenkins as of version 4.11.0. Creating an account in Artemis will also create an
account on Jenkins using the same password. This enables users to login and access Jenkins. Updating and/or deleting
users from Artemis will also lead to updating and/or deleting from Jenkins.</p>
<p>Unfortunately, Jenkins does not provide a Rest API for user management which present the following <strong>caveats</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p>The username of a user is treated as a unique identifier in Jenkins.</p></li>
<li><p>It’s not possible to update an existing user with a single request.
We update by deleting the user from Jenkins and recreating it with the updated data.</p></li>
<li><p>In Jenkins, users are created in an on-demand basis.
For example, when a build is performed, its change log is computed and as a result commits from users
who Jenkins has never seen may be discovered and created.</p></li>
<li><p>Since Jenkins users may be re-created automatically, issues may occur such as 1) creating a user, deleting it,
and then re-creating it and 2) changing the username of the user and reverting back to the previous one.</p></li>
<li><p>Updating a user will re-create it in Jenkins and therefore remove any additionally saved Jenkins-specific
user data such as API access tokens.</p></li>
</ul>
</div></blockquote>
</section>
<section id="jenkins-build-plan-access-control-configuration">
<h3><a class="toc-backref" href="#id64">Jenkins Build Plan Access Control Configuration</a><a class="headerlink" href="#jenkins-build-plan-access-control-configuration" title="Permalink to this heading"></a></h3>
<p>Artemis takes advantage of the Project-based Matrix Authorization Strategy plugin to support build plan
access control in Jenkins.
This enables specific Artemis users to access build plans and execute actions such as triggering a build.
This section explains the changes required in Jenkins in order to set up build plan access control:</p>
<ol class="arabic simple">
<li><p>Navigate to Manage Jenkins -&gt; Manage Plugins -&gt; Installed and make sure that you have the
<a class="reference external" href="https://plugins.jenkins.io/matrix-auth/">Matrix Authorization Strategy</a> plugin installed</p></li>
<li><p>Navigate to Manage Jenkins -&gt; Configure Global Security and navigate to the “Authorization” section</p></li>
<li><p>Select the “Project-based Matrix Authorization Strategy” option</p></li>
<li><p>In the table make sure that the “Read” permission under the “Overall” section is assigned to
the “Authenticated Users” user group.</p></li>
<li><p>In the table make sure that all “Administer” permission is assigned to all administrators.</p></li>
<li><p>You are finished. If you want to fine-tune permissions assigned to teaching assistants and/or instructors,
you can change them within the <code class="docutils literal notranslate"><span class="pre">JenkinsJobPermission.java</span></code> file.</p></li>
</ol>
<figure class="align-center">
<img alt="../../_images/jenkins_authorization_permissions.png" src="../../_images/jenkins_authorization_permissions.png" />
</figure>
</section>
<section id="caching">
<h3><a class="toc-backref" href="#id65">Caching</a><a class="headerlink" href="#caching" title="Permalink to this heading"></a></h3>
<p>You can configure caching for e.g. Maven repositories.
See <a class="reference internal" href="#programming-exercises"><span class="std std-ref">Programming Exercise adjustments</span></a> for more details.</p>
</section>
<section id="separate-nginx-configurations">
<h3><a class="toc-backref" href="#id66">Separate NGINX Configurations</a><a class="headerlink" href="#separate-nginx-configurations" title="Permalink to this heading"></a></h3>
<p>There are some placeholders in the following configurations. Replace
them with your setup specific values ### GitLab</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>server {
    listen 443 ssl http2;
    server_name your.gitlab.domain;
    ssl_session_cache shared:GitLabSSL:10m;
    include /etc/nginx/common/common_ssl.conf;
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;;
    add_header X-Frame-Options DENY;
    add_header Referrer-Policy same-origin;
    client_max_body_size 10m;
    client_body_buffer_size 1m;

    location / {
        proxy_pass              http://localhost:&lt;your exposed GitLab HTTP port (default 80)&gt;;
        proxy_read_timeout      300;
        proxy_connect_timeout   300;
        proxy_http_version      1.1;
        proxy_redirect          http://         https://;

        proxy_set_header    Host                $http_host;
        proxy_set_header    X-Real-IP           $remote_addr;
        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto   $scheme;

        gzip off;
    }
}
</pre></div>
</div>
<section id="jenkins-1">
<span id="id3"></span><h4><a class="toc-backref" href="#id67">Jenkins</a><a class="headerlink" href="#jenkins-1" title="Permalink to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>server {
    listen 443 ssl http2;
    server_name your.jenkins.domain;
    ssl_session_cache shared:JenkinsSSL:10m;
    include /etc/nginx/common/common_ssl.conf;
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;;
    add_header X-Frame-Options DENY;
    add_header Referrer-Policy same-origin;
    client_max_body_size 10m;
    client_body_buffer_size 1m;

    location / {
        proxy_pass              http://localhost:&lt;your exposed Jenkins HTTP port (default 8081)&gt;;
        proxy_set_header        Host                $host:$server_port;
        proxy_set_header        X-Real-IP           $remote_addr;
        proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header        X-Forwarded-Proto   $scheme;
        proxy_redirect          http://             https://;

        # Required for new HTTP-based CLI
        proxy_http_version 1.1;
        proxy_request_buffering off;
        proxy_buffering off; # Required for HTTP-based CLI to work over SSL

        # workaround for https://issues.jenkins-ci.org/browse/JENKINS-45651
        add_header &#39;X-SSH-Endpoint&#39; &#39;your.jenkins.domain.com:50022&#39; always;
    }

    error_page 502 /502.html;
    location /502.html {
        root /usr/share/nginx/html;
        internal;
    }
}
</pre></div>
</div>
</section>
<section id="etc-nginx-common-common-ssl-conf">
<h4><a class="toc-backref" href="#id68">/etc/nginx/common/common_ssl.conf</a><a class="headerlink" href="#etc-nginx-common-common-ssl-conf" title="Permalink to this heading"></a></h4>
<p>If you haven’t done so, generate the DH param file:
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">openssl</span> <span class="pre">dhparam</span> <span class="pre">-out</span> <span class="pre">/etc/nginx/dhparam.pem</span> <span class="pre">4096</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ssl_certificate     &lt;path to your fullchain certificate&gt;;
ssl_certificate_key &lt;path to the private key of your certificate&gt;;
ssl_protocols       TLSv1.2 TLSv1.3;
ssl_dhparam /etc/nginx/dhparam.pem;
ssl_prefer_server_ciphers   on;
ssl_ciphers ECDH+CHACHA20:EECDH+AESGCM:EDH+AESGCM:!AES128;
ssl_ecdh_curve secp384r1;
ssl_session_timeout  10m;
ssl_session_cache shared:SSL:10m;
ssl_session_tickets off;
ssl_stapling on;
ssl_stapling_verify on;
resolver &lt;if you have any, specify them here&gt; valid=300s;
resolver_timeout 5s;
</pre></div>
</div>
</section>
</section>
<section id="deployment-artemis-gitlab-jenkins-using-docker-on-local-machine">
<h3><a class="toc-backref" href="#id69">Deployment Artemis / GitLab / Jenkins using Docker on Local machine</a><a class="headerlink" href="#deployment-artemis-gitlab-jenkins-using-docker-on-local-machine" title="Permalink to this heading"></a></h3>
<p>Execute the following steps in addition to the ones described above:</p>
<section id="preparation">
<h4><a class="toc-backref" href="#id70">Preparation</a><a class="headerlink" href="#preparation" title="Permalink to this heading"></a></h4>
<ol class="arabic simple">
<li><p>Create a Docker network named “artemis” with
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">network</span> <span class="pre">create</span> <span class="pre">artemis</span></code>.</p></li>
</ol>
</section>
<section id="gitlab-1">
<span id="id4"></span><h4><a class="toc-backref" href="#id71">GitLab</a><a class="headerlink" href="#gitlab-1" title="Permalink to this heading"></a></h4>
<ol class="arabic simple">
<li><p>Add the GitLab container to the created network with
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">network</span> <span class="pre">connect</span> <span class="pre">artemis</span> <span class="pre">gitlab</span></code>.</p></li>
<li><p>Get the URL of the GitLab container with the first IP returned by
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">inspect</span> <span class="pre">-f</span> <span class="pre">'{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}'</span> <span class="pre">gitlab</span></code>.</p></li>
<li><p>Use this IP in the <code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> file at
<code class="docutils literal notranslate"><span class="pre">artemis.version-control.url</span></code>.</p></li>
</ol>
</section>
<section id="jenkins-2">
<span id="id5"></span><h4><a class="toc-backref" href="#id72">Jenkins</a><a class="headerlink" href="#jenkins-2" title="Permalink to this heading"></a></h4>
<ol class="arabic simple">
<li><p>Add the Jenkins container to the created network with
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">network</span> <span class="pre">connect</span> <span class="pre">artemis</span> <span class="pre">jenkins</span></code>.</p></li>
<li><p>Get the URL of the GitLab container with the first IP returned by
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">inspect</span> <span class="pre">-f</span> <span class="pre">'{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}'</span> <span class="pre">jenkins</span></code>.</p></li>
<li><p>Use this IP in the <code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> file at
<code class="docutils literal notranslate"><span class="pre">artemis.continuous-integration.url</span></code>.</p></li>
</ol>
</section>
<section id="artemis-1">
<span id="id6"></span><h4><a class="toc-backref" href="#id73">Artemis</a><a class="headerlink" href="#artemis-1" title="Permalink to this heading"></a></h4>
<ol class="arabic simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>:</p>
<ol class="arabic simple">
<li><p>Make sure to use unique ports, e.g. 8080 for Artemis, 8081 for GitLab and 8082 for Jenkins.</p></li>
<li><p>Change the <code class="docutils literal notranslate"><span class="pre">SPRING_PROFILES_ACTIVE</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">dev,jenkins,gitlab,artemis,scheduling</span></code>.</p></li>
</ol>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-dev.yml</span></code> at <code class="docutils literal notranslate"><span class="pre">server:</span></code> use <code class="docutils literal notranslate"><span class="pre">port:</span> <span class="pre">8080</span></code> for Artemis.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span></code>.</p></li>
<li><p>After the container has been deployed run
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">inspect</span> <span class="pre">-f</span> <span class="pre">'{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}'</span> <span class="pre">artemis_artemis-server</span></code>
and copy the first resulting IP.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-dev.yml</span></code> at <code class="docutils literal notranslate"><span class="pre">server:</span></code>
at <code class="docutils literal notranslate"><span class="pre">url:</span></code> paste the copied IP with the port number, e.g. <code class="docutils literal notranslate"><span class="pre">url:</span> <span class="pre">http://172.33.0.1:8080</span></code>.</p></li>
<li><p>Stop the Artemis docker container with Control-C and re-run
<code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span></code>.</p></li>
</ol>
</section>
</section>
</section>
<hr class="docutils" />
<section id="athene-service">
<h2><a class="toc-backref" href="#id29">Athene Service</a><a class="headerlink" href="#athene-service" title="Permalink to this heading"></a></h2>
<p>The semi-automatic text assessment relies on the <a class="reference external" href="https://github.com/ls1intum/Athene">Athene</a> service.
To enable automatic text assessments, special configuration is required:</p>
<section id="enable-the-athene-spring-profile">
<h3>Enable the <code class="docutils literal notranslate"><span class="pre">athene</span></code> Spring profile:<a class="headerlink" href="#enable-the-athene-spring-profile" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">spring</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">active</span><span class="o">=</span><span class="n">dev</span><span class="p">,</span><span class="n">bamboo</span><span class="p">,</span><span class="n">bitbucket</span><span class="p">,</span><span class="n">jira</span><span class="p">,</span><span class="n">artemis</span><span class="p">,</span><span class="n">scheduling</span><span class="p">,</span><span class="n">athene</span>
</pre></div>
</div>
</section>
<section id="configure-api-endpoints">
<h3>Configure API Endpoints:<a class="headerlink" href="#configure-api-endpoints" title="Permalink to this heading"></a></h3>
<p>The Athene service is running on a dedicated machine and is addressed via
HTTP. We need to extend the configuration in the file
<code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-artemis.yml</span></code> like so:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
  <span class="c1"># ...</span>
  <span class="nt">athene</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost</span>
    <span class="nt">base64-secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">YWVuaXF1YWRpNWNlaXJpNmFlbTZkb283dXphaVF1b29oM3J1MWNoYWlyNHRoZWUzb2huZ2FpM211bGVlM0VpcAo=</span>
    <span class="nt">token-validity-in-seconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10800</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="apollon-service">
<h2><a class="toc-backref" href="#id30">Apollon Service</a><a class="headerlink" href="#apollon-service" title="Permalink to this heading"></a></h2>
<p>The <a class="reference external" href="https://github.com/ls1intum/Apollon_converter">Apollon Converter</a> is needed to convert models from their JSON representaiton to PDF.
Special configuration is required:</p>
<section id="enable-the-apollon-spring-profile">
<h3>Enable the <code class="docutils literal notranslate"><span class="pre">apollon</span></code> Spring profile:<a class="headerlink" href="#enable-the-apollon-spring-profile" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">spring</span><span class="o">.</span><span class="n">profiles</span><span class="o">.</span><span class="n">active</span><span class="o">=</span><span class="n">dev</span><span class="p">,</span><span class="n">bamboo</span><span class="p">,</span><span class="n">bitbucket</span><span class="p">,</span><span class="n">jira</span><span class="p">,</span><span class="n">artemis</span><span class="p">,</span><span class="n">scheduling</span><span class="p">,</span><span class="n">apollon</span>
</pre></div>
</div>
</section>
<section id="id7">
<h3>Configure API Endpoints:<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h3>
<p>The Apollon conversion service is running on a dedicated machine and is adressed via
HTTP. We need to extend the configuration in the file
<code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-artemis.yml</span></code> like so:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apollon</span><span class="p">:</span>
   <span class="nt">conversion-service-url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://localhost:8080</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="common-setup-problems">
<h2><a class="toc-backref" href="#id31">Common Setup Problems</a><a class="headerlink" href="#common-setup-problems" title="Permalink to this heading"></a></h2>
<section id="general-setup-problems">
<h3>General Setup Problems<a class="headerlink" href="#general-setup-problems" title="Permalink to this heading"></a></h3>
<ul>
<li><p>Restarting IntelliJ with invalidated caches <em>(File &gt; Invalidate Caches…)</em> might resolve the current issue.</p></li>
<li><p>When facing issues with deep dependencies and changes were made to the <code class="docutils literal notranslate"><span class="pre">package.json</span></code> file,
executing <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span> <span class="pre">--force</span></code> might resolve the issue.</p></li>
<li><p>When encountering a compilation error due to <code class="docutils literal notranslate"><span class="pre">invalid</span> <span class="pre">source</span> <span class="pre">release</span></code> make sure that you have set
the Java version properly at 3 places</p>
<blockquote>
<div><ul class="simple">
<li><p>File &gt; Project Structure &gt; Project Settings &gt; Project &gt; Project SDK</p></li>
<li><p>File &gt; Project Structure &gt; Project Settings &gt; Project &gt; Project Language Level</p></li>
<li><p>File &gt; Settings &gt; Build, Execution, Deployment &gt; Build Tools &gt; Gradle &gt; Gradle JVM</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<section id="database">
<h4>Database<a class="headerlink" href="#database" title="Permalink to this heading"></a></h4>
<ul>
<li><p>On the first startup, there might be issues with the <code class="docutils literal notranslate"><span class="pre">text_block</span></code> table.
You can resolve the issue by executing <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span> <span class="pre">text_block</span> <span class="pre">CONVERT</span> <span class="pre">TO</span> <span class="pre">CHARACTER</span> <span class="pre">SET</span> <span class="pre">utf8mb4</span> <span class="pre">COLLATE</span> <span class="pre">utf8mb4_unicode_ci;</span></code>
in your database.</p></li>
<li><p>One typical problem in the development setup is that an exception occurs during the database initialization.
Artemis uses <a class="reference external" href="https://www.liquibase.org">Liquibase</a> to automatically upgrade the database scheme
after the data model has changed.
This ensures that the changes can also be applied to the production server.
In case you encounter errors with Liquibase checksum values:</p>
<blockquote>
<div><ul class="simple">
<li><p>Run the following command in your terminal / command line: <code class="docutils literal notranslate"><span class="pre">./gradlew</span> <span class="pre">liquibaseClearChecksums</span></code></p></li>
<li><p>You can manually adjust the checksum for a breaking changelog: <code class="docutils literal notranslate"><span class="pre">UPDATE</span> <span class="pre">`DATABASECHANGELOG`</span> <span class="pre">SET</span> <span class="pre">`MD5SUM`</span> <span class="pre">=</span> <span class="pre">NULL</span> <span class="pre">WHERE</span> <span class="pre">`ID`</span> <span class="pre">=</span> <span class="pre">'&lt;changelogId&gt;'</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="client">
<h4>Client<a class="headerlink" href="#client" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>If you are using a machine with limited RAM <em>(e.g. ~8 GB RAM)</em> you might have issues starting the Artemis Client.
You can resolve this by following the description in <a class="reference internal" href="#usingthecommandline"><span class="std std-ref">Using the command line</span></a></p></li>
</ul>
</section>
</section>
<section id="programming-exercise-setup">
<h3>Programming Exercise Setup<a class="headerlink" href="#programming-exercise-setup" title="Permalink to this heading"></a></h3>
<section id="atlassian-setup-bamboo-bitbucket-and-jira">
<h4>Atlassian Setup (Bamboo, Bitbucket and Jira)<a class="headerlink" href="#atlassian-setup-bamboo-bitbucket-and-jira" title="Permalink to this heading"></a></h4>
<ul>
<li><p>When setting up the Bamboo, Bitbucket, and Jira, at the same time within the same browser,
you might receive the message that the Jira token expired.
You can resolve the issue by using another browser for configuring Jira,
as there seems to be a synchronization problem within the browser.</p></li>
<li><p>When you create a new programming exercise and receive the error message
<code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">project</span> <span class="pre">&lt;ProgrammingExerciseName&gt;</span> <span class="pre">already</span> <span class="pre">exists</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">CI</span> <span class="pre">Server.</span>
<span class="pre">Please</span> <span class="pre">choose</span> <span class="pre">a</span> <span class="pre">different</span> <span class="pre">short</span> <span class="pre">name!</span></code> and you have double checked that this project does not exist within
the CI Server Bamboo, you might have to renew the trial licenses for the Atlassian products.</p>
<blockquote>
<div><details>
<summary>Update Atlassian Licenses</summary>
You need to create new Atlassian Licenses, which requires you to retrieve the server id and navigate to the license editing page after
creating new <a href="https://my.atlassian.com/license/evaluation">trial licenses</a>.
<ul>
    <li>
     Bamboo: Retrieve the Server ID and edit the license in <a href="http://localhost:8085/admin/updateLicense!doDefault.action">License key details</a> <i>(Administration > Licensing)</i>
    </li>
    <li>
     Bitbucket: Retrieve the Server ID and edit the license in <a href="http://localhost:7990/admin/license">License Settings</a> <i>(Administration > Licensing)</i>
    </li>
    <li>
     Jira: Retrieve the <a href="http://localhost:8081/secure/admin/ViewSystemInfo.jspa">Server ID</a> <i>(System > System info)</i> and edit the <b>JIRA Service Desk</b> <i>License key</i>
           in <a href="http://localhost:8081/plugins/servlet/applications/versions-licenses">Versions & licenses</a>
    </li>
</ul>
</details></div></blockquote>
</li>
</ul>
<hr class="docutils" />
</section>
</section>
</section>
<section id="multiple-artemis-instances">
<span id="setup-distributed"></span><h2><a class="toc-backref" href="#id32">Multiple Artemis instances</a><a class="headerlink" href="#multiple-artemis-instances" title="Permalink to this heading"></a></h2>
<section id="setup-with-one-instance">
<h3>Setup with one instance<a class="headerlink" href="#setup-with-one-instance" title="Permalink to this heading"></a></h3>
<p>Artemis usually runs with one instance of the application server:</p>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/deployment_before.drawio.png" src="../../_images/deployment_before.drawio.png" />
</figure>
</div></blockquote>
</section>
<section id="setup-with-multiple-instances">
<h3>Setup with multiple instances<a class="headerlink" href="#setup-with-multiple-instances" title="Permalink to this heading"></a></h3>
<p>There are certain scenarios, where a setup with multiple instances of the application server is required.
This can e.g. be due to special requirements regarding fault tolerance or performance.</p>
<p>Artemis also supports this setup (which is also used at the Chair for Applied Software Engineering at TUM).</p>
<p>Multiple instances of the application server are used to distribute the load:</p>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/deployment_after_simple.drawio.png" src="../../_images/deployment_after_simple.drawio.png" />
</figure>
</div></blockquote>
<p>A load balancer (typically a reverse proxy such as nginx) is added, that distributes the requests
to the different instances.</p>
<p><strong>Note:</strong> This documentation focuses on the practical setup of this distributed setup.
More details regarding the theoretical aspects can be found in the Bachelor’s Thesis
<cite>Securing and Scaling Artemis WebSocket Architecture</cite>, which can be found here:
<a class="reference download internal" download="" href="../../_downloads/85a97429e59a3aae61b9c1c46f32561e/thesis_securing_scaling_artemis.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>.</p>
</section>
<section id="additional-synchronization">
<h3>Additional synchronization<a class="headerlink" href="#additional-synchronization" title="Permalink to this heading"></a></h3>
<p>All instances of the application server use the same database, but other parts of the system also
have to be synchronized:</p>
<ol class="arabic simple">
<li><p>Database cache</p></li>
<li><p>WebSocket messages</p></li>
<li><p>File system</p></li>
</ol>
<p>Each of these three aspects is synchronized using a different solution</p>
</section>
<section id="database-cache">
<h3>Database cache<a class="headerlink" href="#database-cache" title="Permalink to this heading"></a></h3>
<p>Artemis uses a cache provider that supports distributed caching: <a class="reference external" href="https://hazelcast.com/">Hazelcast</a>.</p>
<p>All instances of Artemis form a so-called cluster that allows them to synchronize their cache.
You can use the configuration argument <code class="docutils literal notranslate"><span class="pre">spring.hazelcast.interface</span></code> to configure the interface on which Hazelcast
will listen.</p>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/deployment_hazelcast.drawio.png" src="../../_images/deployment_hazelcast.drawio.png" />
</figure>
</div></blockquote>
<p>One problem that arises with a distributed setup is that all instances have to know each other in order
to create this cluster.
This is problematic if the instances change dynamically.
Artemis uses a discovery service to solve the issue (named <a class="reference external" href="https://www.jhipster.tech/jhipster-registry/">JHipster Registry</a>).</p>
</section>
<section id="discovery-service">
<h3>Discovery service<a class="headerlink" href="#discovery-service" title="Permalink to this heading"></a></h3>
<p>JHipster registry contains Eureka, the discovery service where all instances can register themselves and fetch
the other registered instances.</p>
<p>Eureka can be configured like this within Artemis:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eureka configuration</span>
<span class="nt">eureka</span><span class="p">:</span>
    <span class="nt">client</span><span class="p">:</span>
        <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="nt">service-url</span><span class="p">:</span>
            <span class="nt">defaultZone</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">artemis_eureka_urls</span> <span class="p p-Indicator">}}</span>
<span class="nt">instance</span><span class="p">:</span>
    <span class="nt">prefer-ip-address</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">ip-address</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">artemis_ip_address</span> <span class="p p-Indicator">}}</span>
    <span class="nt">appname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Artemis</span>
    <span class="nt">instanceId</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Artemis:{{ artemis_eureka_instance_id }}</span>

<span class="nt">logging</span><span class="p">:</span>
    <span class="nt">file</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;/opt/artemis/artemis.log&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">artemis_eureka_urls</span> <span class="pre">}}</span></code> must be the URL where Eureka is reachable,
<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">artemis_ip_address</span> <span class="pre">}}</span></code> must be the IP under which this instance is reachable and
<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">artemis_eureka_instance_id</span> <span class="pre">}}</span></code> must be a unique identifier for this instance.
You also have to setup the value <code class="docutils literal notranslate"><span class="pre">jhipster.registry.password</span></code> to the password of the registry
(which you will set later).</p>
<p>Note that Hazelcast (which requires Eureka) is by default binding to <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code> to prevent other instances
to form a cluster without manual intervention.
If you set up the cluster on multiple machines (which you should do for a production setup),
you have to set the value <code class="docutils literal notranslate"><span class="pre">spring.hazelcast.interface</span></code> to the ip-address of the machine.
Hazelcast will then bind on this interface rather than <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>,
which allows other instances to establish connections to the instance.
This setting must be set for every instance, but you have to make sure to adjust the ip-address correspondingly.</p>
</section>
<section id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this heading"></a></h3>
<p><strong>Installing</strong></p>
<ol class="arabic simple">
<li><p>Create the directory</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mkdir /opt/registry/
sudo mkdir /opt/registry/config-server
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Download the application</p></li>
</ol>
<p>Download the latest version of the jhipster-registry from GitHub, e.g. by using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo wget -O /opt/registry/registry.jar https://github.com/jhipster/jhipster-registry/releases/download/v6.2.0/jhipster-registry-6.2.0.jar
</pre></div>
</div>
<p><strong>Service configuration</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">vim</span> <span class="pre">/etc/systemd/system/registry.service</span></code></p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Registry
<span class="nv">After</span><span class="o">=</span>syslog.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">User</span><span class="o">=</span>artemis
<span class="nv">WorkingDirectory</span><span class="o">=</span>/opt/registry
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/java <span class="se">\</span>
    -Xmx256m <span class="se">\</span>
    -jar registry.jar <span class="se">\</span>
    --spring.profiles.active<span class="o">=</span>prod,native
<span class="nv">SuccessExitStatus</span><span class="o">=</span><span class="m">143</span>
<span class="nv">StandardOutput</span><span class="o">=</span>/opt/registry/registry.log
<span class="c1">#StandardError=inherit</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Set Permissions in Registry Folder</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo chown -R artemis:artemis /opt/registry
sudo chmod g+rwx /opt/registry
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Enable the service</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> registry.service
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Start Service (only after performing steps 1-3 of the configuration)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo systemctl start registry
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>Logging</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo journalctl -f -n <span class="m">1000</span> -u registry
</pre></div>
</div>
<p><strong>Configuration</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">vim</span> <span class="pre">/opt/registry/application-prod.yml</span></code></p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">logging</span><span class="p">:</span>
    <span class="nt">file</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;/opt/registry/registry.log&#39;</span>

<span class="nt">jhipster</span><span class="p">:</span>
    <span class="nt">security</span><span class="p">:</span>
        <span class="nt">authentication</span><span class="p">:</span>
        <span class="nt">jwt</span><span class="p">:</span>
            <span class="nt">base64-secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">THE-SAME-TOKEN-THAT-IS-USED-ON-THE-ARTEMIS-INSTANCES</span>
    <span class="nt">registry</span><span class="p">:</span>
        <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AN-ADMIN-PASSWORD-THAT-MUST-BE-CHANGED</span>
<span class="nt">spring</span><span class="p">:</span>
    <span class="nt">security</span><span class="p">:</span>
        <span class="nt">user</span><span class="p">:</span>
            <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AN-ADMIN-PASSWORD-THAT-MUST-BE-CHANGED</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">vim</span> <span class="pre">/opt/registry/bootstrap-prod.yml</span></code></p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jhipster</span><span class="p">:</span>
    <span class="nt">security</span><span class="p">:</span>
        <span class="nt">authentication</span><span class="p">:</span>
        <span class="nt">jwt</span><span class="p">:</span>
            <span class="nt">base64-secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">THE-SAME-TOKEN-THAT-IS-USED-ON-THE-ARTEMIS-INSTANCES</span>
            <span class="nt">secret</span><span class="p">:</span> <span class="s">&#39;&#39;</span>

<span class="nt">spring</span><span class="p">:</span>
    <span class="nt">cloud</span><span class="p">:</span>
        <span class="nt">config</span><span class="p">:</span>
        <span class="nt">server</span><span class="p">:</span>
            <span class="nt">bootstrap</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
            <span class="nt">composite</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">native</span>
              <span class="nt">search-locations</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">file:./config-server</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">vim</span> <span class="pre">/opt/registry/config-server/application.yml</span></code></p></li>
</ol>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Common configuration shared between all applications</span>
<span class="nt">configserver</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Artemis JHipster Registry</span>
    <span class="nt">status</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Connected to the Artemis JHipster Registry</span>

<span class="nt">jhipster</span><span class="p">:</span>
    <span class="nt">security</span><span class="p">:</span>
        <span class="nt">authentication</span><span class="p">:</span>
        <span class="nt">jwt</span><span class="p">:</span>
            <span class="nt">secret</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
            <span class="nt">base64-secret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">THE-SAME-TOKEN-THAT-IS-USED-ON-THE-ARTEMIS-INSTANCES</span>

<span class="nt">eureka</span><span class="p">:</span>
    <span class="nt">client</span><span class="p">:</span>
        <span class="nt">service-url</span><span class="p">:</span>
            <span class="nt">defaultZone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://admin:${jhipster.registry.password}@localhost:8761/eureka/</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>nginx config</strong></p>
<p>You still have to make the registry available:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">vim</span> <span class="pre">/etc/nginx/sites-available/registry.conf</span></code></p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>server {
    listen 443 ssl http2;
    server_name REGISTRY_FQDN;
    ssl_session_cache shared:RegistrySSL:10m;
    include /etc/nginx/common/common_ssl.conf;
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;;
    add_header X-Frame-Options DENY;
    add_header Referrer-Policy same-origin;
    client_max_body_size 10m;
    client_body_buffer_size 1m;

    location / {
        proxy_pass              http://localhost:8761;
        proxy_read_timeout      300;
        proxy_connect_timeout   300;
        proxy_http_version      1.1;
        proxy_redirect          http://         https://;

        proxy_set_header    Host                $http_host;
        proxy_set_header    X-Real-IP           $remote_addr;
        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto   $scheme;

        gzip off;
    }
}
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/etc/nginx/sites-available/registry.conf</span> <span class="pre">/etc/nginx/sites-enabled/</span></code></p></li>
</ol>
<p>This enables the registry in nginx</p>
<ol class="arabic simple" start="3">
<li><p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">nginx</span> <span class="pre">restart</span></code></p></li>
</ol>
<p>This will apply the config changes and the registry will be reachable.</p>
</section>
<section id="websockets">
<h3>WebSockets<a class="headerlink" href="#websockets" title="Permalink to this heading"></a></h3>
<p>WebSockets should also be synchronized (so that a user connected to one instance can perform an action
which causes an update to users on different instances, without having to reload the page - such as quiz starts).
We use a so-called broker for this (named <a class="reference external" href="https://activemq.apache.org/components/artemis/">Apache ActiveMQ Artemis</a>).</p>
<p>It relays message between instances:</p>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/deployment_broker.drawio.png" src="../../_images/deployment_broker.drawio.png" />
</figure>
</div></blockquote>
<p><strong>Setup</strong></p>
<ol class="arabic simple">
<li><p>Create a folder to store ActiveMQ</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mkdir /opt/activemq-distribution
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Download ActiveMQ here: <a class="reference external" href="http://activemq.apache.org/components/artemis/download/">http://activemq.apache.org/components/artemis/download/</a></p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo wget -O /opt/activemq-distribution/activemq.tar.gz https://downloads.apache.org/activemq/activemq-artemis/2.13.0/apache-artemis-2.13.0-bin.tar.gz
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Extract the downloaded contents</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /opt/activemq-distribution
sudo tar -xf activemq.tar.gz
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Navigate to the folder with the CLI</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /opt/activemq-distribution/apache-artemis-2.13.0/bin
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Create a broker in the /opt/broker/broker1 directory, replace USERNAME and PASSWORD accordingly</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo ./artemis create --user USERNAME --password PASSWORD --require-login /opt/broker/broker1
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Adjust the permissions</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo chown -R artemis:artemis /opt/broker
sudo chmod g+rwx /opt/broker
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="7">
<li><p>Adjust the configuration of the broker: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">vim</span> <span class="pre">/opt/broker/broker1/etc/broker.xml</span></code></p></li>
</ol>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&#39;1.0&#39;?&gt;</span>
<span class="nt">&lt;configuration</span> <span class="na">xmlns=</span><span class="s">&quot;urn:activemq&quot;</span>
            <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
            <span class="na">xmlns:xi=</span><span class="s">&quot;http://www.w3.org/2001/XInclude&quot;</span>
            <span class="na">xsi:schemaLocation=</span><span class="s">&quot;urn:activemq /schema/artemis-configuration.xsd&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;core</span> <span class="na">xmlns=</span><span class="s">&quot;urn:activemq:core&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
        <span class="na">xsi:schemaLocation=</span><span class="s">&quot;urn:activemq:core &quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;name&gt;</span>0.0.0.0<span class="nt">&lt;/name&gt;</span>

    <span class="nt">&lt;journal-pool-files&gt;</span>10<span class="nt">&lt;/journal-pool-files&gt;</span>

    <span class="nt">&lt;acceptors&gt;</span>
        <span class="c">&lt;!-- STOMP Acceptor. --&gt;</span>
        <span class="nt">&lt;acceptor</span> <span class="na">name=</span><span class="s">&quot;stomp&quot;</span><span class="nt">&gt;</span>tcp://0.0.0.0:61613?tcpSendBufferSize=1048576;tcpReceiveBufferSize=1048576;protocols=STOMP;useEpoll=true;heartBeatToConnectionTtlModifier=6<span class="nt">&lt;/acceptor&gt;</span>
    <span class="nt">&lt;/acceptors&gt;</span>

    <span class="nt">&lt;connectors&gt;</span>
        <span class="nt">&lt;connector</span> <span class="na">name=</span><span class="s">&quot;netty-connector&quot;</span><span class="nt">&gt;</span>tcp://localhost:61616<span class="nt">&lt;/connector&gt;</span>
    <span class="nt">&lt;/connectors&gt;</span>

    <span class="nt">&lt;security-settings&gt;</span>
        <span class="nt">&lt;security-setting</span> <span class="na">match=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;createNonDurableQueue&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;deleteNonDurableQueue&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;createDurableQueue&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;deleteDurableQueue&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;createAddress&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;deleteAddress&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;consume&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;browse&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;send&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
            <span class="c">&lt;!-- we need this otherwise ./artemis data imp wouldn&#39;t work --&gt;</span>
            <span class="nt">&lt;permission</span> <span class="na">type=</span><span class="s">&quot;manage&quot;</span> <span class="na">roles=</span><span class="s">&quot;amq&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/security-setting&gt;</span>
    <span class="nt">&lt;/security-settings&gt;</span>

    <span class="nt">&lt;address-settings&gt;</span>
        <span class="c">&lt;!--default for catch all--&gt;</span>
        <span class="nt">&lt;address-setting</span> <span class="na">match=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;dead-letter-address&gt;</span>DLQ<span class="nt">&lt;/dead-letter-address&gt;</span>
            <span class="nt">&lt;expiry-address&gt;</span>ExpiryQueue<span class="nt">&lt;/expiry-address&gt;</span>
            <span class="nt">&lt;redelivery-delay&gt;</span>0<span class="nt">&lt;/redelivery-delay&gt;</span>
            <span class="c">&lt;!-- with -1 only the global-max-size is in use for limiting --&gt;</span>
            <span class="nt">&lt;max-size-bytes&gt;</span>-1<span class="nt">&lt;/max-size-bytes&gt;</span>
            <span class="nt">&lt;message-counter-history-day-limit&gt;</span>10<span class="nt">&lt;/message-counter-history-day-limit&gt;</span>
            <span class="nt">&lt;address-full-policy&gt;</span>PAGE<span class="nt">&lt;/address-full-policy&gt;</span>
            <span class="nt">&lt;auto-create-queues&gt;</span>true<span class="nt">&lt;/auto-create-queues&gt;</span>
            <span class="nt">&lt;auto-create-addresses&gt;</span>true<span class="nt">&lt;/auto-create-addresses&gt;</span>
            <span class="nt">&lt;auto-create-jms-queues&gt;</span>true<span class="nt">&lt;/auto-create-jms-queues&gt;</span>
            <span class="nt">&lt;auto-create-jms-topics&gt;</span>true<span class="nt">&lt;/auto-create-jms-topics&gt;</span>
        <span class="nt">&lt;/address-setting&gt;</span>
    <span class="nt">&lt;/address-settings&gt;</span>
<span class="nt">&lt;/core&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="8">
<li><p>Service configuration: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">vim</span> <span class="pre">/etc/systemd/system/broker1.service</span></code></p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>ActiveMQ-Broker
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">User</span><span class="o">=</span>artemis
<span class="nv">WorkingDirectory</span><span class="o">=</span>/opt/broker/broker1
<span class="nv">ExecStart</span><span class="o">=</span>/opt/broker/broker1/bin/artemis run


<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>Enable the service</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> broker1
sudo systemctl start broker1
</pre></div>
</div>
</div></blockquote>
<p><strong>Configuration of Artemis</strong></p>
<p>Add the following values to your Artemis config:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">spring</span><span class="p">:</span>
    <span class="nt">websocket</span><span class="p">:</span>
        <span class="nt">broker</span><span class="p">:</span>
            <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">USERNAME</span>
            <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PASSWORD</span>
            <span class="nt">addresses</span><span class="p">:</span> <span class="s">&quot;localhost:61613&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">USERNAME</span></code> and <code class="docutils literal notranslate"><span class="pre">PASSWORD</span></code> are the values used in step 5. Replace localhost if the broker runs on a separate machine.</p>
</section>
<section id="file-system">
<h3>File system<a class="headerlink" href="#file-system" title="Permalink to this heading"></a></h3>
<p>The last (and also easiest) part to configure is the file system:
You have to provide a folder that is shared between all instances of the application server (e.g. by using NFS).</p>
<p>You then have to set the following values in the application config:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">artemis</span><span class="p">:</span>
    <span class="nt">repo-clone-path</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">artemis_repo_basepath</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">/repos/</span>
    <span class="nt">repo-download-clone-path</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">artemis_repo_basepath</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">/repos-download/</span>
    <span class="nt">file-upload-path</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">artemis_repo_basepath</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">/uploads</span>
    <span class="nt">submission-export-path</span><span class="p">:</span> <span class="p p-Indicator">{{</span> <span class="nv">artemis_repo_basepath</span> <span class="p p-Indicator">}}</span><span class="l l-Scalar l-Scalar-Plain">/exports</span>
</pre></div>
</div>
</div></blockquote>
<p>Where <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">artemis_repo_basepath</span> <span class="pre">}}</span></code> is the path to the shared folder</p>
<p>The file system stores (as its names suggests) files, these are e.g. submissions to file upload exercises,
repositories that are checked out for the online editor, course icons, etc.</p>
</section>
<section id="scheduling">
<h3>Scheduling<a class="headerlink" href="#scheduling" title="Permalink to this heading"></a></h3>
<p>Artemis uses scheduled tasks in various scenarios: e.g. to lock repositories on due date, clean up unused resources, etc.
As we now run multiple instances of Artemis, we have to ensure that the scheduled tasks are not executed multiple times.
Artemis uses to approaches for this:</p>
<ol class="arabic simple">
<li><p>Tasks for quizzes (e.g. evaluation once the quiz is due) are automatically distributed (using Hazelcast)</p></li>
<li><p>Tasks for other exercises are only scheduled on one instance:</p></li>
</ol>
<p>You must add the <code class="docutils literal notranslate"><span class="pre">Scheduling</span></code> profile to <strong>exactly one</strong> instance of your cluster.
This instance will then perform scheduled tasks whereas the other instances will not.</p>
</section>
<section id="nginx-configuration">
<h3>nginx configuration<a class="headerlink" href="#nginx-configuration" title="Permalink to this heading"></a></h3>
<p>You have to change the nginx configuration (of Artemis) to ensure that the load is distributed between all instances.
This can be done by defining an upstream (containing all instances) and forwarding all requests to this upstream.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>upstream artemis <span class="o">{</span>
    server instance1:8080<span class="p">;</span>
    server instance2:8080<span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h3>
<p>All instances can now communicate with each other on 3 different layers:</p>
<ul class="simple">
<li><p>Database cache</p></li>
<li><p>WebSockets</p></li>
<li><p>File system</p></li>
</ul>
<p>You can see the state of all connected instances within the registry:</p>
<p>It relays message between instances:</p>
<blockquote>
<div><figure class="align-center">
<img alt="../../_images/registry.png" src="../../_images/registry.png" />
</figure>
</div></blockquote>
</section>
</section>
<hr class="docutils" />
<section id="alternative-docker-compose-setup">
<h2><a class="toc-backref" href="#id33">Alternative: Docker-Compose Setup</a><a class="headerlink" href="#alternative-docker-compose-setup" title="Permalink to this heading"></a></h2>
<p>A full functioning development environment can also be set up using
docker-compose:</p>
<ol class="arabic simple">
<li><p>Install <a class="reference external" href="https://docs.docker.com/install/">docker</a> and <a class="reference external" href="https://docs.docker.com/compose/install/">docker-compose</a></p></li>
<li><p>Configure the credentials in <code class="docutils literal notranslate"><span class="pre">application-artemis.yml</span></code> in the folder <code class="docutils literal notranslate"><span class="pre">src/main/resources/config</span></code> as described above</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">up</span></code></p></li>
<li><p>Go to <a class="reference external" href="http://localhost:9000">http://localhost:9000</a></p></li>
</ol>
<p>The client and the server will run in different containers. As Npm is
used with its live reload mode to build and run the client, any change
in the client’s codebase will trigger a rebuild automatically. In case
of changes in the codebase of the server one has to restart the
<code class="docutils literal notranslate"><span class="pre">artemis-server</span></code> container via
<code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">restart</span> <span class="pre">artemis-server</span></code>.</p>
<p>(Native) Running and Debugging from IDEs is currently not supported.</p>
<section id="get-a-shell-into-the-containers">
<h3>Get a shell into the containers<a class="headerlink" href="#get-a-shell-into-the-containers" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>app container:
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">-it</span> <span class="pre">$(docker-compose</span> <span class="pre">ps</span> <span class="pre">-q</span> <span class="pre">artemis-app)</span> <span class="pre">sh</span></code></p></li>
<li><p>mysql container:
<code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span> <span class="pre">-it</span> <span class="pre">$(docker-compose</span> <span class="pre">ps</span> <span class="pre">-q</span> <span class="pre">artemis-mysql)</span> <span class="pre">mysql</span></code></p></li>
</ul>
</section>
<section id="other-useful-commands">
<h3>Other useful commands<a class="headerlink" href="#other-useful-commands" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Stop the server: <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">stop</span> <span class="pre">artemis-server</span></code> (restart via
<code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">start</span> <span class="pre">artemis-server</span></code>)</p></li>
<li><p>Stop the client: <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">stop</span> <span class="pre">artemis-client</span></code> (restart via
<code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">start</span> <span class="pre">artemis-client</span></code>)</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="alternative-kubernetes-setup">
<h2><a class="toc-backref" href="#id34">Alternative: Kubernetes Setup</a><a class="headerlink" href="#alternative-kubernetes-setup" title="Permalink to this heading"></a></h2>
<p>This section describes how to set up an environment deployed in Kubernetes.</p>
<p><strong>Prerequisites:</strong></p>
<p>Follow the links to install the tools which will be needed to proceed with the Kubernetes cluster setup.</p>
<ul>
<li><dl class="simple">
<dt><a class="reference external" href="https://docs.docker.com/get-docker/">Docker</a> - v20.10.7</dt><dd><p>Docker is a platform for developing, shipping and running applications.
In our case, we will use it to build the images which we will deploy.
It is also needed from k3d to create a cluster. The cluster nodes are deployed on Docker containers.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://hub.docker.com/signup">DockerHub Account</a></dt><dd><p>Docker Hub is a service provided by Docker for finding and sharing container images.
Account in DockerHub is needed to push the Artemis image which will be used by the Kubernetes deployment.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><a class="reference external" href="https://k3d.io/#installation">k3d</a> - v4.4.7</dt><dd><p>k3d is a lightweight wrapper to run k3s which is a lightweight Kubernetes distribution in Docker.
k3d makes it very easy to create k3s clusters especially for local deployment on Kubernetes.</p>
<p>Windows users can use <code class="docutils literal notranslate"><span class="pre">choco</span></code> to install it. More details can be found in the link under <code class="docutils literal notranslate"><span class="pre">Other</span> <span class="pre">Installation</span> <span class="pre">Methods</span></code></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://kubernetes.io/docs/tasks/tools/#kubectl/">kubectl</a> - v1.21</dt><dd><p>kubectl is the Kubernetes command-line tool, which allows you to run commands against Kubernetes clusters.
It can be used to deploy applications, inspect and manage cluster resources, and view logs.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference external" href="https://helm.sh/docs/intro/install/">helm</a> - v3.6.3</dt><dd><p>Helm is the package manager for Kubernetes. We will use it to install cert-manager and Rancher</p>
</dd>
</dl>
</li>
</ul>
<div class="contents local topic" id="id8">
<p class="topic-title">Content of this section</p>
<ul class="simple">
<li><p><a class="reference internal" href="#setup-kubernetes-cluster" id="id74">Setup Kubernetes Cluster</a></p></li>
<li><p><a class="reference internal" href="#create-dockerhub-repository" id="id75">Create DockerHub Repository</a></p></li>
<li><p><a class="reference internal" href="#configure-docker-id-username" id="id76">Configure Docker ID (username)</a></p></li>
<li><p><a class="reference internal" href="#configure-artemis-resources" id="id77">Configure Artemis Resources</a></p></li>
<li><p><a class="reference internal" href="#build-artemis" id="id78">Build Artemis</a></p></li>
<li><p><a class="reference internal" href="#run-docker-build" id="id79">Run Docker Build</a></p></li>
<li><p><a class="reference internal" href="#push-to-docker" id="id80">Push to Docker</a></p></li>
<li><p><a class="reference internal" href="#configure-spring-profiles" id="id81">Configure Spring Profiles</a></p></li>
<li><p><a class="reference internal" href="#deploy-kubernetes-resources" id="id82">Deploy Kubernetes Resources</a></p></li>
<li><p><a class="reference internal" href="#add-edit-secrets" id="id83">Add/Edit Secrets</a></p></li>
<li><p><a class="reference internal" href="#check-the-deployments-in-rancher" id="id84">Check the Deployments in Rancher</a></p></li>
<li><p><a class="reference internal" href="#check-out-the-logs" id="id85">Check out the Logs</a></p></li>
<li><p><a class="reference internal" href="#troubleshooting" id="id86">Troubleshooting</a></p></li>
<li><p><a class="reference internal" href="#set-additional-environment-variables" id="id87">Set Additional Environment Variables</a></p></li>
</ul>
</div>
<section id="setup-kubernetes-cluster">
<h3><a class="toc-backref" href="#id74">Setup Kubernetes Cluster</a><a class="headerlink" href="#setup-kubernetes-cluster" title="Permalink to this heading"></a></h3>
<p>To be able to deploy Artemis on Kubernetes, you need to set up a cluster.
A cluster is a set of nodes that run containerized applications.
Kubernetes clusters allow for applications to be more easily developed, moved and managed.</p>
<p>With the following commands, you will set up one cluster with three agents as well as Rancher
which is a platform for cluster management with an easy to use user interface.</p>
<p><strong>IMPORTANT: Before you continue make sure Docker has been started.</strong></p>
<ol class="arabic">
<li><p>Set environment variables</p>
<p>The CLUSTER_NAME, RANCHER_SERVER_HOSTNAME and KUBECONFIG_FILE environment variables need to be set
so that they can be used in the next commands.
If you don’t want to set environment variables you can replace their values in the commands.
What you need to do is replace $CLUSTER_NAME with “k3d-rancher”, $RANCHER_SERVER_HOSTNAME with “rancher.localhost”
and $KUBECONFIG_FILE with “k3d-rancher.yml”.</p>
<p><strong>For macOS/Linux</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">CLUSTER_NAME</span><span class="o">=</span><span class="s2">&quot;k3d-rancher&quot;</span>
<span class="n">export</span> <span class="n">RANCHER_SERVER_HOSTNAME</span><span class="o">=</span><span class="s2">&quot;rancher.localhost&quot;</span>
<span class="n">export</span> <span class="n">KUBECONFIG_FILE</span><span class="o">=</span><span class="s2">&quot;$CLUSTER_NAME.yaml&quot;</span>
</pre></div>
</div>
<p><strong>For Windows</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$env:CLUSTER_NAME=&quot;k3d-rancher&quot;
$env:RANCHER_SERVER_HOSTNAME=&quot;rancher.localhost&quot;
$env:KUBECONFIG_FILE=&quot;${env:CLUSTER_NAME}.yaml&quot;
</pre></div>
</div>
</li>
<li><p>Create the cluster</p>
<p>With the help of the commands block below you can create a cluster with one server and three agents
at a total of four nodes.
Your deployments will be distributed almost equally among the 4 nodes.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">k3d</span> <span class="pre">cluster</span> <span class="pre">list</span></code> you can see whether your cluster is created and how many of its nodes are running.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">nodes</span></code> you can see the status of each node of the newly created cluster.</p>
<p>You should also write the cluster configuration into the KUBECONFIG_FILE.
This configuration will be later needed when you are creating deployments.
You can either set the path to the file as an environment variable or replace it with “&lt;path-to-kubeconfig-file&gt;”
when needed.</p>
<p><strong>For macOS/Linux</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>k3d cluster create $CLUSTER_NAME --api-port 6550 --servers 1 --agents 3 --port 443:443@loadbalancer --wait
k3d cluster list
kubectl get nodes
k3d kubeconfig get $CLUSTER_NAME &gt; $KUBECONFIG_FILE
export KUBECONFIG=$KUBECONFIG_FILE
</pre></div>
</div>
<p><strong>For Windows</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>k3d cluster create $env:CLUSTER_NAME --api-port 6550 --servers 1 --agents 3 --port 443:443@loadbalancer --wait
k3d cluster list
kubectl get nodes
k3d kubeconfig get ${env:CLUSTER_NAME} &gt; $env:KUBECONFIG_FILE
$env:KUBECONFIG=($env:KUBECONFIG_FILE)
</pre></div>
</div>
</li>
<li><p>Install cert-manager</p>
<p>cert-manager is used to add certificates and certificate issuers as resource types in Kubernetes clusters.
It simplifies the process of obtaining, renewing and using those certificates.
It can issue certificates from a variety of supported sources, e.g. Let’s Encrypt, HashiCorp Vault, Venafi.</p>
<p>In our case, it will issue self-signed certificates to our Kubernetes deployments to secure the communication
between the different deployments.</p>
<p>Before the installation, you need to add the Jetstack repository and update the local Helm chart repository cache.
cert-manager has to be installed in a separate namespace called <code class="docutils literal notranslate"><span class="pre">cert-manager</span></code> so one should be created as well.
After the installation, you can check the status of the installation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">repo</span> <span class="n">add</span> <span class="n">jetstack</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">charts</span><span class="o">.</span><span class="n">jetstack</span><span class="o">.</span><span class="n">io</span>
<span class="n">helm</span> <span class="n">repo</span> <span class="n">update</span>
<span class="n">kubectl</span> <span class="n">create</span> <span class="n">namespace</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span>
<span class="n">helm</span> <span class="n">install</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span> <span class="n">jetstack</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">namespace</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">version</span> <span class="n">v1</span><span class="o">.</span><span class="mf">0.4</span> <span class="o">--</span><span class="nb">set</span> <span class="n">installCRDs</span><span class="o">=</span><span class="n">true</span> <span class="o">--</span><span class="n">wait</span>
<span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">cert</span><span class="o">-</span><span class="n">manager</span> <span class="n">rollout</span> <span class="n">status</span> <span class="n">deploy</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">manager</span>
</pre></div>
</div>
</li>
<li><p>Install Rancher</p>
<p>Rancher is a Kubernetes management tool that allows you to create and manage Kubernetes deployments
more easily than with the CLI tools.</p>
<p>You can install Rancher using Helm - the package manager for Kubernetes.
It has to be installed in a namespace called <code class="docutils literal notranslate"><span class="pre">cattle-system</span></code> and
we should create such a namespace before the installation itself.
During the installation, we set the namespace and the hostname on which Rancher will be accessible.
Then we can check the installation status.</p>
<p><strong>For macOS/Linux</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>helm repo add rancher-stable https://releases.rancher.com/server-charts/stable
helm repo update
kubectl create namespace cattle-system
helm install rancher rancher-stable/rancher --namespace cattle-system --set hostname=$RANCHER_SERVER_HOSTNAME --version 2.5.9 --wait
kubectl -n cattle-system rollout status deploy/rancher
</pre></div>
</div>
<p><strong>For Windows</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>helm repo add rancher-stable https://releases.rancher.com/server-charts/stable
helm repo update
kubectl create namespace cattle-system
helm install rancher rancher-stable/rancher --namespace cattle-system --set hostname=${env:RANCHER_SERVER_HOSTNAME} --version 2.5.9 --wait
kubectl -n cattle-system rollout status deploy/rancher
</pre></div>
</div>
</li>
<li><p>Open Rancher and update the password</p></li>
</ol>
<p>Open Rancher on <a class="reference external" href="https://rancher.localhost/">https://rancher.localhost/</a>.</p>
<p>You will be notified that the connection is not private.
The reason for that is that the Rancher deployment uses a self-signed certificate by an unknown authority ‘dynamiclistener-ca’.
It is used for secure communication between internal components.
Since it’s your local environment this is not an issue and you can proceed to the website.
If you can’t continue using the Chrome browser, you can try with another browser, e.g. Firefox.</p>
<p>You will be prompted to set a password which later will be used to log in to Rancher.
The password will often be used, so you shouldn’t forget it.</p>
<figure class="align-center">
<img alt="../../_images/rancher_password.png" src="../../_images/rancher_password.png" />
</figure>
<p>Then you should save the Rancher Server URL, please use the predefined name.</p>
<figure class="align-center">
<img alt="../../_images/rancher_url.png" src="../../_images/rancher_url.png" />
</figure>
<p>After saving, you will be redirected to the main page of Rancher, where you see your clusters.
There will be one local cluster.</p>
<figure class="align-center">
<img alt="../../_images/rancher_cluster.png" src="../../_images/rancher_cluster.png" />
</figure>
<p>You can open the workloads using the menu, there will be no workloads deployed at the moment.</p>
<figure class="align-center">
<img alt="../../_images/rancher_nav_workloads.png" src="../../_images/rancher_nav_workloads.png" />
</figure>
<figure class="align-center">
<img alt="../../_images/rancher_empty_workloads.png" src="../../_images/rancher_empty_workloads.png" />
</figure>
<ol class="arabic simple" start="6">
<li><p>Create a new namespace in Rancher</p></li>
</ol>
<p>Namespaces are virtual clusters backed by the same physical cluster. Namespaces provide a scope for names.
Names of resources need to be unique within a namespace, but not across namespaces.
Usually, different namespaces are created to separate environments deployments e.g. development, staging, production.</p>
<p>For our development purposes, we will create a namespace called artemis.
It can be done easily using Rancher.</p>
<ol class="loweralpha">
<li><p>Navigate to Namespaces using the top menu of Rancher</p></li>
<li><p>Select <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Namespace</span></code> to open the form for namespace creation</p>
<figure class="align-center">
<img alt="../../_images/rancher_namespaces.png" src="../../_images/rancher_namespaces.png" />
</figure>
</li>
<li><p>Put <code class="docutils literal notranslate"><span class="pre">artemis</span></code> as namespace’s name and select the <code class="docutils literal notranslate"><span class="pre">Create</span></code> button</p>
<figure class="align-center">
<img alt="../../_images/rancher_create_namespace.png" src="../../_images/rancher_create_namespace.png" />
</figure>
</li>
</ol>
</section>
<section id="create-dockerhub-repository">
<h3><a class="toc-backref" href="#id75">Create DockerHub Repository</a><a class="headerlink" href="#create-dockerhub-repository" title="Permalink to this heading"></a></h3>
<p>The Artemis image will be stored and managed in DockerHub. Kubernetes will pull it from there and deploy it afterwards.</p>
<p>After you log in to your <a class="reference external" href="https://hub.docker.com/">DockerHub</a> account you can create as many public repositories
as you want.
To create a repository you need to select the <code class="docutils literal notranslate"><span class="pre">Create</span> <span class="pre">repository</span></code> button.</p>
<p><strong>DockerHub:</strong></p>
<figure class="align-center">
<img alt="../../_images/dockerhub.png" src="../../_images/dockerhub.png" />
</figure>
<p>Then fill in the repository name with <code class="docutils literal notranslate"><span class="pre">artemis</span></code>. Then use the <code class="docutils literal notranslate"><span class="pre">Create</span></code> button to create your repository.</p>
<figure class="align-center">
<img alt="../../_images/dockerhub_create_repository.png" src="../../_images/dockerhub_create_repository.png" />
</figure>
</section>
<section id="configure-docker-id-username">
<h3><a class="toc-backref" href="#id76">Configure Docker ID (username)</a><a class="headerlink" href="#configure-docker-id-username" title="Permalink to this heading"></a></h3>
<p>The username in DockerHub is called Docker ID.
You need to set your Docker ID in the <code class="docutils literal notranslate"><span class="pre">artemis-deployment.yml</span></code> resource so that Kubernetes knows
where to pull the image from.
Open the <code class="docutils literal notranslate"><span class="pre">src/main/kubernetes/artemis/deployment/artemis-deployment.yml</span></code> file and edit</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">template</span><span class="p">:</span>
   <span class="n">spec</span><span class="p">:</span>
   <span class="n">containers</span><span class="p">:</span>
      <span class="n">image</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">DockerId</span><span class="o">&gt;/</span><span class="n">artemis</span>
</pre></div>
</div>
</div></blockquote>
<p>and replace &lt;DockerId&gt; with your docker ID in DockerHub</p>
<p>e.g. it will look like this:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">template</span><span class="p">:</span>
   <span class="n">spec</span><span class="p">:</span>
   <span class="n">containers</span><span class="p">:</span>
      <span class="n">image</span><span class="p">:</span> <span class="n">mmehmed</span><span class="o">/</span><span class="n">artemis</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="configure-artemis-resources">
<h3><a class="toc-backref" href="#id77">Configure Artemis Resources</a><a class="headerlink" href="#configure-artemis-resources" title="Permalink to this heading"></a></h3>
<p>To run Artemis, you need to configure the Artemis’ User Management, Version Control and Continuous Integration.
You can either run it with Jira, Bitbucket, Bamboo or Jenkins, GitLab.
Make sure to configure the <code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-artemis.yml</span></code> file with the proper configuration
for User Management, Version Control and Continuous Integration.</p>
<p>You should skip setting the passwords and token since the Docker image that we are going to build is going to include
those secrets.
You can refer to chapter <code class="docutils literal notranslate"><span class="pre">Add/Edit</span> <span class="pre">Secrets</span></code> for setting those values.</p>
<p>If you want to configure Artemis with <code class="docutils literal notranslate"><span class="pre">Bitbucket,</span> <span class="pre">Jira,</span> <span class="pre">Bamboo</span></code> you can set a connection to existing staging or
production deployments.
If you want to configure Artemis with local user management and no programming exercises continue with
<code class="docutils literal notranslate"><span class="pre">Configure</span> <span class="pre">Local</span> <span class="pre">User</span> <span class="pre">Management</span></code>.</p>
<section id="configure-local-user-management">
<h4>Configure Local User Management<a class="headerlink" href="#configure-local-user-management" title="Permalink to this heading"></a></h4>
<p>If you want to run with local user management and no programming exercises setup follow the steps:</p>
<p>1. Go to the <code class="docutils literal notranslate"><span class="pre">src/main/resources/config/application-artemis.yml</span></code> file, and set use-external in
the user-management section to false.
If you have created an additional <code class="docutils literal notranslate"><span class="pre">application-local.yml</span></code> file as it is described in the
<a class="reference external" href="https://docs.artemis.ase.in.tum.de/dev/setup/#server-setup">Setup documentation</a>, make sure to edit this one.</p>
<blockquote>
<div><p>Another possibility is to add the variable directly in <code class="docutils literal notranslate"><span class="pre">src/main/kubernetes/artemis/configmap/artemis-configmap.yml</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">:</span>
   <span class="n">artemis</span><span class="o">.</span><span class="n">user</span><span class="o">-</span><span class="n">management</span><span class="o">.</span><span class="n">use</span><span class="o">-</span><span class="n">external</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>2. Remove the jira profile from the <code class="docutils literal notranslate"><span class="pre">SPRING_PROFILES_ACTIVE</span></code> field in the ConfigMap found at
<code class="docutils literal notranslate"><span class="pre">src/main/kubernetes/artemis/configmap/artemis-configmap.yml</span></code></p>
<p>Now you can continue with the next step <code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">Artemis</span></code></p>
</section>
</section>
<section id="build-artemis">
<h3><a class="toc-backref" href="#id78">Build Artemis</a><a class="headerlink" href="#build-artemis" title="Permalink to this heading"></a></h3>
<p>Build the Artemis application war file using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">gradlew</span> <span class="o">-</span><span class="n">Pprod</span> <span class="o">-</span><span class="n">Pwar</span> <span class="n">clean</span> <span class="n">bootWar</span>
</pre></div>
</div>
</section>
<section id="run-docker-build">
<h3><a class="toc-backref" href="#id79">Run Docker Build</a><a class="headerlink" href="#run-docker-build" title="Permalink to this heading"></a></h3>
<p>Run Docker build and prepare the Artemis image to be pushed in DockerHub using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span>  <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">DockerId</span><span class="o">&gt;/</span><span class="n">artemis</span> <span class="o">-</span><span class="n">f</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">Dockerfile</span> <span class="o">.</span>
</pre></div>
</div>
<p>This will create the Docker image by copying the war file which was generated by the previous command.</p>
</section>
<section id="push-to-docker">
<h3><a class="toc-backref" href="#id80">Push to Docker</a><a class="headerlink" href="#push-to-docker" title="Permalink to this heading"></a></h3>
<p>Push the image to DockerHub from where it will be pulled during the deployment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">push</span> <span class="o">&lt;</span><span class="n">DockerId</span><span class="o">&gt;/</span><span class="n">artemis</span>
</pre></div>
</div>
<p>In case that you get an “Access denied” error during the push, first execute</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">login</span>
</pre></div>
</div>
<p>and then try again the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">push</span></code> command.</p>
</section>
<section id="configure-spring-profiles">
<h3><a class="toc-backref" href="#id81">Configure Spring Profiles</a><a class="headerlink" href="#configure-spring-profiles" title="Permalink to this heading"></a></h3>
<p>ConfigMaps are used to store configuration data in key-value pairs.</p>
<p>You can change the current Spring profiles used for running Artemis in the
<code class="docutils literal notranslate"><span class="pre">src/main/kubernetes/artemis/configmap/artemis-configmap.yml</span></code> file by changing <code class="docutils literal notranslate"><span class="pre">SPRING_PROFILES_ACTIVE</span></code>.
The current ones are set to use Bitbucket, Jira and Bamboo.
If you want to use Jenkins and GitLab please replace <code class="docutils literal notranslate"><span class="pre">bamboo,bitbucket,jira</span></code> with <code class="docutils literal notranslate"><span class="pre">jenkins,gitlab</span></code>.
You can also change <code class="docutils literal notranslate"><span class="pre">prod</span></code> to <code class="docutils literal notranslate"><span class="pre">dev</span></code> if you want to run in development profile.</p>
</section>
<section id="deploy-kubernetes-resources">
<h3><a class="toc-backref" href="#id82">Deploy Kubernetes Resources</a><a class="headerlink" href="#deploy-kubernetes-resources" title="Permalink to this heading"></a></h3>
<p>Kustomization files declare the resources that will be deployed in one place and with their help we can do
the deployment with only one command.</p>
<p>Once you have your Artemis image pushed to Docker you can use the <code class="docutils literal notranslate"><span class="pre">kustomization.yml</span></code> file in <code class="docutils literal notranslate"><span class="pre">src/main/kubernetes</span></code>
to deploy all the Kubernetes resources.
You can do it by executing the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">k</span> <span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">artemis</span> <span class="o">--</span><span class="n">kubeconfig</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">kubeconfig</span><span class="o">-</span><span class="n">file</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>&lt;path-to-kubeconfig-file&gt; is the path where you created the KUBECONFIG_FILE.</p>
<p>In the console, you will see that the resources are created.
It will take a little bit of time when you are doing this for the first time. Be patient!</p>
<figure class="align-center">
<img alt="../../_images/kubectl_kustomization.png" src="../../_images/kubectl_kustomization.png" />
</figure>
</section>
<section id="add-edit-secrets">
<h3><a class="toc-backref" href="#id83">Add/Edit Secrets</a><a class="headerlink" href="#add-edit-secrets" title="Permalink to this heading"></a></h3>
<p>Once you have deployed Artemis you need to add/edit the secrets so that it can run successfully.</p>
<p>Open Rancher using <a class="reference external" href="https://rancher.localhost/">https://rancher.localhost/</a> and navigate to your cluster.</p>
<p>Then navigate to <code class="docutils literal notranslate"><span class="pre">Secrets</span></code> like shown below:</p>
<figure class="align-center">
<img alt="../../_images/rancher_secrets_menu.png" src="../../_images/rancher_secrets_menu.png" />
</figure>
<p>You will see list of all defined secret files</p>
<figure class="align-center">
<img alt="../../_images/rancher_secrets_list.png" src="../../_images/rancher_secrets_list.png" />
</figure>
<p>Continue with <code class="docutils literal notranslate"><span class="pre">artemis-secrets</span></code> and you will see the values in the secret file. Then navigate to the edit page.</p>
<figure class="align-center">
<img alt="../../_images/rancher_secrets_edit.png" src="../../_images/rancher_secrets_edit.png" />
</figure>
<p>You can edit each secret you want or add more secrets.
Once you select any value box the value itself will be shown and you can edit it.</p>
<figure class="align-center">
<img alt="../../_images/rancher_secrets_edit_page.png" src="../../_images/rancher_secrets_edit_page.png" />
</figure>
<p>After you are done you can save your changes and redeploy the Artemis workload.</p>
</section>
<section id="check-the-deployments-in-rancher">
<h3><a class="toc-backref" href="#id84">Check the Deployments in Rancher</a><a class="headerlink" href="#check-the-deployments-in-rancher" title="Permalink to this heading"></a></h3>
<p>Open Rancher using <a class="reference external" href="https://rancher.localhost/">https://rancher.localhost/</a> and navigate to your cluster.</p>
<p>It may take some time but in the end, you should see that all the workloads have Active status.
In case there is a problem with some workloads you can check the logs to see what the issue is.</p>
<figure class="align-center">
<img alt="../../_images/rancher_workloads.png" src="../../_images/rancher_workloads.png" />
</figure>
<p>You can open the Artemis application using the link <a class="reference external" href="https://artemis-app.artemis.rancher.localhost/">https://artemis-app.artemis.rancher.localhost/</a></p>
<p>You will get the same “Connection is not private” issue as you did when opening <a class="reference external" href="https://rancher.localhost/">https://rancher.localhost/</a>.
As said before this is because a self-signed certificate is used and it is safe to proceed.</p>
<p>It takes several minutes for the application to start.
If you get a “Bad Gateway” error it may happen that the application has not been started yet.
Wait several minutes and if you still have this issue or another one you can check out the pod logs
(described in the next chapter).</p>
</section>
<section id="check-out-the-logs">
<h3><a class="toc-backref" href="#id85">Check out the Logs</a><a class="headerlink" href="#check-out-the-logs" title="Permalink to this heading"></a></h3>
<p>Open the workload which logs you need to check.
There is a list of pods. Open the menu for one of the pods and select <code class="docutils literal notranslate"><span class="pre">View</span> <span class="pre">Logs</span></code>.
A pop-up with the logs will be opened.</p>
<figure class="align-center">
<img alt="../../_images/rancher_logs.png" src="../../_images/rancher_logs.png" />
</figure>
</section>
<section id="troubleshooting">
<h3><a class="toc-backref" href="#id86">Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h3>
<p>If the Artemis application is successfully deployed but there is an error while trying to run the application,
the reason is most likely related to the Artemis yml configuration files.
One of the common errors is related to missing <code class="docutils literal notranslate"><span class="pre">server.url</span></code> variable.
You can fix it by adding it as an environment variable to the Artemis deployment.</p>
</section>
<section id="set-additional-environment-variables">
<h3><a class="toc-backref" href="#id87">Set Additional Environment Variables</a><a class="headerlink" href="#set-additional-environment-variables" title="Permalink to this heading"></a></h3>
<p>This chapter explains how you can set environment variables for your deployment in case you need it.</p>
<p>Open the Workloads view on Rancher</p>
<figure class="align-center">
<img alt="../../_images/rancher_workloads.png" src="../../_images/rancher_workloads.png" />
</figure>
<p>Enter the details page of the Artemis workload and then select Edit in the three-dot menu</p>
<figure class="align-center">
<img alt="../../_images/workload_edit.png" src="../../_images/workload_edit.png" />
</figure>
<p>Expand the <code class="docutils literal notranslate"><span class="pre">Environment</span> <span class="pre">Variables</span></code> menu.
After pressing the <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Variable</span></code> button two fields will appear where you can add the variable key and the value.</p>
<figure class="align-center">
<img alt="../../_images/workload_set_environment_variable.png" src="../../_images/workload_set_environment_variable.png" />
</figure>
<p>You can add as many variables as you want.
Once you are done you can save your changes which will trigger the Redeploy of the application.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../user/markdown-support/" class="btn btn-neutral float-left" title="Markdown Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../guidelines/" class="btn btn-neutral float-right" title="Coding and design guidelines" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Technical University of Munich, Chair for Applied Software Engineering.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>